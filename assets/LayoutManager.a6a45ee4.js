var t=Object.defineProperty,e=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,o=(e,i,s)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s,r=(t,e)=>{for(var i in e||(e={}))n.call(e,i)&&o(t,i,e[i]);if(s)for(var i of s(e))a.call(e,i)&&o(t,i,e[i]);return t},l=(t,s)=>e(t,i(s)),c=(t,e,i)=>(o(t,"symbol"!=typeof e?e+"":e,i),i);import{R as h,d,r as u,V as m,s as g}from"./vendor.56700d50.js";import{_ as p,p as f,C as v,t as b,d as y,H as S,A as w,T as C,l as T,I as E,G as A,c as k,a as _,e as x,L as D,f as L,g as z,M as R,h as F,i as M,j as O,k as P,m as $,n as I,S as N,o as H,Z as j,q as B,r as V,W,b as q,s as U,u as G,v as Y,w as X,x as J,y as K,z as Z,B as Q,E as tt,F as et,J as it,V as st,K as nt,N as at,O as ot,P as rt,Q as lt,R as ct,U as ht,X as dt,Y as ut,$ as mt,a0 as gt,a1 as pt,a2 as ft,D as vt}from"./DashBoard.c5980d2d.js";import{n as bt,g as yt,R as St,M as wt,C as Ct,L as Tt,S as Et,f as At,c as kt}from"./index.1acd586c.js";const _t=[255,255,255],xt=1,Dt=[0,0,1],Lt=[0,0,1];let zt=0;class Rt{constructor(t={}){p(this,"id",void 0),p(this,"color",void 0),p(this,"intensity",void 0),p(this,"type","point"),p(this,"position",void 0),p(this,"attenuation",void 0),p(this,"projectedLight",void 0);const{color:e=_t}=t,{intensity:i=xt}=t,{position:s=Lt}=t;this.id=t.id||"point-".concat(zt++),this.color=e,this.intensity=i,this.type="point",this.position=s,this.attenuation=function(t){if(t.attenuation)return t.attenuation;if("intensity"in t)return[0,0,t.intensity||0];return Dt}(t),this.projectedLight=r({},this)}getProjectedLight({layer:t}){const{projectedLight:e}=this,i=t.context.viewport,{coordinateSystem:s,coordinateOrigin:n}=t.props,a=f(this.position,{viewport:i,coordinateSystem:s,coordinateOrigin:n,fromCoordinateSystem:i.isGeospatial?v.LNGLAT:v.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return e.color=this.color,e.intensity=this.intensity,e.position=a,e}}var Ft=d({name:"PlaybackControls",props:{isRunning:{type:Boolean,required:!0},timeStart:{type:Number,required:!0},timeEnd:{type:Number,required:!0},currentTime:{type:Number,required:!0}},data:()=>({pauseWhileDragging:!1,sliderValue:0,sliderOptions:{min:0,max:1e6,clickable:!1,duration:0,lazy:!0,tooltip:!0,"tooltip-placement":"top"}}),mounted(){this.sliderOptions["custom-formatter"]=t=>this.convertSecondsToClockTimeMinutes(t),window.addEventListener("keyup",this.onKeyPressed)},beforeDestroy(){window.removeEventListener("keyup",this.onKeyPressed)},watch:{currentTime(){this.sliderValue=1e6*(this.currentTime-this.timeStart)/(this.timeEnd-this.timeStart)}},methods:{toggleSimulation(){this.$emit("click")},convertSecondsToClockTimeMinutes(t){const e=this.getSecondsFromSlider(t);try{const t=b(e),i=("00"+t.minutes).slice(-2);return`${t.hours}:${i}`}catch(i){return"00:00"}},dragStart(){this.isRunning&&(this.pauseWhileDragging=!0,this.$emit("click"))},dragEnd(){this.pauseWhileDragging&&this.$emit("click"),this.pauseWhileDragging=!1},dragging(t){this.$emit("time",this.getSecondsFromSlider(t))},onKeyPressed(t){"Space"===t.code&&this.toggleSimulation()},getSecondsFromSlider(t){let e=(this.timeEnd-this.timeStart)*t/1e6;return e===this.timeEnd&&(e=this.timeEnd-1),e}}});const Mt={};var Ot=bt(Ft,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"slider-thingy"},[i("b-slider",t._b({staticClass:"slider",attrs:{size:"is-large"},on:{dragging:t.dragging,dragstart:t.dragStart,dragend:t.dragEnd},model:{value:t.sliderValue,callback:function(e){t.sliderValue=e},expression:"sliderValue"}},"b-slider",t.sliderOptions,!1)),i("div",{staticClass:"buttons"},[i("div",{staticClass:"playpause",on:{click:t.toggleSimulation}},[t.isRunning?i("i",{staticClass:"button-icon fa fa-1x fa-pause"}):i("i",{staticClass:"button-icon fa fa-1x fa-play"})])])],1)}),[],!1,Pt,"c58ebe1c",null,null);function Pt(t){for(let e in Mt)this[e]=Mt[e]}var $t=function(){return Ot.exports}();var It=d({name:"XmasSettingsPanel",i18n:{messages:{en:{requests:"DRT&nbsp;Requests",passengers:"Passengers",search:"Search",showhide:"Show/Hide",vehicles:"DRT Vehicles",routes:"Routes",speed:"Speed",backgroundTraffic:"All Traffic"},de:{requests:"DRT&nbsp;Anfragen",passengers:"Passagiere",search:"Suche",showhide:"Ein-/Ausblenden",vehicles:"DRT Fahrzeuge",routes:"Routen",speed:"Geschwindigkeit",backgroundTraffic:"Alle Fahrzeuge"}}},components:{ToggleButton:y.exports.ToggleButton},props:{items:{type:Object,required:!0}}});const Nt={};var Ht=bt(It,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"settings-panel-content"},[i("h4",[t._v(t._s(t.$t("showhide")))]),i("div",{staticClass:"items"},t._l(Object.keys(t.items),(function(e){return i("div",{key:e,staticClass:"row"},[i("toggle-button",{staticClass:"toggle",attrs:{width:40,value:t.items[e],labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(i){return t.$emit("click",e)}}}),i("label",{domProps:{innerHTML:t._s(t.$t(e))}})],1)})),0)])}),[],!1,jt,"7d83036b",null,null);function jt(t){for(let e in Nt)this[e]=Nt[e]}var Bt=function(){return Ht.exports}();function Vt(){return new Worker("/report-tncs2020-simwrapper/assets/MATSimEventStreamer.worker.b942c1ac.js",{type:"module"})}class Wt{constructor(t){c(this,"fileApi"),c(this,"linkIdLookup",{}),c(this,"network"),c(this,"eventWorker"),c(this,"eventLayers",[]),c(this,"range",[1/0,-1/0]),c(this,"timeRange",[1/0,-1/0]),c(this,"$emit",(()=>{})),c(this,"boundBox",[]),c(this,"params"),this.params=r({},t),this.fileApi=new S(t.fileSystem),t.$emit&&(this.$emit=t.$emit),t.boundBox&&(this.boundBox=t.boundBox)}async loadFiles(){const{network:t,linkIdLookup:e}=await this.loadNetwork();this.network=t,this.linkIdLookup=e;try{let t=`${this.params.subfolder}/${this.params.vizDetails.events}`;return await this.streamEventFile(t)}catch(i){throw console.error(i),Error(""+i)}return[]}async loadNetwork(){let t=this.params.vizDetails.events.replace("events.xml","network.xml");const e=await this.params.dataManager.getRoadNetwork(t,this.params.subfolder,Object.assign({projection:"25833"},this.params.vizDetails)),i={};return e.linkIds.forEach(((t,e)=>{i[`${t}`]=e})),{network:e,linkIdLookup:i}}streamEventFile(t){return new Promise(((e,i)=>{const s=(t,i)=>{console.log("FINAL time",this.timeRange),this.$emit("finished"),this.eventWorker.terminate(),console.log("DONE: layers",this.eventLayers.length),console.log("ALL DONE",{totalRows:t,data:i.range,time:this.timeRange}),this.range=i.range,e(this.eventLayers)};this.$emit("status","Loading file...");let n=0;this.range=[1/0,-1/0],this.timeRange=[1/0,-1/0],this.eventWorker&&this.eventWorker.terminate(),this.eventLayers=[],this.eventWorker=new Vt;const a=Intl.NumberFormat();this.eventWorker.onmessage=async t=>{const e=t.data;if(e.status)this.$emit("status",e.status);else{if(e.error)throw Error(e.error);if(e.finished)return void s(n,e);{const t=e.events;console.log(t.length),n+=t.length,this.$emit("status","Loading "+a.format(n)+" events..."),this.timeRange=[Math.min(this.timeRange[0],t[0].time),Math.max(this.timeRange[1],t[t.length-1].time)],this.timeRange=[Math.min(this.timeRange[0],e.vehicleTrips[0].t0),Math.max(this.timeRange[1],e.vehicleTrips[e.vehicleTrips.length-1].t1)];let i=e.vehicleTrips;if(console.log("ROIGINAL LENGHT",i.length),this.boundBox.length){const t=this.network.source,s=this.network.dest;i=e.vehicleTrips.filter((e=>{const i=2*this.linkIdLookup[e.link];return t[i]>this.boundBox[0][0]&&t[i]<this.boundBox[1][0]&&t[i+1]>this.boundBox[0][1]&&t[i+1]<this.boundBox[1][1]&&s[i]>this.boundBox[0][0]&&s[i]<this.boundBox[1][0]&&s[i+1]>this.boundBox[0][1]&&s[i+1]<this.boundBox[1][1]})),console.log("FILTERED LENGTH:",i.length)}const s=i.length,o={locO:new Float32Array(2*s).fill(NaN),locD:new Float32Array(2*s).fill(NaN),t0:new Float32Array(s).fill(NaN),t1:new Float32Array(s).fill(NaN)};for(let e=0;e<s;e++){const t=i[e],n=2*this.linkIdLookup[t.link];o.locO[2*e+0]=this.network.source[0+n],o.locO[2*e+1]=this.network.source[1+n],o.locD[2*e+0]=this.network.dest[0+n],o.locD[2*e+1]=this.network.dest[1+n],0==e?(o.locO[2*e+0]=.5*(o.locO[2*e+0]+o.locD[2*e+0]),o.locO[2*e+1]=.5*(o.locO[2*e+1]+o.locD[2*e+1])):e==s-1&&(o.locD[2*e+0]=.5*(o.locO[2*e+0]+o.locD[2*e+0]),o.locD[2*e+1]=.5*(o.locO[2*e+1]+o.locD[2*e+1])),o.t0[e]=t.t0,o.t1[e]=t.t1}this.eventLayers.push({vehicles:o})}}},this.eventWorker.postMessage({filePath:t,fileSystem:this.params.fileSystem,projection:this.params.vizDetails.projection,boundBox:this.boundBox})}))}}class qt extends w{getShaders(){const t=super.getShaders();return t.inject={"vs:#decl":"        attribute float timeStart;\n        attribute float timeEnd;\n        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","vs:#main-start":"        if (searchFlag == 1.0) {\n          vTime = 999.0;\n        } else if (timeEnd == -1.0 || timeStart > currentTime || timeEnd < currentTime ) {\n          vTime = -1.0;\n          return;\n        } else {\n          float nearBeginning = currentTime - timeStart;\n          float nearEnd = timeEnd - currentTime;\n          vTime = min(nearBeginning, nearEnd);\n        }\n      ","fs:#decl":"        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","fs:#main-start":"      if (searchFlag == 0.0 && vTime == -1.0 ) discard;\n      ","fs:DECKGL_FILTER_COLOR":"        if (vTime <= 10.0) color.a *= (vTime / 10.0);\n      "},t}initializeState(t){super.initializeState(t);this.getAttributeManager().addInstanced({timeStart:{size:1,accessor:"getTimeStart"},timeEnd:{size:1,accessor:"getTimeEnd"}})}draw(t){const{currentTime:e}=this.props;t.uniforms=Object.assign({},t.uniforms,{currentTime:e}),super.draw(t)}}qt.layerName="DrtRequestArcLayer",qt.defaultProps={currentTime:{type:"number",value:0,min:0},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},searchFlag:{type:"number",value:0}};var Ut='// BC 2021-04-30: this file forked from https://github.com/visgl/deck.gl\r\n//\r\n// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\r\n//\r\n// Permission is hereby granted, free of charge, to any person obtaining a copy\r\n// of this software and associated documentation files (the "Software"), to deal\r\n// in the Software without restriction, including without limitation the rights\r\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n// copies of the Software, and to permit persons to whom the Software is\r\n// furnished to do so, subject to the following conditions:\r\n//\r\n// The above copyright notice and this permission notice shall be included in\r\n// all copies or substantial portions of the Software.\r\n//\r\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n// THE SOFTWARE.\r\n\r\n#define SHADER_NAME icon-layer-vertex-shader\r\n\r\nattribute vec2 positions;\r\n\r\nattribute float instanceSizes;\r\nattribute vec4 instanceColors;\r\nattribute vec3 instancePickingColors;\r\nattribute vec4 instanceIconFrames;\r\nattribute float instanceColorModes;\r\nattribute vec2 instanceOffsets;\r\nattribute vec2 instancePixelOffset;\r\n\r\nuniform float sizeScale;\r\nuniform vec2 iconsTextureDim;\r\nuniform float sizeMinPixels;\r\nuniform float sizeMaxPixels;\r\nuniform bool billboard;\r\n\r\nuniform float currentTime;\r\n\r\nuniform vec2 iconStillOffsets;\r\nuniform vec4 iconStillFrames;\r\n\r\nattribute float instanceTimestamps;\r\nattribute float instanceTimestampsNext;\r\nattribute vec2 instanceStartPositions;\r\nattribute vec2 instanceEndPositions;\r\n\r\nvarying float vColorMode;\r\nvarying vec4 vColor;\r\nvarying vec2 vTextureCoords;\r\nvarying vec2 uv;\r\nvarying float vPercentComplete;\r\n\r\n// ------------------------------------------------------------------\r\n\r\nvec2 rotate_by_angle(vec2 vertex, float angle_radian) {\r\n  float cos_angle = cos(angle_radian);\r\n  float sin_angle = sin(angle_radian);\r\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\r\n  return rotationMatrix * vertex;\r\n}\r\n\r\nvec3 interpolate(in vec3 point1, in vec3 point2, in float timestepFraction) {\r\n    if (timestepFraction <= 0.0) {\r\n        return point1;\r\n    } else if (timestepFraction >= 1.0 ) {\r\n        return point2;\r\n    } else {\r\n        vec3 direction = point2 - point1;\r\n        return point1 + (direction * timestepFraction);\r\n    }\r\n}\r\n\r\nvoid main(void) {\r\n\r\n  // Calculate progress:\r\n  // Skip everything else if this vertex is outside the time window\r\n  if (currentTime < instanceTimestamps) {\r\n    vPercentComplete = -1.0;\r\n    return;\r\n  } else if (currentTime > instanceTimestampsNext) {\r\n    vPercentComplete = -1.0;\r\n    return;\r\n  } else {\r\n    vPercentComplete = (currentTime - instanceTimestamps) /\r\n                       (instanceTimestampsNext - instanceTimestamps);\r\n  }\r\n\r\n  geometry.pickingColor = instancePickingColors;\r\n\r\n  vec3 startPosition = vec3(instanceStartPositions, 5.0);\r\n  vec3 endPosition = vec3(instanceEndPositions, 5.0);\r\n\r\n  // are we stationary/still\r\n  bool still = (instanceStartPositions == instanceEndPositions);\r\n\r\n  // geometry.uv = positions;\r\n  // uv = positions;\r\n\r\n  // this could be the problem right here;\r\n  vec2 iconSize = still ? iconStillFrames.zw : instanceIconFrames.zw;\r\n  // convert size in meters to pixels, then scaled and clamp\r\n  // project meters to pixels and clamp to limits\r\n  float sizePixels = clamp(\r\n    project_size_to_pixel(instanceSizes * sizeScale),\r\n    sizeMinPixels, sizeMaxPixels\r\n  );\r\n\r\n  // scale icon height to match instanceSize\r\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\r\n\r\n  // // figure out angle based on motion direction\r\n  float angle = 0.0;\r\n  if (!still) {\r\n    vec3 direction = normalize(endPosition - startPosition);\r\n    angle = atan( direction.y / direction.x);\r\n    if (direction.x < 0.0) angle = angle - PI;\r\n  }\r\n\r\n  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace\r\n  vec2 pixelOffset = positions / 2.0 * iconSize + (still ? iconStillOffsets : instanceOffsets);\r\n  pixelOffset = rotate_by_angle(pixelOffset, angle) * instanceScale;\r\n  pixelOffset += instancePixelOffset;\r\n  pixelOffset.y *= -1.0;\r\n\r\n  vec3 newPosition = interpolate(startPosition, endPosition, vPercentComplete);\r\n\r\n  if (billboard)  {\r\n    gl_Position = project_position_to_clipspace(newPosition, vec3(0.0), vec3(0.0), geometry.position);\r\n    vec3 offset = vec3(pixelOffset, 0.0);\r\n    DECKGL_FILTER_SIZE(offset, geometry);\r\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\r\n\r\n  } else {\r\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\r\n    DECKGL_FILTER_SIZE(offset_common, geometry);\r\n    gl_Position = project_position_to_clipspace(newPosition, vec3(0.0), offset_common, geometry.position);\r\n  }\r\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\r\n\r\n  vec2 upperleft = (still ? iconStillFrames.xy : instanceIconFrames.xy);\r\n\r\n  vTextureCoords = mix(\r\n    upperleft,\r\n    upperleft + iconSize,\r\n    (positions.xy + 1.0) / 2.0\r\n  ) / iconsTextureDim;\r\n\r\n  vColor = instanceColors;\r\n  DECKGL_FILTER_COLOR(vColor, geometry);\r\n\r\n  vColorMode = instanceColorModes;\r\n}\r\n',Gt='// BC 2021-04-30: this file forked from https://github.com/visgl/deck.gl\r\n//\r\n// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\r\n//\r\n// Permission is hereby granted, free of charge, to any person obtaining a copy\r\n// of this software and associated documentation files (the "Software"), to deal\r\n// in the Software without restriction, including without limitation the rights\r\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n// copies of the Software, and to permit persons to whom the Software is\r\n// furnished to do so, subject to the following conditions:\r\n//\r\n// The above copyright notice and this permission notice shall be included in\r\n// all copies or substantial portions of the Software.\r\n//\r\n// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n// THE SOFTWARE.\r\n\r\n#define SHADER_NAME icon-layer-fragment-shader\r\n\r\nprecision highp float;\r\n\r\nuniform float opacity;\r\nuniform sampler2D iconsTexture;\r\nuniform float alphaCutoff;\r\n\r\nvarying float vColorMode;\r\nvarying vec4 vColor;\r\nvarying vec2 vTextureCoords;\r\nvarying vec2 uv;\r\n\r\nuniform float currentTime;\r\nvarying float vPercentComplete;\r\n\r\nvoid main(void) {\r\n\r\n  if (vPercentComplete == -1.0) discard;\r\n\r\n  geometry.uv = uv;\r\n\r\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\r\n\r\n  // if colorMode == 0, use pixel color from the texture\r\n  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask\r\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\r\n  // Take the global opacity and the alpha from vColor into account for the alpha component\r\n  float a = texColor.a * opacity * vColor.a;\r\n\r\n  if (a < alphaCutoff) {\r\n    discard;\r\n  }\r\n\r\n  gl_FragColor = vec4(color, a);\r\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\r\n}\r\n';const Yt=()=>{},Xt={[A.TEXTURE_MIN_FILTER]:A.LINEAR_MIPMAP_LINEAR,[A.TEXTURE_MAG_FILTER]:A.LINEAR,[A.TEXTURE_WRAP_S]:A.CLAMP_TO_EDGE,[A.TEXTURE_WRAP_T]:A.CLAMP_TO_EDGE};function Jt(t,e,i,s){return i===e.width&&s===e.height?e:(t.canvas.height=s,t.canvas.width=i,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,i,s),t.canvas)}function Kt(t){return t&&(t.id||t.url)}function Zt(t,e,i){for(let s=0;s<e.length;s++){const{icon:n,xOffset:a}=e[s];t[Kt(n)]=l(r({},n),{x:a,y:i})}}class Qt{constructor(t,{onUpdate:e=Yt,onError:i=Yt}){c(this,"gl"),c(this,"onUpdate"),c(this,"onError"),c(this,"_loadOptions"),c(this,"_getIcon"),c(this,"_texture"),c(this,"_externalTexture"),c(this,"_mapping"),c(this,"_pendingCount"),c(this,"_autoPacking"),c(this,"_xOffset"),c(this,"_yOffset"),c(this,"_rowHeight"),c(this,"_buffer"),c(this,"_canvasWidth"),c(this,"_canvasHeight"),c(this,"_canvas"),this.gl=t,this.onUpdate=e,this.onError=i,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null}finalize(){var t;null==(t=this._texture)||t.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const e=this._autoPacking?Kt(t):t;return this._mapping[e]||{}}setProps({loadOptions:t,autoPacking:e,iconAtlas:i,iconMapping:s,data:n,getIcon:a}){t&&(this._loadOptions=t),void 0!==e&&(this._autoPacking=e),a&&(this._getIcon=a),s&&(this._mapping=s),i&&this._updateIconAtlas(i),this._autoPacking&&(n||a)&&"undefined"!=typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(n))}get isLoaded(){return 0===this._pendingCount}_updateIconAtlas(t){var e;null==(e=this._texture)||e.delete(),this._texture=null,this._externalTexture=t,this.onUpdate()}_updateAutoPacking(t){const e=Object.values(function(t,e,i){if(!t||!e)return null;i=i||{};const s={},{iterable:n,objectInfo:a}=x(t);for(const o of n){a.index++;const t=e(o,a),n=Kt(t);if(!t)throw new Error("Icon is missing.");if(!t.url)throw new Error("Icon url is missing.");s[n]||i[n]&&t.url===i[n].url||(s[n]=l(r({},t),{source:o,sourceIndex:a.index}))}return s}(t,this._getIcon,this._mapping)||{});if(e.length>0){const{mapping:t,xOffset:i,yOffset:s,rowHeight:n,canvasHeight:a}=function({icons:t,buffer:e,mapping:i={},xOffset:s=0,yOffset:n=0,rowHeight:a=0,canvasWidth:o}){let r=[];for(let c=0;c<t.length;c++){const l=t[c];if(!i[Kt(l)]){const{height:t,width:c}=l;s+c+e>o&&(Zt(i,r,n),s=0,n=a+n+e,a=0,r=[]),r.push({icon:l,xOffset:s}),s=s+c+e,a=Math.max(a,t)}}return r.length>0&&Zt(i,r,n),{mapping:i,rowHeight:a,xOffset:s,yOffset:n,canvasWidth:o,canvasHeight:(l=a+n+e,Math.pow(2,Math.ceil(Math.log2(l))))};var l}({icons:e,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=n,this._mapping=t,this._xOffset=i,this._yOffset=s,this._canvasHeight=a,this._texture||(this._texture=new C(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:Xt})),this._texture.height!==this._canvasHeight&&(this._texture=function(t,e,i,s){const n=e.width,a=e.height,o=k(e,{width:i,height:s});return _(e,o,{targetY:0,width:n,height:a}),e.delete(),o}(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(e)}}_loadIcons(t){const e=this._canvas.getContext("2d");for(const i of t)this._pendingCount++,T(i.url,E,this._loadOptions).then((t=>{const s=Kt(i),{x:n,y:a,width:o,height:r}=this._mapping[s],l=Jt(e,t,o,r);this._texture.setSubImageData({data:l,x:n,y:a,width:o,height:r}),this._texture.generateMipmap(),this.onUpdate()})).catch((t=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:t})})).finally((()=>{this._pendingCount--}))}}const te=[0,0,0,255],ee={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!1,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},iconStill:{type:"object",value:null},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:te},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getPathStart:{type:"accessor",value:null},getPathEnd:{type:"accessor",value:null},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},currentTime:{type:"number",value:0},pickable:{type:"boolean",value:!0},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class ie extends D{getShaders(){return super.getShaders({vs:Ut,fs:Gt,modules:[L,z]})}initializeState(){this.state={iconManager:new Qt(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};this.getAttributeManager().addInstanced({instanceTimestamps:{size:1,accessor:"getTimeStart"},instanceTimestampsNext:{size:1,accessor:"getTimeEnd"},instanceStartPositions:{size:2,accessor:"getPathStart"},instanceEndPositions:{size:2,accessor:"getPathEnd"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:A.UNSIGNED_BYTE,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:A.UNSIGNED_BYTE,normalized:!0,transition:!0,accessor:"getColor",defaultValue:te},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState({oldProps:t,props:e,changeFlags:i}){var s;super.updateState({props:e,oldProps:t,changeFlags:i});const n=this.getAttributeManager(),{iconAtlas:a,iconMapping:o,data:r,getIcon:l}=e,{iconManager:c}=this.state;c.setProps({loadOptions:e.loadOptions});let h=!1;if(a||this.internalState.isAsyncPropLoading("iconAtlas")?(t.iconAtlas!==e.iconAtlas&&c.setProps({iconAtlas:a,autoPacking:!1}),t.iconMapping!==e.iconMapping&&(c.setProps({iconMapping:o}),h=!0)):c.setProps({autoPacking:!0}),(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&c.setProps({data:r,getIcon:l}),h&&(n.invalidate("instanceOffsets"),n.invalidate("instanceIconFrames"),n.invalidate("instanceColorModes")),i.extensionsChanged){const{gl:t}=this.context;null==(s=this.state.model)||s.delete(),this.state.model=this._getModel(t),n.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(){super.finalizeState(),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:e,sizeMinPixels:i,sizeMaxPixels:s,sizeUnits:n,billboard:a,alphaCutoff:o,currentTime:r,iconStill:l,pickable:c}=this.props,{iconManager:h}=this.state,{viewport:d}=this.context,u=h.getTexture();u&&this.state.model.setUniforms(t).setUniforms({iconsTexture:u,iconsTextureDim:[u.width,u.height],sizeScale:e*("pixels"===n?d.metersPerPixel:1),sizeMinPixels:i,sizeMaxPixels:s,billboard:a,alphaCutoff:o,currentTime:r,pickable:c,iconStillOffsets:this.getInstanceOffset(l),iconStillFrames:this.getInstanceIconFrame(l)}).draw()}_getModel(t){return new R(t,l(r({},this.getShaders()),{id:this.props.id,geometry:new F({drawMode:A.TRIANGLE_FAN,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0}))}_onUpdate(){this.setNeedsRedraw()}_onError(t){const{onIconError:e}=this.getCurrentLayer().props;e?e(t):M.error(t.error)()}getInstanceOffset(t){const e=this.state.iconManager.getIconMapping(t);return[e.width/2-e.anchorX||0,e.height/2-e.anchorY||0]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const e=this.state.iconManager.getIconMapping(t);return[e.x||0,e.y||0,e.width||0,e.height||0]}}ie.layerName="FlatIconLayer",ie.defaultProps=ee;const se=[0,0,0,255],ne={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!1,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},iconStill:{type:"object",value:null},getIcon:{type:"accessor",value:"vehicle"},getBOffsets:{type:"accessor",value:[0,0]},getBIconFrames:{type:"accessor",value:[128,128,128,128]},getBColorModes:{type:"accessor",value:1},getColor:{type:"accessor",value:se},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getPathStart:{type:"accessor",value:null},getPathEnd:{type:"accessor",value:null},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},currentTime:{type:"number",value:0},pickable:{type:"boolean",value:!0},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class ae extends D{getShaders(){return super.getShaders({vs:Ut,fs:Gt,modules:[L,z]})}initializeState(){this.state={iconManager:new Qt(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};this.getAttributeManager().addInstanced({instanceTimestamps:{size:1,accessor:"getTimeStart"},instanceTimestampsNext:{size:1,accessor:"getTimeEnd"},instanceStartPositions:{size:2,accessor:"getPathStart"},instanceEndPositions:{size:2,accessor:"getPathEnd"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,defaultValue:[0,0],accessor:"getBOffsets"},instanceIconFrames:{size:4,defaultValue:[0,0,128,128],accessor:"getBIconFrames"},instanceColorModes:{size:1,type:A.UNSIGNED_BYTE,defaultValue:1,accessor:"getBColorModes"},instanceColors:{size:this.props.colorFormat.length,type:A.UNSIGNED_BYTE,normalized:!0,transition:!0,accessor:"getColor",defaultValue:se},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState({oldProps:t,props:e,changeFlags:i}){var s;super.updateState({props:e,oldProps:t,changeFlags:i});const n=this.getAttributeManager(),{iconAtlas:a,iconMapping:o,data:r,getIcon:l}=e,{iconManager:c}=this.state;c.setProps({loadOptions:e.loadOptions});let h=!1;if(a||this.internalState.isAsyncPropLoading("iconAtlas")?(t.iconAtlas!==e.iconAtlas&&c.setProps({iconAtlas:a,autoPacking:!1}),t.iconMapping!==e.iconMapping&&(c.setProps({iconMapping:o}),h=!0)):c.setProps({autoPacking:!0}),(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&c.setProps({data:r,getIcon:l}),h&&(n.invalidate("instanceOffsets"),n.invalidate("instanceIconFrames"),n.invalidate("instanceColorModes")),i.extensionsChanged){const{gl:t}=this.context;null==(s=this.state.model)||s.delete(),this.state.model=this._getModel(t),n.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(){super.finalizeState(),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:e,sizeMinPixels:i,sizeMaxPixels:s,sizeUnits:n,billboard:a,alphaCutoff:o,currentTime:r,iconStill:l,pickable:c}=this.props,{iconManager:h}=this.state,{viewport:d}=this.context,u=h.getTexture();u&&this.state.model.setUniforms(t).setUniforms({iconsTexture:u,iconsTextureDim:[u.width,u.height],sizeScale:e*("pixels"===n?d.metersPerPixel:1),sizeMinPixels:i,sizeMaxPixels:s,billboard:a,alphaCutoff:o,currentTime:r,pickable:c,iconStillOffsets:this.getInstanceOffset(l),iconStillFrames:this.getInstanceIconFrame(l)}).draw()}_getModel(t){return new R(t,l(r({},this.getShaders()),{id:this.props.id,geometry:new F({drawMode:A.TRIANGLE_FAN,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0}))}_onUpdate(){this.setNeedsRedraw()}_onError(t){const{onIconError:e}=this.getCurrentLayer().props;e?e(t):M.error(t.error)()}getInstanceOffset(t){const e=this.state.iconManager.getIconMapping(t);return[e.width/2-e.anchorX||0,e.height/2-e.anchorY||0]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const e=this.state.iconManager.getIconMapping(t);return[e.x||0,e.y||0,e.width||0,e.height||0]}}ae.layerName="FlatIconLayer",ae.defaultProps=ne;class oe extends O{getShaders(){const t=super.getShaders();return t.inject={"vs:#decl":"        attribute float timeStart;\n        attribute float timeEnd;\n        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","vs:#main-start":"        if (searchFlag == 1.0) {\n          vTime = 999.0;\n        } else if(timeStart > currentTime || timeEnd < currentTime ) {\n          vTime = -1.0;\n          return;\n        } else {\n          float nearBeginning = currentTime - timeStart;\n          float nearEnd = timeEnd - currentTime;\n          vTime = min(nearBeginning, nearEnd);\n        }\n      ","fs:#decl":"        uniform float currentTime;\n        varying float vTime;\n        uniform float searchFlag;\n      ","fs:#main-start":"        if (searchFlag == 0.0 && vTime == -1.0 ) discard;\n      ","fs:DECKGL_FILTER_COLOR":"        if (searchFlag == 0.0 && vTime <= 10.0) color.a *= (vTime / 10.0);\n      "},t}initializeState(t){super.initializeState(t);this.getAttributeManager().addInstanced({timeStart:{size:1,accessor:"getTimeStart"},timeEnd:{size:1,accessor:"getTimeEnd"}})}draw(t){const{currentTime:e,searchFlag:i}=this.props;t.uniforms=Object.assign({},t.uniforms,{currentTime:e,searchFlag:i}),super.draw(t)}}oe.layerName="PathTraceLayer",oe.defaultProps={currentTime:{type:"number",value:0,min:0},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},searchFlag:{type:"number",value:0}};const re={marker:{x:0,y:0,width:128,height:128,mask:!0},info:{x:128,y:0,width:128,height:128,mask:!0},vehicle:{x:128,y:128,width:128,height:128,mask:!0},diamond:{x:0,y:128,width:128,height:128,mask:!1}},le={vehicleColor:[200,130,250],trailColor0:[235,235,25],trailColor1:[23,184,190],effects:[new $({ambientLight:new P({color:[255,255,255],intensity:1}),pointLight:new Rt({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]})})]},ce=0,he=1,de=2,ue=3,me=4,ge=6;const pe=d({name:"XmasVehicleAnimation",i18n:{messages:{en:{requests:"DRT Requests",passengers:"Passengers",search:"Search",showhide:"Show/Hide",vehicles:"Vehicles",routes:"Routes",speed:"Speed"},de:{requests:"DRT Anfragen",passengers:"Passagiere",search:"Suche",showhide:"Ein-/Ausblenden",vehicles:"DRT Fahrzeuge",routes:"DRT Routen",speed:"Geschwindigkeit"}}},components:{CollapsiblePanel:H,SettingsPanel:Bt,LegendColors:function(t){const e={display:"flex"},i={boxSizing:"border-box",float:"left",marginRight:"0.5rem"},s=t.items.map((s=>h.createElement("li",{key:s.value+s.value[0],style:t.mobile?i:e},s.label&&h.createElement("div",{style:{margin:"0 0.5rem 0.0rem 0",fontWeight:"bold"}},s.label),h.createElement("div",{style:{width:t.mobile?"3rem":"100%",height:"3px",marginTop:"0.5rem",backgroundColor:`rgb(${s.color})`}}))));return h.createElement("div",null,h.createElement("h4",{style:{textAlign:"left",fontWeight:"bold",margin:"1rem 0 0.25rem 0",fontSize:"0.8rem"}},t.title),h.createElement("p",null,t.description),h.createElement("ul",{style:{listStyle:"none",padding:0,margin:0}},s))},TripViz:function(t){const{simulationTime:e,paths:i,traces:s,drtRequests:n,settingsShowLayers:a,center:o,dark:r,vehicleLookup:l,searchEnabled:c,onClick:d,viewId:m,trafficLayers:g}=t,p=le,[f,v]=u.exports.useState(o?{center:[16,42],longitude:o[0],latitude:o[1],pitch:0,bearing:0,zoom:10}:Object.assign({},yt.state.viewState));St[m]=()=>{v(yt.state.viewState)};const[b,y]=u.exports.useState({}),S=[];return a.backgroundTraffic&&g.forEach(((t,i)=>{const s=t.vehicles.t0[0]>e||t.vehicles.t1[t.vehicles.t1.length-1]<e;S.push(new ae({data:{length:t.vehicles.t0.length,attributes:{getTimeStart:{value:t.vehicles.t0,size:1},getTimeEnd:{value:t.vehicles.t1,size:1},getPathStart:{value:t.vehicles.locO,size:2},getPathEnd:{value:t.vehicles.locD,size:2}}},id:"vehicles"+i,getColor:[255,32,32],iconMoving:"vehicle",iconStill:"diamond",getSize:20,opacity:1,currentTime:e,shadowEnabled:!0,iconAtlas:"/simwrapper/icon-atlas.png",iconMapping:re,sizeScale:1,billboard:!1,pickable:!0,depthTest:!0,autoHighlight:!1,highlightColor:[255,0,255],parameters:{depthTest:!1},visible:!s}))})),a.routes&&S.push(new oe({id:"Routen",data:s,currentTime:e,getSourcePosition:t=>t.p0,getTargetPosition:t=>t.p1,getTimeStart:t=>t.t0,getTimeEnd:t=>t.t1,getColor:e=>t.colors[e.occ],getWidth:3,opacity:.8,widthMinPixels:1,rounded:!1,shadowEnabled:!1,searchFlag:c?1:0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:y})),a.vehicles&&S.push(new ie({id:"Vehicles",data:i,getPathStart:t=>t.p0,getPathEnd:t=>t.p1,getTimeStart:t=>t.t0,getTimeEnd:t=>t.t1,getIcon:t=>"vehicle",getColor:e=>t.colors[e.occ],iconMoving:"vehicle",iconStill:"diamond",getSize:128,opacity:1,currentTime:e,shadowEnabled:!1,noAlloc:!0,iconAtlas:"/simwrapper/icon-atlas.png",iconMapping:re,sizeScale:.5,billboard:!1,pickable:!0,depthTest:!0,autoHighlight:!1,highlightColor:[255,0,255],onHover:y,parameters:{depthTest:!1}})),a.requests&&S.push(new qt({id:"DRT Requests",data:n,currentTime:e,getSourcePosition:t=>[t[he],t[de]],getTargetPosition:t=>[t[ue],t[me]],getTimeStart:t=>t[ce],getTimeEnd:t=>t[ge],getSourceColor:[0,255,64],getTargetColor:[0,255,64],getWidth:2,opacity:.5,searchFlag:c?1:0})),h.createElement(I,{layers:S,effects:p.effects,pickingRadius:5,viewState:f,controller:!0,getCursor:()=>"pointer",onClick:function(){console.log(b),b.object?d(b.object.v):d(null)},onViewStateChange:t=>{yt.commit("setMapCamera",t.viewState)}},h.createElement(N,{mapStyle:yt.getters.mapStyle,mapboxApiAccessToken:wt}),function({hoverInfo:t}){const{object:e,x:i,y:s}=t;if(!e)return null;const n=l[e.v];return h.createElement("div",{className:"tooltip",style:{fontSize:"0.8rem",backgroundColor:"#ddddeedd",borderLeft:"6px solid green",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#223",padding:"1rem 1rem",position:"absolute",left:i+40,top:s-30}},h.createElement("big",null,h.createElement("b",null,n)),h.createElement("div",null,"Passagiere: ",e.occ," "))}({hoverInfo:b}))},PlaybackControls:$t,ToggleButton:y.exports.ToggleButton,ZoomButtons:j},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,config:Object,thumbnail:Boolean},computed:{fileApi(){return new S(this.fileSystem,yt)},fileSystem(){const t=this.$store.state.svnProjects.filter((t=>t.slug===this.root));if(0===t.length)throw console.log("no such project"),Error;return t[0]},urlThumbnail(){return this.thumbnailUrl},textColor(){return this.myState.colorScheme===Ct.DarkMode?{text:"white",bg:"#181518aa"}:{text:"#3498db",bg:"#eeeef480"}}},data:()=>{const t={0:[140,140,160],1:[20,224,224],2:[240,240,40],3:[240,110,30]};return{viewId:Math.floor(1e12*Math.random()),COLOR_OCCUPANCY:t,SETTINGS:{vehicles:!0,backgroundTraffic:!0,routes:!0,requests:!0},legendItems:Object.keys(t).map((e=>({type:Tt.line,color:t[e],value:e,label:e}))),legendRequests:[{type:Tt.line,color:[255,0,255],value:0,label:""}],vizDetails:{network:"",drtTrips:"",projection:"",title:"",description:"",thumbnail:"",center:[13.45,52.5],zoom:12,bearing:0,pitch:20,mapIsIndependent:!1,events:"",eventBlobs:[],theme:""},myState:{statusMessage:"",clock:"00:00",colorScheme:Ct.DarkMode,isRunning:!1,isShowingHelp:!1,subfolder:"",yamlConfig:"",thumbnail:!1,data:[]},timeStart:0,timeEnd:86400,traces:B([]),traceStart:null,traceEnd:null,traceVehicle:null,paths:B([]),pathStart:null,pathEnd:null,pathVehicle:null,requests:B([]),requestStart:null,requestEnd:null,requestVehicle:null,simulationTime:21600,timeElapsedSinceLastFrame:0,searchTerm:"",searchEnabled:!1,globalState:yt.state,isDarkMode:yt.state.colorScheme===Ct.DarkMode,isLoaded:!1,showHelp:!1,speedStops:[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],speed:1,trafficLayers:[],legendBits:[],isEmbedded:!1,thumbnailUrl:"url('assets/thumbnail.jpg') no-repeat;",vehicleLookup:[],vehicleLookupString:{},isPausedDueToHiding:!1}},watch:{"$store.state.viewState"(){this.vizDetails.mapIsIndependent||St[this.viewId]&&St[this.viewId]()},async"globalState.authAttempts"(){console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),await this.getVizDetails()},"globalState.colorScheme"(){this.isDarkMode=this.globalState.colorScheme===Ct.DarkMode,this.updateLegendColors()},searchTerm(){var t,e,i,s,n,a,o,r;const l=this.vehicleLookupString[this.searchTerm];l>-1?(console.log("vehicle",l),null==(t=this.pathVehicle)||t.filterExact(l),null==(e=this.traceVehicle)||e.filterExact(l),null==(i=this.requestVehicle)||i.filterExact(l),null==(s=this.requestStart)||s.filterAll(),null==(n=this.requestEnd)||n.filterAll(),this.searchEnabled=!0):(console.log("nope"),null==(a=this.pathVehicle)||a.filterAll(),null==(o=this.traceVehicle)||o.filterAll(),null==(r=this.requestVehicle)||r.filterAll(),this.searchEnabled=!1),this.updateDatasetFilters()}},async mounted(){if(yt.commit("setFullScreen",!this.thumbnail),this.myState.thumbnail=this.thumbnail,this.myState.yamlConfig=this.yamlConfig||"",this.myState.subfolder=this.subfolder,this.setEmbeddedMode(),await this.getVizDetails(),this.thumbnail)return;this.showHelp=!1,this.updateLegendColors(),this.setWallClock(),this.myState.statusMessage="/ Dateien laden...",console.log("loading files");const{trips:t,drtRequests:e}=await this.loadFiles();console.log("parsing vehicle motion"),this.myState.statusMessage=`${this.$t("vehicles")}...`,this.paths=await this.parseVehicles(t),this.pathStart=this.paths.dimension((t=>t.t0)),this.pathEnd=this.paths.dimension((t=>t.t1)),this.pathVehicle=this.paths.dimension((t=>t.v)),console.log("Routes..."),this.myState.statusMessage=`${this.$t("routes")}...`,this.traces=await this.parseRouteTraces(t),this.traceStart=this.traces.dimension((t=>t.t0)),this.traceEnd=this.traces.dimension((t=>t.t1)),this.traceVehicle=this.traces.dimension((t=>t.v)),console.log("Requests..."),this.myState.statusMessage=`${this.$t("requests")}...`,this.requests=await this.parseDrtRequests(e),this.requestStart=this.requests.dimension((t=>t[0])),this.requestEnd=this.requests.dimension((t=>t[6])),this.requestVehicle=this.requests.dimension((t=>t[5])),this.loadBackgroundTraffic(),console.log("GO!"),this.myState.statusMessage="",document.addEventListener("visibilitychange",this.handleVisibilityChange,!1),this.myState.isRunning=!0,this.timeElapsedSinceLastFrame=Date.now(),this.animate()},beforeDestroy(){document.removeEventListener("visibilityChange",this.handleVisibilityChange),yt.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1),this.myState.isRunning=!1},methods:{handleClick(t){if(null===t)return void(this.searchTerm="");const e=this.vehicleLookup[t];console.log(e),this.searchTerm===e?this.searchTerm="":this.searchTerm=e},arrayBufferToBase64(t){for(var e="",i=new Uint8Array(t),s=i.byteLength,n=0;n<s;n++)e+=String.fromCharCode(i[n]);return window.btoa(e)},updateLegendColors(){},setWallClock(){const t=Math.floor(this.simulationTime/3600),e=Math.floor(this.simulationTime/60)%60;this.myState.clock=`${t<10?"0":""}${t}${e<10?":0":":"}${e}`},setTime(t){var e,i,s;this.simulationTime=t,this.setWallClock(),this.traceStart&&this.pathStart&&this.requestStart&&(this.pathStart.filter([0,this.simulationTime]),null==(e=this.pathEnd)||e.filter([this.simulationTime,1/0]),this.searchEnabled||(this.traceStart.filter([0,this.simulationTime]),null==(i=this.traceEnd)||i.filter([this.simulationTime,1/0]),this.requestStart.filter([0,this.simulationTime]),null==(s=this.requestEnd)||s.filter([this.simulationTime,1/0]))),this.$options.paths=this.paths.allFiltered(),this.$options.traces=this.traces.allFiltered(),this.$options.drtRequests=this.requests.allFiltered()},toggleSimulation(){console.log("CLICK !!!"),this.myState.isRunning=!this.myState.isRunning,this.timeElapsedSinceLastFrame=Date.now(),this.myState.isRunning&&0===this.speed&&(this.speed=1),this.myState.isRunning&&this.animate()},async loadBackgroundTraffic(){if(this.vizDetails.eventBlobs)for(const t of this.vizDetails.eventBlobs){const e=await this.loadBackgroundChunk(t);this.trafficLayers.push(e)}else if(this.vizDetails.events){const t=new Wt({fileSystem:this.fileSystem,dataManager:new V(this.root,this.subfolder),vizDetails:this.vizDetails,subfolder:this.subfolder}),e=await t.loadFiles();this.trafficLayers=e,this.exportJSON(e)}},async loadBackgroundChunk(t){return new Promise(((e,i)=>{console.log("load chunk:",t);const s=new W;s.onmessage=t=>{const i=new Float32Array(t.data.buffer).length/6,s={vehicles:{locO:new Float32Array(t.data.buffer,0,2*i),locD:new Float32Array(t.data.buffer,4*i*2,2*i),t0:new Float32Array(t.data.buffer,4*i*4,i),t1:new Float32Array(t.data.buffer,4*i*5,i)}};e(s)},s.postMessage({filePath:this.myState.subfolder+"/"+t,fileSystem:this.fileSystem})}))},exportJSON(t){for(const e of t){const t=new Blob([e.vehicles.locO,e.vehicles.locD,e.vehicles.t0,e.vehicles.t1],{type:"octet/stream"}),i=URL.createObjectURL(t);let s=document.createElement("a");s.setAttribute("href",i),s.setAttribute("download","events.blob"),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)}},setEmbeddedMode(){"embed"in this.$route.query&&(console.log("EMBEDDED MODE"),this.isEmbedded=!0,this.$store.commit("setShowLeftBar",!1),this.$store.commit("setFullWidth",!0))},async handleSettingChange(t){console.log(t),this.SETTINGS[t]=!this.SETTINGS[t],this.updateDatasetFilters(),this.simulationTime+=1},buildRouteFromUrl(){const t=this.$route.params;if(!t.project||!t.pathMatch)return void console.log("I CANT EVEN: NO PROJECT/PARHMATCH");const e=1+t.pathMatch.lastIndexOf("/"),i=t.pathMatch.substring(0,e),s=t.pathMatch.substring(e);this.myState.subfolder=i,this.myState.yamlConfig=s},async getVizDetails(){console.log("GETVIZ");try{const t=this.myState.yamlConfig.indexOf("/")>-1?this.myState.yamlConfig:this.myState.subfolder+"/"+this.myState.yamlConfig,e=await this.fileApi.getFileText(t);this.vizDetails=q.parse(e)}catch(e){console.log("failed");const t=e;this.fileSystem.needPassword&&401===t.status&&yt.commit("requestLogin",this.fileSystem.slug)}this.vizDetails.theme&&this.$store.commit("setTheme",this.vizDetails.theme),this.vizDetails.center&&this.$store.commit("setMapCamera",{longitude:this.vizDetails.center[0],latitude:this.vizDetails.center[1],zoom:this.vizDetails.zoom||11,pitch:this.vizDetails.pitch||20,bearing:this.vizDetails.bearing||0,jump:!0});const t=this.vizDetails.title?this.vizDetails.title:"Agent Animation";this.$emit("title",t),this.buildThumbnail(),this.isLoaded=!0},async buildThumbnail(){if(this.thumbnail&&this.vizDetails.thumbnail)try{const t=await this.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail),e=await U.arraybuffer(t),i=this.arrayBufferToBase64(e);i&&(this.thumbnailUrl=`center / cover no-repeat url(data:image/png;base64,${i})`)}catch(t){console.error(t)}},async parseDrtRequests(t){if(this.vehicleLookup.length)for(const i of t)try{i[5]=this.vehicleLookupString[i[5]]}catch(e){}return B(t)},async parseVehicles(t){const e=[];let i=-1;return await G.forEachAsync(t,(t=>{const s=t.path,n=t.timestamps,a=t.passengers;i++,this.vehicleLookup[i]=t.id,this.vehicleLookupString[t.id]=i;for(let o=0;o<t.path.length-1;o++)e.push({t0:n[o],t1:n[o+1],p0:s[o],p1:s[o+1],v:i,occ:a[o]})})),B(e)},updateDatasetFilters(){var t,e,i,s,n;this.traceStart&&this.pathStart&&this.requestStart&&(this.SETTINGS.routes&&(this.searchEnabled?(this.traceStart.filterAll(),null==(t=this.traceEnd)||t.filterAll()):(this.traceStart.filter([0,this.simulationTime]),null==(e=this.traceEnd)||e.filter([this.simulationTime,1/0])),this.$options.traces=this.traces.allFiltered()),this.SETTINGS.vehicles&&(this.pathStart.filter([0,this.simulationTime]),null==(i=this.pathEnd)||i.filter([this.simulationTime,1/0]),this.$options.paths=this.paths.allFiltered()),this.SETTINGS.requests&&(this.searchEnabled?(this.requestStart.filterAll(),null==(s=this.requestEnd)||s.filterAll()):(this.requestStart.filter([0,this.simulationTime]),null==(n=this.requestEnd)||n.filter([this.simulationTime,1/0])),this.$options.drtRequests=this.requests.allFiltered()))},animate(){if(this.myState.isRunning){const t=Date.now()-this.timeElapsedSinceLastFrame;this.timeElapsedSinceLastFrame+=t,this.simulationTime+=t*this.speed*.05,this.updateDatasetFilters(),this.setWallClock(),window.requestAnimationFrame(this.animate)}},handleVisibilityChange(){this.isPausedDueToHiding&&!document.hidden?(console.log("unpausing"),this.isPausedDueToHiding=!1,this.toggleSimulation()):this.myState.isRunning&&document.hidden&&(console.log("pausing"),this.isPausedDueToHiding=!0,this.toggleSimulation())},async parseRouteTraces(t){let e=-1;const i=[];return await G.forEachAsync(t,(t=>{e++;let s=t.timestamps[0],n=t.timestamps[0],a=[];for(let o=1;o<t.path.length;o++)n=t.timestamps[o],t.path[o][0]===t.path[o-1][0]&&t.path[o][1]===t.path[o-1][1]?(a.forEach((e=>{e.t1=t.timestamps[o-1]})),i.push(...a),a=[],s=n):a.push({t0:s,p0:t.path[o-1],p1:t.path[o],v:e,occ:t.passengers[o-1]});a.forEach((t=>{t.t1=n})),i.push(...a)})),B(i)},async loadFiles(){if(!this.fileApi)return{trips:[],drtRequests:{}};let t=[],e=[];try{if(this.vizDetails.drtTrips.endsWith("json")){const i=await this.fileApi.getFileJson(this.myState.subfolder+"/"+this.vizDetails.drtTrips);t=i.trips,e=i.drtRequests}else if(this.vizDetails.drtTrips.endsWith("gz")){const i=await this.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.drtTrips),s=i?await Y(i):null;let n=await G.run(X.inflateAsync(s,{to:"string"}));const a=JSON.parse(n);t=a.trips,e=a.drtRequests}}catch(i){console.error(i),this.myState.statusMessage=""+i}return{trips:t,drtRequests:e}},toggleLoaded(t){this.isLoaded=t},rotateColors(){this.myState.colorScheme=this.myState.colorScheme===Ct.DarkMode?Ct.LightMode:Ct.DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}}});yt.commit("registerPlugin",{kebabName:"xmas-kelheim",prettyName:"Trip Viewer",description:"Deck.gl based trip viewer",filePatterns:["**/xmas-kelheim*.y?(a)ml"],component:pe});const fe={};var ve=bt(pe,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"gl-app",class:{"hide-thumbnail":!t.thumbnail},style:{background:t.urlThumbnail},attrs:{oncontextmenu:"return false"}},[t.thumbnail?t._e():i("trip-viz",{staticClass:"anim",attrs:{center:t.vizDetails.center,colors:t.COLOR_OCCUPANCY,drtRequests:t.$options.drtRequests,dark:t.globalState.isDarkMode,paths:t.$options.paths,settingsShowLayers:t.SETTINGS,searchEnabled:t.searchEnabled,simulationTime:t.simulationTime,traces:t.$options.traces,vehicleLookup:t.vehicleLookup,viewId:t.viewId,onClick:t.handleClick,trafficLayers:t.trafficLayers}}),t.thumbnail?t._e():i("zoom-buttons"),i("div",{staticClass:"bottom-controls-mobile"},[i("div",{staticClass:"big clock"},[i("p",[t._v(t._s(t.myState.clock))])]),t.legendItems.length?i("legend-colors",{staticClass:"legend-block",attrs:{mobile:!0,title:`${t.$t("passengers")}:`,items:t.legendItems}}):t._e(),i("settings-panel",{staticClass:"settings-area",attrs:{items:t.SETTINGS},on:{click:t.handleSettingChange}})],1),t.isLoaded&&!t.thumbnail?i("div",{staticClass:"right-side"},[i("collapsible-panel",{attrs:{direction:"right"}},[i("div",{staticClass:"big clock"},[i("p",[t._v(t._s(t.myState.clock))])]),i("div",{staticClass:"panel-items"},[t.legendItems.length?i("legend-colors",{staticClass:"legend-block",attrs:{title:`${t.$t("passengers")}:`,items:t.legendItems}}):t._e(),i("legend-colors",{staticClass:"legend-block",attrs:{title:`${t.$t("requests")}:`,items:t.legendRequests,mobile:!1}}),i("settings-panel",{staticClass:"settings-area",attrs:{items:t.SETTINGS},on:{click:t.handleSettingChange}}),i("div",{staticClass:"speed-block"},[i("p",{staticClass:"speed-label"},[t._v(t._s(t.$t("speed"))+":"),i("br"),t._v(t._s(t.speed)+"x")]),i("b-slider",{staticClass:"speed-slider",attrs:{min:t.speedStops[0],max:t.speedStops[t.speedStops.length-1],duration:0,dotSize:20,tooltip:!0,"tooltip-placement":"bottom","tooltip-formatter":function(t){return t+"x"}},model:{value:t.speed,callback:function(e){t.speed=e},expression:"speed"}},[t._l(t.speedStops,(function(t){return[i("b-slider-tick",{key:t,attrs:{value:t}})]}))],2)],1)],1)])],1):t._e(),!t.thumbnail&&t.isLoaded?i("playback-controls",{staticClass:"bottom-area",attrs:{timeStart:t.timeStart,timeEnd:t.timeEnd,isRunning:t.myState.isRunning,currentTime:t.simulationTime},on:{click:t.toggleSimulation,time:t.setTime}}):t._e()],1)}),[],!1,be,"80635506",null,null);function be(t){for(let e in fe)this[e]=fe[e]}var ye=function(){return ve.exports}();
/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.17.0
 * @author George Michael Brower
 * @license MIT
 */class Se{constructor(t,e,i,s,n="div"){this.parent=t,this.object=e,this.property=i,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(s),this.$name=document.createElement("div"),this.$name.classList.add("name"),Se.nextNameID=Se.nextNameID||0,this.$name.id="lil-gui-name-"+ ++Se.nextNameID,this.$widget=document.createElement(n),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(t){return this._name=t,this.$name.innerHTML=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),void 0!==this._onChange&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),void 0!==this._onFinishChange&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled||(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t)),this}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(t){const e=this.parent.add(this.object,this.property,t);return e.name(this._name),this.destroy(),e}min(t){return this}max(t){return this}step(t){return this}decimals(t){return this}listen(t=!0){return this._listening=t,void 0!==this._listenCallbackID&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const t=this.save();t!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=t}getValue(){return this.object[this.property]}setValue(t){return this.object[this.property]=t,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class we extends Se{constructor(t,e,i){super(t,e,i,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",(()=>{this.setValue(this.$input.checked),this._callOnFinishChange()})),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function Ce(t){let e,i;return(e=t.match(/(#|0x)?([a-f0-9]{6})/i))?i=e[2]:(e=t.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?i=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=t.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(i=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!i&&"#"+i}const Te={isPrimitive:!0,match:t=>"string"==typeof t,fromHexString:Ce,toHexString:Ce},Ee={isPrimitive:!0,match:t=>"number"==typeof t,fromHexString:t=>parseInt(t.substring(1),16),toHexString:t=>"#"+t.toString(16).padStart(6,0)},Ae={isPrimitive:!1,match:Array.isArray,fromHexString(t,e,i=1){const s=Ee.fromHexString(t);e[0]=(s>>16&255)/255*i,e[1]=(s>>8&255)/255*i,e[2]=(255&s)/255*i},toHexString:([t,e,i],s=1)=>Ee.toHexString(t*(s=255/s)<<16^e*s<<8^i*s<<0)},ke={isPrimitive:!1,match:t=>Object(t)===t,fromHexString(t,e,i=1){const s=Ee.fromHexString(t);e.r=(s>>16&255)/255*i,e.g=(s>>8&255)/255*i,e.b=(255&s)/255*i},toHexString:({r:t,g:e,b:i},s=1)=>Ee.toHexString(t*(s=255/s)<<16^e*s<<8^i*s<<0)},_e=[Te,Ee,Ae,ke];class xe extends Se{constructor(t,e,i,s){var n;super(t,e,i,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(n=this.initialValue,_e.find((t=>t.match(n)))),this._rgbScale=s,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",(()=>{this._setValueFromHexString(this.$input.value)})),this.$input.addEventListener("blur",(()=>{this._callOnFinishChange()})),this.$text.addEventListener("input",(()=>{const t=Ce(this.$text.value);t&&this._setValueFromHexString(t)})),this.$text.addEventListener("focus",(()=>{this._textFocused=!0,this.$text.select()})),this.$text.addEventListener("blur",(()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()})),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const e=this._format.fromHexString(t);this.setValue(e)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class De extends Se{constructor(t,e,i){super(t,e,i,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",(t=>{t.preventDefault(),this.getValue().call(this.object)})),this.$button.addEventListener("touchstart",(()=>{}),{passive:!0}),this.$disable=this.$button}}class Le extends Se{constructor(t,e,i,s,n,a){super(t,e,i,"number"),this._initInput(),this.min(s),this.max(n);const o=void 0!==a;this.step(o?a:this._getImplicitStep(),o),this.updateDisplay()}decimals(t){return this._decimals=t,this.updateDisplay(),this}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,e=!0){return this._step=t,this._stepExplicit=e,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let e=(t-this._min)/(this._max-this._min);e=Math.max(0,Math.min(e,1)),this.$fill.style.width=100*e+"%"}return this._inputFocused||(this.$input.value=void 0===this._decimals?t:t.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=t=>{const e=parseFloat(this.$input.value);isNaN(e)||(this._snapClampSetValue(e+t),this.$input.value=this.getValue())};let e,i,s,n,a,o=!1;const r=t=>{if(o){const s=t.clientX-e,n=t.clientY-i;Math.abs(n)>5?(t.preventDefault(),this.$input.blur(),o=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(s)>5&&l()}if(!o){const e=t.clientY-s;a-=e*this._step*this._arrowKeyMultiplier(t),n+a>this._max?a=this._max-n:n+a<this._min&&(a=this._min-n),this._snapClampSetValue(n+a)}s=t.clientY},l=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",l)};this.$input.addEventListener("input",(()=>{let t=parseFloat(this.$input.value);isNaN(t)||(this._stepExplicit&&(t=this._snap(t)),this.setValue(this._clamp(t)))})),this.$input.addEventListener("keydown",(e=>{"Enter"===e.code&&this.$input.blur(),"ArrowUp"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e))),"ArrowDown"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e)*-1))})),this.$input.addEventListener("wheel",(e=>{this._inputFocused&&(e.preventDefault(),t(this._step*this._normalizeMouseWheel(e)))}),{passive:!1}),this.$input.addEventListener("mousedown",(t=>{e=t.clientX,i=s=t.clientY,o=!0,n=this.getValue(),a=0,window.addEventListener("mousemove",r),window.addEventListener("mouseup",l)})),this.$input.addEventListener("focus",(()=>{this._inputFocused=!0})),this.$input.addEventListener("blur",(()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()}))}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=t=>{const e=this.$slider.getBoundingClientRect();let i=(s=t,n=e.left,a=e.right,o=this._min,r=this._max,(s-n)/(a-n)*(r-o)+o);var s,n,a,o,r;this._snapClampSetValue(i)},e=e=>{t(e.clientX)},i=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",i)};let s,n,a=!1;const o=e=>{e.preventDefault(),this._setDraggingStyle(!0),t(e.touches[0].clientX),a=!1},r=e=>{if(a){const t=e.touches[0].clientX-s,i=e.touches[0].clientY-n;Math.abs(t)>Math.abs(i)?o(e):(window.removeEventListener("touchmove",r),window.removeEventListener("touchend",l))}else e.preventDefault(),t(e.touches[0].clientX)},l=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",r),window.removeEventListener("touchend",l)},c=this._callOnFinishChange.bind(this);let h;this.$slider.addEventListener("mousedown",(s=>{this._setDraggingStyle(!0),t(s.clientX),window.addEventListener("mousemove",e),window.addEventListener("mouseup",i)})),this.$slider.addEventListener("touchstart",(t=>{t.touches.length>1||(this._hasScrollBar?(s=t.touches[0].clientX,n=t.touches[0].clientY,a=!0):o(t),window.addEventListener("touchmove",r,{passive:!1}),window.addEventListener("touchend",l))}),{passive:!1}),this.$slider.addEventListener("wheel",(t=>{if(Math.abs(t.deltaX)<Math.abs(t.deltaY)&&this._hasScrollBar)return;t.preventDefault();const e=this._normalizeMouseWheel(t)*this._step;this._snapClampSetValue(this.getValue()+e),this.$input.value=this.getValue(),clearTimeout(h),h=setTimeout(c,400)}),{passive:!1})}_setDraggingStyle(t,e="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle(`lil-gui-${e}`,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:e,deltaY:i}=t;Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(e=0,i=-t.wheelDelta/120,i*=this._stepExplicit?1:10);return e+-i}_arrowKeyMultiplier(t){let e=this._stepExplicit?1:10;return t.shiftKey?e*=10:t.altKey&&(e/=10),e}_snap(t){const e=Math.round(t/this._step)*this._step;return parseFloat(e.toPrecision(15))}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return void 0!==this._min}get _hasMax(){return void 0!==this._max}}class ze extends Se{constructor(t,e,i,s){super(t,e,i,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(s)?s:Object.values(s),this._names=Array.isArray(s)?s:Object.keys(s),this._names.forEach((t=>{const e=document.createElement("option");e.innerHTML=t,this.$select.appendChild(e)})),this.$select.addEventListener("change",(()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()})),this.$select.addEventListener("focus",(()=>{this.$display.classList.add("focus")})),this.$select.addEventListener("blur",(()=>{this.$display.classList.remove("focus")})),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const t=this.getValue(),e=this._values.indexOf(t);return this.$select.selectedIndex=e,this.$display.innerHTML=-1===e?t:this._names[e],this}}class Re extends Se{constructor(t,e,i){super(t,e,i,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",(()=>{this.setValue(this.$input.value)})),this.$input.addEventListener("keydown",(t=>{"Enter"===t.code&&this.$input.blur()})),this.$input.addEventListener("blur",(()=>{this._callOnFinishChange()})),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let Fe=!1;class Me{constructor({parent:t,autoPlace:e=void 0===t,container:i,width:s,title:n="Controls",injectStyles:a=!0,touchStyles:o=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",(()=>this.openAnimated(this._closed))),this.$title.addEventListener("keydown",(t=>{"Enter"!==t.code&&"Space"!==t.code||(t.preventDefault(),this.$title.click())})),this.$title.addEventListener("touchstart",(()=>{}),{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(n),o&&this.domElement.classList.add("allow-touch-styles"),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),!Fe&&a&&(!function(t){const e=document.createElement("style");e.innerHTML=t;const i=document.querySelector("head link[rel=stylesheet], head style");i?document.head.insertBefore(e,i):document.head.appendChild(e)}('.lil-gui {\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  line-height: 1;\n  font-weight: normal;\n  font-style: normal;\n  text-align: left;\n  background-color: var(--background-color);\n  color: var(--text-color);\n  user-select: none;\n  -webkit-user-select: none;\n  touch-action: manipulation;\n  --background-color: #1f1f1f;\n  --text-color: #ebebeb;\n  --title-background-color: #111111;\n  --title-text-color: #ebebeb;\n  --widget-color: #424242;\n  --hover-color: #4f4f4f;\n  --focus-color: #595959;\n  --number-color: #2cc9ff;\n  --string-color: #a2db3c;\n  --font-size: 11px;\n  --input-font-size: 11px;\n  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;\n  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;\n  --padding: 4px;\n  --spacing: 4px;\n  --widget-height: 20px;\n  --name-width: 45%;\n  --slider-knob-width: 2px;\n  --slider-input-width: 27%;\n  --color-input-width: 27%;\n  --slider-input-min-width: 45px;\n  --color-input-min-width: 45px;\n  --folder-indent: 7px;\n  --widget-padding: 0 0 0 3px;\n  --widget-border-radius: 2px;\n  --checkbox-size: calc(0.75 * var(--widget-height));\n  --scrollbar-width: 5px;\n}\n.lil-gui, .lil-gui * {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n.lil-gui.root {\n  width: var(--width, 245px);\n  display: flex;\n  flex-direction: column;\n}\n.lil-gui.root > .title {\n  background: var(--title-background-color);\n  color: var(--title-text-color);\n}\n.lil-gui.root > .children {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.lil-gui.root > .children::-webkit-scrollbar {\n  width: var(--scrollbar-width);\n  height: var(--scrollbar-width);\n  background: var(--background-color);\n}\n.lil-gui.root > .children::-webkit-scrollbar-thumb {\n  border-radius: var(--scrollbar-width);\n  background: var(--focus-color);\n}\n@media (pointer: coarse) {\n  .lil-gui.allow-touch-styles {\n    --widget-height: 28px;\n    --padding: 6px;\n    --spacing: 6px;\n    --font-size: 13px;\n    --input-font-size: 16px;\n    --folder-indent: 10px;\n    --scrollbar-width: 7px;\n    --slider-input-min-width: 50px;\n    --color-input-min-width: 65px;\n  }\n}\n.lil-gui.force-touch-styles {\n  --widget-height: 28px;\n  --padding: 6px;\n  --spacing: 6px;\n  --font-size: 13px;\n  --input-font-size: 16px;\n  --folder-indent: 10px;\n  --scrollbar-width: 7px;\n  --slider-input-min-width: 50px;\n  --color-input-min-width: 65px;\n}\n.lil-gui.autoPlace {\n  max-height: 100%;\n  position: fixed;\n  top: 0;\n  right: 15px;\n  z-index: 1001;\n}\n\n.lil-gui .controller {\n  display: flex;\n  align-items: center;\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n}\n.lil-gui .controller.disabled {\n  opacity: 0.5;\n}\n.lil-gui .controller.disabled, .lil-gui .controller.disabled * {\n  pointer-events: none !important;\n}\n.lil-gui .controller > .name {\n  min-width: var(--name-width);\n  flex-shrink: 0;\n  white-space: pre;\n  padding-right: var(--spacing);\n  line-height: var(--widget-height);\n}\n.lil-gui .controller .widget {\n  position: relative;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  min-height: var(--widget-height);\n}\n.lil-gui .controller.string input {\n  color: var(--string-color);\n}\n.lil-gui .controller.boolean .widget {\n  cursor: pointer;\n}\n.lil-gui .controller.color .display {\n  width: 100%;\n  height: var(--widget-height);\n  border-radius: var(--widget-border-radius);\n  position: relative;\n}\n@media (hover: hover) {\n  .lil-gui .controller.color .display:hover:before {\n    content: " ";\n    display: block;\n    position: absolute;\n    border-radius: var(--widget-border-radius);\n    border: 1px solid #fff9;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n  }\n}\n.lil-gui .controller.color input[type=color] {\n  opacity: 0;\n  width: 100%;\n  height: 100%;\n  cursor: pointer;\n}\n.lil-gui .controller.color input[type=text] {\n  margin-left: var(--spacing);\n  font-family: var(--font-family-mono);\n  min-width: var(--color-input-min-width);\n  width: var(--color-input-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.option select {\n  opacity: 0;\n  position: absolute;\n  width: 100%;\n  max-width: 100%;\n}\n.lil-gui .controller.option .display {\n  position: relative;\n  pointer-events: none;\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  line-height: var(--widget-height);\n  max-width: 100%;\n  overflow: hidden;\n  word-break: break-all;\n  padding-left: 0.55em;\n  padding-right: 1.75em;\n  background: var(--widget-color);\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .display.focus {\n    background: var(--focus-color);\n  }\n}\n.lil-gui .controller.option .display.active {\n  background: var(--focus-color);\n}\n.lil-gui .controller.option .display:after {\n  font-family: "lil-gui";\n  content: "↕";\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  padding-right: 0.375em;\n}\n.lil-gui .controller.option .widget,\n.lil-gui .controller.option select {\n  cursor: pointer;\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .widget:hover .display {\n    background: var(--hover-color);\n  }\n}\n.lil-gui .controller.number input {\n  color: var(--number-color);\n}\n.lil-gui .controller.number.hasSlider input {\n  margin-left: var(--spacing);\n  width: var(--slider-input-width);\n  min-width: var(--slider-input-min-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.number .slider {\n  width: 100%;\n  height: var(--widget-height);\n  background-color: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  padding-right: var(--slider-knob-width);\n  overflow: hidden;\n  cursor: ew-resize;\n  touch-action: pan-y;\n}\n@media (hover: hover) {\n  .lil-gui .controller.number .slider:hover {\n    background-color: var(--hover-color);\n  }\n}\n.lil-gui .controller.number .slider.active {\n  background-color: var(--focus-color);\n}\n.lil-gui .controller.number .slider.active .fill {\n  opacity: 0.95;\n}\n.lil-gui .controller.number .fill {\n  height: 100%;\n  border-right: var(--slider-knob-width) solid var(--number-color);\n  box-sizing: content-box;\n}\n\n.lil-gui-dragging .lil-gui {\n  --hover-color: var(--widget-color);\n}\n.lil-gui-dragging * {\n  cursor: ew-resize !important;\n}\n\n.lil-gui-dragging.lil-gui-vertical * {\n  cursor: ns-resize !important;\n}\n\n.lil-gui .title {\n  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);\n  height: var(--title-height);\n  line-height: calc(var(--title-height) - 4px);\n  font-weight: 600;\n  padding: 0 var(--padding);\n  -webkit-tap-highlight-color: transparent;\n  cursor: pointer;\n  outline: none;\n  text-decoration-skip: objects;\n}\n.lil-gui .title:before {\n  font-family: "lil-gui";\n  content: "▾";\n  padding-right: 2px;\n  display: inline-block;\n}\n.lil-gui .title:active {\n  background: var(--title-background-color);\n  opacity: 0.75;\n}\n@media (hover: hover) {\n  body:not(.lil-gui-dragging) .lil-gui .title:hover {\n    background: var(--title-background-color);\n    opacity: 0.85;\n  }\n  .lil-gui .title:focus {\n    text-decoration: underline var(--focus-color);\n  }\n}\n.lil-gui.root > .title:focus {\n  text-decoration: none !important;\n}\n.lil-gui.closed > .title:before {\n  content: "▸";\n}\n.lil-gui.closed > .children {\n  transform: translateY(-7px);\n  opacity: 0;\n}\n.lil-gui.closed:not(.transition) > .children {\n  display: none;\n}\n.lil-gui.transition > .children {\n  transition-duration: 300ms;\n  transition-property: height, opacity, transform;\n  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);\n  overflow: hidden;\n  pointer-events: none;\n}\n.lil-gui .children:empty:before {\n  content: "Empty";\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n  display: block;\n  height: var(--widget-height);\n  font-style: italic;\n  line-height: var(--widget-height);\n  opacity: 0.5;\n}\n.lil-gui.root > .children > .lil-gui > .title {\n  border: 0 solid var(--widget-color);\n  border-width: 1px 0;\n  transition: border-color 300ms;\n}\n.lil-gui.root > .children > .lil-gui.closed > .title {\n  border-bottom-color: transparent;\n}\n.lil-gui + .controller {\n  border-top: 1px solid var(--widget-color);\n  margin-top: 0;\n  padding-top: var(--spacing);\n}\n.lil-gui .lil-gui .lil-gui > .title {\n  border: none;\n}\n.lil-gui .lil-gui .lil-gui > .children {\n  border: none;\n  margin-left: var(--folder-indent);\n  border-left: 2px solid var(--widget-color);\n}\n.lil-gui .lil-gui .controller {\n  border: none;\n}\n\n.lil-gui input {\n  -webkit-tap-highlight-color: transparent;\n  border: 0;\n  outline: none;\n  font-family: var(--font-family);\n  font-size: var(--input-font-size);\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  background: var(--widget-color);\n  color: var(--text-color);\n  width: 100%;\n}\n@media (hover: hover) {\n  .lil-gui input:hover {\n    background: var(--hover-color);\n  }\n  .lil-gui input:active {\n    background: var(--focus-color);\n  }\n}\n.lil-gui input:disabled {\n  opacity: 1;\n}\n.lil-gui input[type=text],\n.lil-gui input[type=number] {\n  padding: var(--widget-padding);\n}\n.lil-gui input[type=text]:focus,\n.lil-gui input[type=number]:focus {\n  background: var(--focus-color);\n}\n.lil-gui input::-webkit-outer-spin-button,\n.lil-gui input::-webkit-inner-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n.lil-gui input[type=number] {\n  -moz-appearance: textfield;\n}\n.lil-gui input[type=checkbox] {\n  appearance: none;\n  -webkit-appearance: none;\n  height: var(--checkbox-size);\n  width: var(--checkbox-size);\n  border-radius: var(--widget-border-radius);\n  text-align: center;\n  cursor: pointer;\n}\n.lil-gui input[type=checkbox]:checked:before {\n  font-family: "lil-gui";\n  content: "✓";\n  font-size: var(--checkbox-size);\n  line-height: var(--checkbox-size);\n}\n@media (hover: hover) {\n  .lil-gui input[type=checkbox]:focus {\n    box-shadow: inset 0 0 0 1px var(--focus-color);\n  }\n}\n.lil-gui button {\n  -webkit-tap-highlight-color: transparent;\n  outline: none;\n  cursor: pointer;\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  color: var(--text-color);\n  width: 100%;\n  height: var(--widget-height);\n  text-transform: none;\n  background: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  border: 1px solid var(--widget-color);\n  text-align: center;\n  line-height: calc(var(--widget-height) - 4px);\n}\n@media (hover: hover) {\n  .lil-gui button:hover {\n    background: var(--hover-color);\n    border-color: var(--hover-color);\n  }\n  .lil-gui button:focus {\n    border-color: var(--focus-color);\n  }\n}\n.lil-gui button:active {\n  background: var(--focus-color);\n}\n\n@font-face {\n  font-family: "lil-gui";\n  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");\n}'),Fe=!0),i?i.appendChild(this.domElement):e&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),s&&this.domElement.style.setProperty("--width",s+"px"),this.domElement.addEventListener("keydown",(t=>t.stopPropagation())),this.domElement.addEventListener("keyup",(t=>t.stopPropagation()))}add(t,e,i,s,n){if(Object(i)===i)return new ze(this,t,e,i);const a=t[e];switch(typeof a){case"number":return new Le(this,t,e,i,s,n);case"boolean":return new we(this,t,e);case"string":return new Re(this,t,e);case"function":return new De(this,t,e)}console.error("gui.add failed\n\tproperty:",e,"\n\tobject:",t,"\n\tvalue:",a)}addColor(t,e,i=1){return new xe(this,t,e,i)}addFolder(t){return new Me({parent:this,title:t})}load(t,e=!0){return t.controllers&&this.controllers.forEach((e=>{e instanceof De||e._name in t.controllers&&e.load(t.controllers[e._name])})),e&&t.folders&&this.folders.forEach((e=>{e._title in t.folders&&e.load(t.folders[e._title])})),this}save(t=!0){const e={controllers:{},folders:{}};return this.controllers.forEach((t=>{if(!(t instanceof De)){if(t._name in e.controllers)throw new Error(`Cannot save GUI with duplicate property "${t._name}"`);e.controllers[t._name]=t.save()}})),t&&this.folders.forEach((t=>{if(t._title in e.folders)throw new Error(`Cannot save GUI with duplicate folder "${t._title}"`);e.folders[t._title]=t.save()})),e}open(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._closed=!t,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame((()=>{const e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const i=t=>{t.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",i))};this.$children.addEventListener("transitionend",i);const s=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame((()=>{this.$children.style.height=s+"px"}))})),this}title(t){return this._title=t,this.$title.innerHTML=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach((t=>t.reset())),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),void 0!==this._onChange&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),void 0!==this._onFinishChange&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach((t=>t.destroy()))}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach((e=>{t=t.concat(e.controllersRecursive())})),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach((e=>{t=t.concat(e.foldersRecursive())})),t}}var Oe,Pe;(Pe=Oe||(Oe={}))[Pe.SLIDE=0]="SLIDE",Pe[Pe.START=1]="START",Pe[Pe.END=2]="END";var $e=d({name:"TimeSlider",props:{labels:Array,range:Array,activeTimeExtent:Array,isAnimating:Boolean},data:()=>({state:{componentWidth:0,dragStartX:0,dragType:0,isDragging:!1,isSetupComplete:!1,leftPosition:0,rightPosition:1,datasetRange:[0,86400],labels:["",""]},id:"id-"+Math.floor(1e12*Math.random()),resizer:null}),computed:{fullDatasetTimeSpan(){return this.state.datasetRange[1]-this.state.datasetRange[0]},extentLeftToRight(){return this.state.rightPosition-this.state.leftPosition},hasNonZeroTimeRange(){return!!this.fullDatasetTimeSpan},calculateActiveMargins(){const t=this.state.componentWidth-12;return{marginLeft:`${Math.floor(t*this.state.leftPosition)}px`,marginRight:`${Math.floor(t*(1-this.state.rightPosition))}px`}}},mounted(){this.getDimensions(),this.setupInitialValues(),this.setupResizer(),window.addEventListener("mouseup",this.dragEnd),window.addEventListener("mousemove",this.dragging)},beforeDestroy(){window.removeEventListener("mouseup",this.dragEnd),window.removeEventListener("mousemove",this.dragging)},watch:{activeTimeExtent(){this.updateExtent()},labels(){this.updateLabels()},"state.leftPosition"(){this.emitValues()},"state.rightPosition"(){this.emitValues()}},methods:{setupResizer(){try{this.resizer=new ResizeObserver(this.getDimensions);const t=document.getElementById(`id-${this.id}`);this.resizer.observe(t)}catch(t){console.error(""+t)}},setupInitialValues(){try{this.range&&(this.state.datasetRange=this.range),0===this.fullDatasetTimeSpan?(this.state.leftPosition=0,this.state.rightPosition=1):this.updateExtent()}catch(t){console.error(""+t)}finally{this.state.isSetupComplete=!0}},updateExtent(){this.activeTimeExtent&&(this.state.leftPosition=(this.activeTimeExtent[0]-this.state.datasetRange[0])/this.fullDatasetTimeSpan,this.state.rightPosition=(this.activeTimeExtent[1]-this.state.datasetRange[0])/this.fullDatasetTimeSpan)},updateLabels(){this.labels&&(this.state.labels=this.labels)},emitValues(){if(!this.state.isSetupComplete)return;const t=this.state.datasetRange[0]+this.state.leftPosition*this.fullDatasetTimeSpan,e=this.state.datasetRange[0]+this.state.rightPosition*this.fullDatasetTimeSpan;this.$emit("timeExtent",[t,e])},getDimensions(){var t;this.state.componentWidth=(null==(t=this.$refs.slider)?void 0:t.clientWidth)||0},dragStart(t){this.$emit("drag"),this.state.isDragging=!0,this.state.dragStartX=t.clientX;const e=this.state.componentWidth-12,i=Math.floor(e*this.state.leftPosition),s=Math.floor(e*(1-this.state.rightPosition)),n=this.state.componentWidth-s-i-12;t.offsetX>=0&&t.offsetX<n?this.state.dragType=0:t.offsetX<0?this.state.dragType=1:t.offsetX>n&&(this.state.dragType=2)},dragging(t){if(!this.state.isDragging)return;const e=t.clientX-this.state.dragStartX,i=this.state.componentWidth-12;if(0==this.state.dragType){const s=this.extentLeftToRight;let n=(i*this.state.leftPosition+e)/i,a=n+s;return n<0&&(n=0,a=s),a>1&&(a=1,n=a-s),this.state.leftPosition=n,this.state.rightPosition=a,void(this.state.dragStartX=t.clientX)}if(1==this.state.dragType){const s=i*this.state.leftPosition+e;return this.state.leftPosition=Math.max(0,s/i),this.state.leftPosition>this.state.rightPosition&&(this.state.rightPosition=this.state.leftPosition),void(this.state.dragStartX=t.clientX)}if(2==this.state.dragType){const s=i*this.state.rightPosition+e;return this.state.rightPosition=Math.min(1,s/i),this.state.leftPosition>this.state.rightPosition&&(this.state.leftPosition=this.state.rightPosition),void(this.state.dragStartX=t.clientX)}},dragEnd(t){this.state.isDragging=!1}}});const Ie={};var Ne=bt($e,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.hasNonZeroTimeRange?i("div",{staticClass:"time-slider-component",attrs:{id:`id-${t.id}`}},[i("div",{staticClass:"label-area"},[i("p",{staticClass:"p1"},[t._v(t._s(t.state.labels[0]))]),i("p",{directives:[{name:"show",rawName:"v-show",value:void 0!==t.state.labels[1],expression:"state.labels[1] !== undefined"}],staticClass:"p2"},[t._v(" - "+t._s(t.state.labels[1]))])]),i("div",{staticClass:"slider-area"},[i("button",{staticClass:"button play-button",attrs:{size:"is-small",type:"is-link"},on:{click:function(e){return t.$emit("toggleAnimation")}}},[t._v(t._s(t.isAnimating?"| |":">"))]),i("div",{ref:"slider",staticClass:"time-slider-dragger",on:{mousemove:t.dragging}},[i("div",{staticClass:"active-region",style:t.calculateActiveMargins,on:{mousedown:t.dragStart,mouseup:function(e){return e.stopPropagation(),t.dragEnd.apply(null,arguments)},mousemove:function(e){return e.stopPropagation(),t.dragging.apply(null,arguments)}}})])])]):t._e()}),[],!1,He,"fd6ae4cc",null,null);function He(t){for(let e in Ie)this[e]=Ie[e]}var je=function(){return Ne.exports}();const Be={marker:{x:0,y:0,width:128,height:128,mask:!0},info:{x:128,y:0,width:128,height:128,mask:!0},vehicle:{x:128,y:128,width:128,height:128,mask:!0},diamond:{x:0,y:128,width:128,height:128,mask:!1}},Ve=new J({filterSize:1}),We={pitch:0,zoom:8,bearing:0,longitude:14,latitude:52};const qe=d({name:"EventViewerPlugin",i18n:{messages:{en:{loading:"Loading data...",sorting:"Sorting into bins...",aggregate:"Summary",maxHeight:"3D Height",showDetails:"Show Details",selection:"Selection",areas:"Areas",count:"Count",promptCRS:'Enter the coordinate reference system, e.g. EPSG:25832\n\nThese coordinates are not in long/lat format. To fix this permanently, convert them to long/lat or add "# EPSG:xxxx" to your CSV header'},de:{loading:"Dateien laden...",sorting:"Sortieren...",aggregate:"Daten",maxHeight:"3-D Höhe",showDetails:"Details anzeigen",selection:"Ausgewählt",areas:"Orte",count:"Anzahl"}}},components:{CollapsiblePanel:H,DrawingTool:Z,EventMap:function({viewId:t=0,eventLayers:e=[],network:i={},linkIdLookup:s={},timeFilter:n=[],dark:a=!1,colors:o=[[1,0,0],[.25,.25,1]],breakpoints:r=[0],radius:l=5,mapIsIndependent:c=!1,simulationTime:d=2e4}){const[m,g]=u.exports.useState(We);function p(t){return t.index<0?null:"hi"}St[t]=()=>{g(yt.state.viewState)};const f=[...e.map(((t,i)=>{const s=t.times[0]>n[1]||t.times[t.times.length-1]<n[0];return new K({data:{length:t.times.length,attributes:{getFilterValue:{value:t.times,size:1},getPosition:{value:t.positions,size:2}}},autoHighlight:!0,breakpoints:r,colors:o,extensions:[Ve],id:"hello"+i,filled:!0,filterRange:n.length?n:null,getRadius:20,getFillColor:[240,128,10],highlightColor:[255,0,224],opacity:1,parameters:{depthTest:!1},pickable:!0,radiusScale:1,stroked:!1,updateTriggers:{getPosition:e,getFilterValue:n},visible:!s})})),...e.map(((t,e)=>{const i=t.vehicles.t0[0]>n[1]||t.vehicles.t1[t.vehicles.t1.length-1]<n[0];return new ae({data:{length:t.vehicles.t0.length,attributes:{getTimeStart:{value:t.vehicles.t0,size:1},getTimeEnd:{value:t.vehicles.t1,size:1},getPathStart:{value:t.vehicles.locO,size:2},getPathEnd:{value:t.vehicles.locD,size:2}}},id:"vehicles"+e,getColor:[64,96,255],iconMoving:"vehicle",iconStill:"diamond",getSize:20,opacity:1,currentTime:d,shadowEnabled:!0,iconAtlas:"/report-tncs2020-simwrapper//images/icon-atlas.png",iconMapping:Be,sizeScale:1,billboard:!1,pickable:!0,depthTest:!0,autoHighlight:!1,highlightColor:[255,0,255],parameters:{depthTest:!1},visible:!i})}))];return h.createElement(I,{layers:f,controller:!0,useDevicePixels:!0,viewState:m,onViewStateChange:t=>{var e;(e=t.viewState).latitude&&(e.center||(e.center=[0,0]),e.center[0]=e.longitude,e.center[1]=e.latitude,g(e),c||yt.commit("setMapCamera",e))},pickingRadius:4,onClick:p,getTooltip:p},h.createElement(N,{mapStyle:yt.getters.mapStyle,preventStyleDiffing:!0,mapboxApiAccessToken:wt}))},LegendBox:Q,TimeSlider:je,ZoomButtons:j},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,config:Object,thumbnail:Boolean,datamanager:{type:Object}},data:()=>({myDataManager:null,network:{source:new Float32Array,dest:new Float32Array,linkIds:[]},linkIdLookup:{},guiConfig:{buckets:7,exponent:4,radius:5,"clip max":100,"color ramp":"viridis",flip:!1,colorRamps:["bathymetry","electric","inferno","jet","magma","par","viridis"]},viewId:"xyt-id-"+Math.floor(1e12*Math.random()),configId:"gui-config-"+Math.floor(1e12*Math.random()),timeLabels:[0,1],startTime:0,isAnimating:!1,timeFilter:[0,3599],colors:[[128,128,128],[128,128,128]],breakpoints:[0],range:[1/0,-1/0],timeRange:[1/0,-1/0],legendStore:null,standaloneYAMLconfig:{title:"",description:"",file:"",projection:"",thumbnail:"",radius:250,maxHeight:0,center:null,zoom:9},YAMLrequirementsXY:{file:""},columnLookup:[],gzipWorker:null,vizDetails:{title:"",description:"",file:"",projection:"",thumbnail:"",center:null,zoom:9},myState:{statusMessage:"",subfolder:"",yamlConfig:"",thumbnail:!1},eventLayers:[],isLoaded:!1,animator:null,guiController:null,resizer:null,thumbnailUrl:"url('assets/thumbnail.jpg') no-repeat;",ANIMATE_SPEED:.25,animationElapsedTime:0,animationClockTime:0}),computed:{fileApi(){return new S(this.fileSystem,yt)},fileSystem(){const t=this.$store.state.svnProjects.filter((t=>t.slug===this.root));if(0===t.length)throw console.log("no such project"),Error;return t[0]},urlThumbnail(){return this.thumbnailUrl}},watch:{"$store.state.viewState"(){St[this.viewId]&&St[this.viewId]()}},methods:{handleTimeSliderValues(t){this.animationElapsedTime=t[0],this.timeFilter=t,this.timeLabels=[this.convertSecondsToClockTimeMinutes(t[0]),this.convertSecondsToClockTimeMinutes(t[1])]},setupLogoMover(){this.resizer=new ResizeObserver(this.moveLogo);const t=document.getElementById(`id-${this.viewId}`);this.resizer.observe(t)},moveLogo(){const t=document.getElementById(`${this.viewId}`),e=null==t?void 0:t.querySelector(".mapboxgl-ctrl-bottom-left");if(e){const i=t.clientWidth>640?"280px":"36px";e.style.right=i}},setupGui(){this.guiController=new Me({title:"Color Settings",injectStyles:!0,width:200,container:document.getElementById(this.configId)||void 0});const t=this.guiController;t.add(this.guiConfig,"buckets",2,19,1).onChange(this.setColors),t.add(this.guiConfig,"exponent",1,10,1).onChange(this.setColors),t.add(this.guiConfig,"clip max",0,100,1).onChange(this.setColors),t.add(this.guiConfig,"radius",1,20,1),t.add(this.guiConfig,"color ramp",this.guiConfig.colorRamps).onChange(this.setColors),t.add(this.guiConfig,"flip").onChange(this.setColors)},async solveProjection(){if(!this.thumbnail){console.log("WHAT PROJECTION:");try{const t=await this.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);this.vizDetails=q.parse(t)}catch(t){console.error(t)}}},async getVizDetails(){if(this.config)return this.validateYAML(),void(this.vizDetails=Object.assign({},this.config));new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig)?await this.loadStandaloneYAMLConfig():this.setConfigForRawCSV()},setConfigForRawCSV(){this.vizDetails={title:"EVENTS: "+this.myState.yamlConfig,description:this.myState.yamlConfig,file:this.myState.yamlConfig,projection:"EPSG:4326",center:this.vizDetails.center,zoom:this.vizDetails.zoom},this.$emit("title",this.vizDetails.title||this.vizDetails.file)},async loadStandaloneYAMLConfig(){if(this.fileApi)try{const t=this.myState.yamlConfig.indexOf("/")>-1?this.myState.yamlConfig:this.myState.subfolder+"/"+this.myState.yamlConfig,e=await this.fileApi.getFileText(t);this.standaloneYAMLconfig=Object.assign({},q.parse(e)),this.validateYAML(),this.setVizDetails()}catch(t){console.log("failed"),this.$store.commit("setStatus",{type:Et.ERROR,msg:"File not found",desc:`Could not find: ${this.myState.subfolder}/${this.myState.yamlConfig}`})}},validateYAML(){let t;new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig)?(console.log("has yaml"),t=this.standaloneYAMLconfig):(console.log("no yaml"),t=this.config);for(const e in this.YAMLrequirementsXY)e in t==!1&&this.$store.commit("setStatus",{type:Et.ERROR,msg:`YAML file missing required key: ${e}`,desc:"Check this.YAMLrequirementsXY for required keys"});0==t.radius&&this.$store.commit("setStatus",{type:Et.WARNING,msg:"Radius set to zero",desc:"Radius can not be zero, preset value used instead. "}),(t.zoom<5||t.zoom>20)&&this.$store.commit("setStatus",{type:Et.WARNING,msg:"Zoom is out of the recommended range ",desc:"Zoom levels should be between 5 and 20. "})},setVizDetails(){this.vizDetails=Object.assign({},this.vizDetails,this.standaloneYAMLconfig);const t=this.vizDetails.title?this.vizDetails.title:"EVENTS: "+this.vizDetails.file;this.$emit("title",t)},async buildThumbnail(){if(this.thumbnail&&this.vizDetails.thumbnail)try{const t=await this.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail),e=await t.arrayBuffer(),i=tt.arrayBufferToBase64(e);i&&(this.thumbnailUrl=`center / cover no-repeat url(data:image/png;base64,${i})`)}catch(t){console.error(t)}},async streamEventFile(t){this.myState.statusMessage="Loading file...";let e=0;this.range=[1/0,-1/0],this.timeRange=[1/0,-1/0],this.animationElapsedTime=0,this.timeFilter=[0,59],this.gzipWorker&&this.gzipWorker.terminate(),this.eventLayers=[],this.gzipWorker=new Vt;const i=Intl.NumberFormat();this.gzipWorker.onmessage=async t=>{const s=t.data;if(s.status)this.myState.statusMessage=s.status;else if(s.error)this.myState.statusMessage=s.error,this.$store.commit("setStatus",{type:Et.ERROR,msg:"XYT Loading Error",desc:`Error loading: ${this.myState.subfolder}/${this.vizDetails.file}`});else if(s.finished)this.finishedLoadingData(e,s);else{const t=s.events;console.log(t.length),e+=t.length,this.myState.statusMessage="Loading "+i.format(e)+" events",this.timeRange=[Math.min(this.timeRange[0],t[0].time),Math.max(this.timeRange[1],t[t.length-1].time)],this.timeRange=[Math.min(this.timeRange[0],s.vehicleTrips[0].t0),Math.max(this.timeRange[1],s.vehicleTrips[s.vehicleTrips.length-1].t1)];const n=t.map((t=>({time:t.time,link:t.link}))),a=new Float32Array(2*n.length).fill(NaN);for(let e=0;e<n.length;e++){const t=2*this.linkIdLookup[n[e].link];a[2*e]=this.network.source[t],a[2*e+1]=this.network.source[t+1]}const o=s.vehicleTrips.length,r={locO:new Float32Array(2*o).fill(NaN),locD:new Float32Array(2*o).fill(NaN),t0:new Float32Array(o).fill(NaN),t1:new Float32Array(o).fill(NaN)};for(let e=0;e<o;e++){const t=s.vehicleTrips[e],i=2*this.linkIdLookup[t.link];r.locO[2*e+0]=this.network.source[0+i],r.locO[2*e+1]=this.network.source[1+i],r.locD[2*e+0]=this.network.dest[0+i],r.locD[2*e+1]=this.network.dest[1+i],0==e?(r.locO[2*e+0]=.5*(r.locO[2*e+0]+r.locD[2*e+0]),r.locO[2*e+1]=.5*(r.locO[2*e+1]+r.locD[2*e+1])):e==o-1&&(r.locD[2*e+0]=.5*(r.locO[2*e+0]+r.locD[2*e+0]),r.locD[2*e+1]=.5*(r.locO[2*e+1]+r.locD[2*e+1])),r.t0[e]=t.t0,r.t1[e]=t.t1}this.eventLayers.push({events:t.slice(1,2),positions:a,vehicles:r,times:s.times})}},this.gzipWorker.postMessage({filePath:t,fileSystem:this.fileSystem,projection:this.vizDetails.projection})},setFirstZoom(t,e){const i=.5*(t[0]+t[2*e-2]),s=.5*(t[1]+t[2*e-1]);Number.isFinite(i)&&Number.isFinite(s)&&yt.commit("setMapCamera",Object.assign({},yt.state.viewState,{longitude:i,latitude:s,zoom:10}))},finishedLoadingData(t,e){this.isLoaded=!0,this.range=e.range,this.myState.statusMessage="",this.timeFilter=[this.timeRange[0],this.timeRange[0]+59],this.gzipWorker&&this.gzipWorker.terminate(),this.setColors(),this.moveLogo(),console.log("ALL DONE",{totalRows:t,data:e.range,time:this.timeRange,layers:this.eventLayers.length})},toggleAnimation(){this.isAnimating=!this.isAnimating,this.isAnimating&&(this.animationElapsedTime=this.timeFilter[0]-this.timeRange[0],this.startTime=Date.now()-this.animationElapsedTime/this.ANIMATE_SPEED,this.animate())},setColors(){const t=this.guiConfig.exponent;let e=et({colormap:this.guiConfig["color ramp"],nshades:256,format:"rba",alpha:1}).map((t=>[t[0],t[1],t[2]]));this.guiConfig.flip&&(e=e.reverse());const i=256/(this.guiConfig.buckets-1),s=[];for(let o=0;o<this.guiConfig.buckets-1;o++)s.push(e[Math.round(i*o)]);s.push(e[255]);const n=Math.pow(this.range[1],1/t)*this.guiConfig["clip max"]/100,a=[];for(let o=1;o<this.guiConfig.buckets;o++){const e=n*o/this.guiConfig.buckets,i=Math.pow(e,t);a.push(i)}this.isLoaded&&this.setLegend(s,a),this.colors=s,this.breakpoints=a},setLegend(t,e){this.range[1]-this.range[0]!=0&&(this.legendStore=new it,this.legendStore.setLegendSection({section:"Legend",column:"Legend",values:t.map(((i,s)=>{const n=e[0==s?s:s-1];let a=""+Math.round(1e6*n)/1e6;return 0==s&&(a="< "+a),s==t.length-1&&(a="> "+a),{label:a,value:i}}))}))},async loadNetwork(){if(!this.myDataManager)throw Error("event viewer: no datamanager");let t=this.vizDetails.file.replace("events.xml","network.xml");const e=await this.myDataManager.getRoadNetwork(t,this.myState.subfolder,Object.assign({projection:"25833"},this.vizDetails)),i={};let s=0;for(const n of e.linkIds)i[`${n}`]=s,s++;return{network:e,linkIdLookup:i}},async loadFiles(){const{network:t,linkIdLookup:e}=await this.loadNetwork();this.network=t,this.linkIdLookup=e;if(!this.fileApi)return{dataArray:[]};try{let t=`${this.myState.subfolder}/${this.vizDetails.file}`;await this.streamEventFile(t)}catch(i){console.error(i),this.myState.statusMessage=""+i,this.$store.commit("setStatus",{type:Et.ERROR,msg:"Loading/Parsing Error",desc:"Error loading/parsing: ${this.myState.subfolder}/${this.vizDetails.file}"})}},animate(){if(!this.isAnimating)return;this.animationElapsedTime=this.ANIMATE_SPEED*(Date.now()-this.startTime),this.animationClockTime=this.animationElapsedTime+this.timeRange[0],this.animationClockTime>this.timeRange[1]&&(this.startTime=Date.now(),this.animationElapsedTime=0);const t=this.timeFilter[1]-this.timeFilter[0];this.timeFilter=[this.animationClockTime,this.animationClockTime+t],this.animator=window.requestAnimationFrame(this.animate)},convertSecondsToClockTimeMinutes(t){const e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),s=t-3600*e-60*i,n=`${e}`,a=`${i}`.padStart(2,"0");`${s}`.padStart(2,"0");return`${n}:${a}`}},async mounted(){this.$store.commit("setFullScreen",!this.thumbnail),this.myState.thumbnail=this.thumbnail,this.myState.yamlConfig=this.yamlConfig||"",this.myState.subfolder=this.subfolder,this.myDataManager=this.datamanager||new V(this.root,this.subfolder),await this.getVizDetails(),await this.buildThumbnail(),this.thumbnail||(this.setupLogoMover(),this.myState.statusMessage=`${this.$i18n.t("loading")}`,this.isLoaded||await this.loadFiles())},beforeDestroy(){St[this.viewId]=void 0,delete St[this.viewId];try{this.gzipWorker&&(this.gzipWorker.postMessage({terminate:!0}),this.gzipWorker.terminate()),this.guiController&&this.guiController.destroy()}catch(t){console.warn(t)}this.animator&&window.cancelAnimationFrame(this.animator),this.$store.commit("setFullScreen",!1)}});yt.commit("registerPlugin",{kebabName:"events",prettyName:"Event Viewer",description:"MATSim event viewer",filePatterns:["**/viz-events*.y?(a)ml","**/*events.xml?(.gz)"],component:qe});const Ue={};var Ge=bt(qe,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"viz-plugin",attrs:{oncontextmenu:"return false",id:`id-${t.viewId}`}},[!t.thumbnail&&t.isLoaded?i("event-map",{staticClass:"map-layer",attrs:{viewId:t.viewId,eventLayers:t.eventLayers,network:t.network,linkIdLookup:t.linkIdLookup,timeFilter:t.timeFilter,dark:this.$store.state.isDarkMode,colors:this.colors,breakpoints:this.breakpoints,radius:this.guiConfig.radius,mapIsIndependent:!1,simulationTime:t.timeFilter[1]}}):t._e(),t.thumbnail?t._e():i("zoom-buttons",{attrs:{corner:"bottom"}}),i("div",{staticClass:"top-right"},[i("div",{staticClass:"gui-config",attrs:{id:t.configId}})]),i("div",{staticClass:"bottom-right"},[t.legendStore?i("div",{staticClass:"legend-area"},[i("legend-box",{attrs:{legendStore:t.legendStore}})],1):t._e()]),t.isLoaded?i("time-slider",{staticClass:"time-slider-area",attrs:{range:t.timeRange,activeTimeExtent:t.timeFilter,labels:t.timeLabels,isAnimating:t.isAnimating},on:{timeExtent:t.handleTimeSliderValues,toggleAnimation:t.toggleAnimation,drag:function(e){t.isAnimating=!1}}}):t._e(),!t.thumbnail&&t.myState.statusMessage?i("div",{staticClass:"message"},[i("p",{staticClass:"status-message"},[t._v(t._s(t.myState.statusMessage))])]):t._e()],1)}),[],!1,Ye,"288826ae",null,null);function Ye(t){for(let e in Ue)this[e]=Ue[e]}var Xe=function(){return Ge.exports}();var Je=d({name:"XmasSettingsPanel",i18n:{messages:{en:{requests:"DRT&nbsp;Requests",passengers:"Passengers",search:"Search",showhide:"Show/Hide",vehicles:"DRT Vehicles",routes:"Routes",speed:"Speed",backgroundTraffic:"All Traffic"},de:{requests:"DRT&nbsp;Anfragen",passengers:"Passagiere",search:"Suche",showhide:"Ein-/Ausblenden",vehicles:"DRT Fahrzeuge",routes:"Routen",speed:"Geschwindigkeit",backgroundTraffic:"Alle Fahrzeuge"}}},components:{ToggleButton:y.exports.ToggleButton},props:{items:{type:Object,required:!0}}});const Ke={};var Ze=bt(Je,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"settings-panel-content"},[i("h4",[t._v(t._s(t.$t("showhide")))]),t._l(Object.keys(t.items),(function(e){return i("div",{key:e,staticClass:"row"},[i("toggle-button",{staticClass:"toggle",attrs:{width:40,value:t.items[e],labels:!1,color:{checked:"#4b7cc4",unchecked:"#222"}},on:{change:function(i){return t.$emit("click",e)}}}),i("label",{domProps:{innerHTML:t._s(t.$t(e))}})],1)}))],2)}),[],!1,Qe,"3bfe1433",null,null);function Qe(t){for(let e in Ke)this[e]=Ke[e]}var ti=function(){return Ze.exports}();class ei extends w{getShaders(){const t=super.getShaders();return t.inject={"vs:#decl":"        attribute float timeStart;\n        attribute float timeEnd;\n        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","vs:#main-start":"        if (searchFlag == 1.0) {\n          vTime = 999.0;\n        } else if (timeEnd == -1.0 || timeStart > currentTime || timeEnd < currentTime ) {\n          vTime = -1.0;\n          return;\n        } else {\n          float nearBeginning = currentTime - timeStart;\n          float nearEnd = timeEnd - currentTime;\n          vTime = min(nearBeginning, nearEnd);\n        }\n      ","fs:#decl":"        uniform float currentTime;\n        uniform float searchFlag;\n        varying float vTime;\n      ","fs:#main-start":"      if (searchFlag == 0.0 && vTime == -1.0 ) discard;\n      ","fs:DECKGL_FILTER_COLOR":"        if (vTime <= 10.0) color.a *= (vTime / 10.0);\n      "},t}initializeState(t){super.initializeState(t);this.getAttributeManager().addInstanced({timeStart:{size:1,accessor:"getTimeStart"},timeEnd:{size:1,accessor:"getTimeEnd"}})}draw(t){const{currentTime:e}=this.props;t.uniforms=Object.assign({},t.uniforms,{currentTime:e}),super.draw(t)}}ei.layerName="DrtRequestArcLayer",ei.defaultProps={currentTime:{type:"number",value:0,min:0},getTimeStart:{type:"accessor",value:null},getTimeEnd:{type:"accessor",value:null},searchFlag:{type:"number",value:0}};const ii={marker:{x:0,y:0,width:128,height:128,mask:!0},info:{x:128,y:0,width:128,height:128,mask:!0},vehicle:{x:128,y:128,width:128,height:128,mask:!0},diamond:{x:0,y:128,width:128,height:128,mask:!1}},si={vehicleColor:[200,130,250],trailColor0:[235,235,25],trailColor1:[23,184,190],effects:[new $({ambientLight:new P({color:[255,255,255],intensity:1}),pointLight:new Rt({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]})})]},ni=0,ai=1,oi=2,ri=3,li=4,ci=6;const hi=d({name:"VehicleAnimationPlugin",i18n:{messages:{en:{requests:"DRT Requests",passengers:"Passengers",search:"Search",showhide:"Show/Hide",vehicles:"Vehicles",routes:"Routes",speed:"Speed"},de:{requests:"DRT Anfragen",passengers:"Passagiere",search:"Suche",showhide:"Ein-/Ausblenden",vehicles:"DRT Fahrzeuge",routes:"DRT Routen",speed:"Geschwindigkeit"}}},components:{CollapsiblePanel:H,SettingsPanel:ti,LegendColors:function(t){const e=t.items.map((t=>h.createElement("li",{key:t.value+t.value[0],style:{display:"flex"}},t.label&&h.createElement("div",{style:{margin:"0 0.5rem 0.0rem 0",fontWeight:"bold"}},t.label),h.createElement("div",{style:{width:"100%",height:"3px",marginTop:"0.5rem",backgroundColor:`rgb(${t.color})`}}))));return h.createElement("div",null,h.createElement("h4",{style:{textAlign:"left",fontWeight:"bold",margin:"1rem 0 0.25rem 0",fontSize:"0.8rem"}},t.title),h.createElement("p",null,t.description),h.createElement("ul",{style:{listStyle:"none",padding:0,margin:0}},e))},TripViz:function(t){const{simulationTime:e,paths:i,traces:s,drtRequests:n,settingsShowLayers:a,center:o,dark:r,vehicleLookup:l,searchEnabled:c,onClick:d,viewId:m}=t,g=si,[p,f]=u.exports.useState(o?{center:[16,42],longitude:o[0],latitude:o[1],pitch:0,bearing:0,zoom:10}:Object.assign({},yt.state.viewState));St[m]=()=>{f(yt.state.viewState)};const[v,b]=u.exports.useState({}),y=[];return a.routes&&y.push(new oe({id:"Routen",data:s,currentTime:e,getSourcePosition:t=>t.p0,getTargetPosition:t=>t.p1,getTimeStart:t=>t.t0,getTimeEnd:t=>t.t1,getColor:e=>t.colors[e.occ],getWidth:1,opacity:.8,widthMinPixels:1,rounded:!1,shadowEnabled:!1,searchFlag:c?1:0,pickable:!0,autoHighlight:!0,highlightColor:[255,0,255],onHover:b})),a.vehicles&&y.push(new ie({id:"Vehicles",data:i,getPathStart:t=>t.p0,getPathEnd:t=>t.p1,getTimeStart:t=>t.t0,getTimeEnd:t=>t.t1,getIcon:t=>"vehicle",getColor:e=>t.colors[e.occ],iconMoving:"vehicle",iconStill:"diamond",getSize:c?72:64,opacity:1,currentTime:e,shadowEnabled:!1,noAlloc:!0,iconAtlas:"/report-tncs2020-simwrapper//images/icon-atlas.png",iconMapping:ii,sizeScale:.5,billboard:!1,pickable:!0,depthTest:!0,autoHighlight:!1,highlightColor:[255,0,255],onHover:b,parameters:{depthTest:!1}})),a.requests&&y.push(new ei({id:"DRT Requests",data:n,currentTime:e,getSourcePosition:t=>[t[ai],t[oi]],getTargetPosition:t=>[t[ri],t[li]],getTimeStart:t=>t[ni],getTimeEnd:t=>t[ci],getSourceColor:[255,0,255],getTargetColor:[200,255,255],getWidth:1,opacity:.5,searchFlag:c?1:0})),h.createElement(I,{layers:y,effects:g.effects,pickingRadius:5,viewState:p,controller:!0,getCursor:()=>"pointer",onClick:function(){console.log(v),v.object?d(v.object.v):d(null)},onViewStateChange:t=>{yt.commit("setMapCamera",t.viewState)}},h.createElement(N,{mapStyle:yt.getters.mapStyle,mapboxApiAccessToken:wt}),function({hoverInfo:t}){const{object:e,x:i,y:s}=t;if(!e)return null;const n=l[e.v];return h.createElement("div",{className:"tooltip",style:{fontSize:"0.8rem",backgroundColor:"#ddddeedd",borderLeft:"6px solid green",boxShadow:"2.5px 2px 4px rgba(0,0,0,0.25)",color:"#223",padding:"1rem 1rem",position:"absolute",left:i+40,top:s-30}},h.createElement("big",null,h.createElement("b",null,n)),h.createElement("div",null,"Passagiere: ",e.occ," "))}({hoverInfo:v}))},VueSlider:st,PlaybackControls:$t,ToggleButton:y.exports.ToggleButton,ZoomButtons:j},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,thumbnail:Boolean},data:()=>{const t={0:[140,140,160],1:[85,255,85],2:[255,255,85],3:[240,110,30],4:[192,30,50]};return{viewId:Math.floor(1e12*Math.random()),COLOR_OCCUPANCY:t,SETTINGS:{vehicles:!0,routes:!0,requests:!1},legendItems:Object.keys(t).map((e=>({type:Tt.line,color:t[e],value:e,label:e}))),legendRequests:[{type:Tt.line,color:[255,0,255],value:0,label:""}],vizDetails:{network:"",drtTrips:"",projection:"",title:"",description:"",thumbnail:"",center:[13.45,52.5],zoom:10,mapIsIndependent:!1,theme:""},myState:{statusMessage:"",clock:"00:00",colorScheme:Ct.DarkMode,isRunning:!1,isShowingHelp:!1,subfolder:"",yamlConfig:"",thumbnail:!1,data:[]},timeStart:0,timeEnd:86400,traces:B([]),traceStart:{},traceEnd:{},traceVehicle:{},paths:B([]),pathStart:{},pathEnd:{},pathVehicle:{},requests:B([]),requestStart:{},requestEnd:{},requestVehicle:{},simulationTime:21600,timeElapsedSinceLastFrame:0,searchTerm:"",searchEnabled:!1,globalState:yt.state,isDarkMode:yt.state.isDarkMode,isLoaded:!0,showHelp:!1,speedStops:[-10,-5,-2,-1,-.5,-.25,0,.25,.5,1,2,5,10],speed:1,legendBits:[],thumbnailUrl:"url('assets/thumbnail.jpg') no-repeat;",vehicleLookup:[],vehicleLookupString:{},isPausedDueToHiding:!1}},computed:{fileApi(){return new S(this.fileSystem,yt)},fileSystem(){const t=this.$store.state.svnProjects.filter((t=>t.slug===this.root));if(0===t.length)throw console.log("no such project"),Error;return t[0]},urlThumbnail(){return this.thumbnailUrl},textColor(){return this.myState.colorScheme===Ct.DarkMode?{text:"white",bg:"#181518aa"}:{text:"#3498db",bg:"#eeeef480"}}},watch:{"$store.state.viewState"(){this.vizDetails.mapIsIndependent||St[this.viewId]&&St[this.viewId]()},async"globalState.authAttempts"(){console.log("AUTH CHANGED - Reload"),this.yamlConfig||this.buildRouteFromUrl(),await this.getVizDetails()},"globalState.colorScheme"(){this.isDarkMode=this.globalState.colorScheme===Ct.DarkMode,this.updateLegendColors()},searchTerm(){var t,e,i,s,n,a;const o=this.vehicleLookupString[this.searchTerm];o>-1?(console.log("vehicle",o),null==(t=this.pathVehicle)||t.filterExact(o),null==(e=this.traceVehicle)||e.filterExact(o),null==(i=this.requestVehicle)||i.filterExact(o),this.requestStart.filterAll(),this.requestEnd.filterAll(),this.searchEnabled=!0):(console.log("nope"),null==(s=this.pathVehicle)||s.filterAll(),null==(n=this.traceVehicle)||n.filterAll(),null==(a=this.requestVehicle)||a.filterAll(),this.searchEnabled=!1),this.updateDatasetFilters()}},methods:{async handleSettingChange(t){console.log(t),this.SETTINGS[t]=!this.SETTINGS[t],this.updateDatasetFilters(),this.simulationTime+=1},buildRouteFromUrl(){const t=this.$route.params;if(!t.project||!t.pathMatch)return void console.log("I CANT EVEN: NO PROJECT/PARHMATCH");const e=1+t.pathMatch.lastIndexOf("/"),i=t.pathMatch.substring(0,e),s=t.pathMatch.substring(e);this.myState.subfolder=i,this.myState.yamlConfig=s},async getVizDetails(){try{const t=this.myState.yamlConfig.indexOf("/")>-1?this.myState.yamlConfig:this.myState.subfolder+"/"+this.myState.yamlConfig,e=await this.fileApi.getFileText(t);this.vizDetails=q.parse(e)}catch(e){console.log("failed");const t=e;this.fileSystem.needPassword&&401===t.status&&yt.commit("requestLogin",this.fileSystem.slug)}this.vizDetails.theme&&this.$store.commit("setTheme",this.vizDetails.theme),this.vizDetails.center&&this.$store.commit("setMapCamera",{longitude:this.vizDetails.center[0],latitude:this.vizDetails.center[1],zoom:this.vizDetails.zoom||10,pitch:10,bearing:0});const t=this.vizDetails.title?this.vizDetails.title:"Agent Animation";this.$emit("title",t),this.buildThumbnail()},async buildThumbnail(){if(this.thumbnail&&this.vizDetails.thumbnail)try{const t=await this.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail),e=await U.arraybuffer(t),i=this.arrayBufferToBase64(e);i&&(this.thumbnailUrl=`center / cover no-repeat url(data:image/png;base64,${i})`)}catch(t){console.error(t)}},handleClick(t){if(null===t)return void(this.searchTerm="");const e=this.vehicleLookup[t];console.log(e),this.searchTerm===e?this.searchTerm="":this.searchTerm=e},arrayBufferToBase64(t){for(var e="",i=new Uint8Array(t),s=i.byteLength,n=0;n<s;n++)e+=String.fromCharCode(i[n]);return window.btoa(e)},updateLegendColors(){},setWallClock(){const t=Math.floor(this.simulationTime/3600),e=Math.floor(this.simulationTime/60)%60;this.myState.clock=`${t<10?"0":""}${t}${e<10?":0":":"}${e}`},setTime(t){this.simulationTime=t,this.setWallClock(),this.traceStart&&this.pathStart&&this.requestStart&&(this.pathStart.filter([0,this.simulationTime]),this.pathEnd.filter([this.simulationTime,1/0]),this.searchEnabled||(this.traceStart.filter([0,this.simulationTime]),this.traceEnd.filter([this.simulationTime,1/0]),this.requestStart.filter([0,this.simulationTime]),this.requestEnd.filter([this.simulationTime,1/0]))),this.$options.paths=this.paths.allFiltered(),this.$options.traces=this.traces.allFiltered(),this.$options.drtRequests=this.requests.allFiltered()},toggleSimulation(){this.myState.isRunning=!this.myState.isRunning,this.timeElapsedSinceLastFrame=Date.now(),this.myState.isRunning&&0===this.speed&&(this.speed=1),this.myState.isRunning&&this.animate()},async parseDrtRequests(t){if(this.vehicleLookup.length)for(const i of t)try{i[5]=this.vehicleLookupString[i[5]]}catch(e){}return B(t)},async parseVehicles(t){const e=[];let i=-1;return await G.forEachAsync(t,(t=>{const s=t.path,n=t.timestamps,a=t.passengers;i++,this.vehicleLookup[i]=t.id,this.vehicleLookupString[t.id]=i;for(let o=0;o<t.path.length-1;o++)e.push({t0:n[o],t1:n[o+1],p0:s[o],p1:s[o+1],v:i,occ:a[o]})})),B(e)},updateDatasetFilters(){this.traceStart&&this.pathStart&&this.requestStart&&(this.SETTINGS.routes&&(this.searchEnabled?(this.traceStart.filterAll(),this.traceEnd.filterAll()):(this.traceStart.filter([0,this.simulationTime]),this.traceEnd.filter([this.simulationTime,1/0])),this.$options.traces=this.traces.allFiltered()),this.SETTINGS.vehicles&&(this.pathStart.filter([0,this.simulationTime]),this.pathEnd.filter([this.simulationTime,1/0]),this.$options.paths=this.paths.allFiltered()),this.SETTINGS.requests&&(this.searchEnabled?(this.requestStart.filterAll(),this.requestEnd.filterAll()):(this.requestStart.filter([0,this.simulationTime]),this.requestEnd.filter([this.simulationTime,1/0])),this.$options.drtRequests=this.requests.allFiltered()))},animate(){if(this.myState.isRunning){const t=Date.now()-this.timeElapsedSinceLastFrame;this.timeElapsedSinceLastFrame+=t,this.simulationTime+=t*this.speed*.06,this.updateDatasetFilters(),this.setWallClock(),window.requestAnimationFrame(this.animate)}},handleVisibilityChange(){this.isPausedDueToHiding&&!document.hidden?(console.log("unpausing"),this.isPausedDueToHiding=!1,this.toggleSimulation()):this.myState.isRunning&&document.hidden&&(console.log("pausing"),this.isPausedDueToHiding=!0,this.toggleSimulation())},async parseRouteTraces(t){let e=-1;const i=[];return await G.forEachAsync(t,(t=>{e++;let s=t.timestamps[0],n=t.timestamps[0],a=[];for(let o=1;o<t.path.length;o++)n=t.timestamps[o],t.path[o][0]===t.path[o-1][0]&&t.path[o][1]===t.path[o-1][1]?(a.forEach((e=>{e.t1=t.timestamps[o-1]})),i.push(...a),a=[],s=n):a.push({t0:s,p0:t.path[o-1],p1:t.path[o],v:e,occ:t.passengers[o-1]});a.forEach((t=>{t.t1=n})),i.push(...a)})),B(i)},async loadFiles(){let t=[],e=[];try{if(this.vizDetails.drtTrips.endsWith("json")){const i=await this.fileApi.getFileJson(this.myState.subfolder+"/"+this.vizDetails.drtTrips);t=i.trips,e=i.drtRequests}else if(this.vizDetails.drtTrips.endsWith("gz")){const i=await this.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.drtTrips),s=i?await Y(i):null;let n=await G.run(X.inflateAsync(s,{to:"string"}));const a=JSON.parse(n);t=a.trips,e=a.drtRequests}}catch(i){console.error(i),this.myState.statusMessage=""+i}return{trips:t,drtRequests:e}},toggleLoaded(t){this.isLoaded=t},rotateColors(){this.myState.colorScheme=this.myState.colorScheme===Ct.DarkMode?Ct.LightMode:Ct.DarkMode,localStorage.setItem("plugin/agent-animation/colorscheme",this.myState.colorScheme)}},async mounted(){var t;if(yt.commit("setFullScreen",!this.thumbnail),this.myState.thumbnail=this.thumbnail,this.myState.yamlConfig=null!=(t=this.yamlConfig)?t:"",this.myState.subfolder=this.subfolder,await this.getVizDetails(),this.thumbnail)return;this.showHelp=!1,this.updateLegendColors(),this.setWallClock(),this.myState.statusMessage="/ Dateien laden...",console.log("loading files");const{trips:e,drtRequests:i}=await this.loadFiles();console.log("parsing vehicle motion"),this.myState.statusMessage=`${this.$t("vehicles")}...`,this.paths=await this.parseVehicles(e),this.pathStart=this.paths.dimension((t=>t.t0)),this.pathEnd=this.paths.dimension((t=>t.t1)),this.pathVehicle=this.paths.dimension((t=>t.v)),console.log("Routes..."),this.myState.statusMessage=`${this.$t("routes")}...`,this.traces=await this.parseRouteTraces(e),this.traceStart=this.traces.dimension((t=>t.t0)),this.traceEnd=this.traces.dimension((t=>t.t1)),this.traceVehicle=this.traces.dimension((t=>t.v)),console.log("Requests..."),this.myState.statusMessage=`${this.$t("requests")}...`,this.requests=await this.parseDrtRequests(i),this.requestStart=this.requests.dimension((t=>t[0])),this.requestEnd=this.requests.dimension((t=>t[6])),this.requestVehicle=this.requests.dimension((t=>t[5])),console.log("GO!"),this.myState.statusMessage="",document.addEventListener("visibilitychange",this.handleVisibilityChange,!1),this.myState.isRunning=!0,this.timeElapsedSinceLastFrame=Date.now(),this.animate()},beforeDestroy(){document.removeEventListener("visibilityChange",this.handleVisibilityChange),yt.commit("setFullScreen",!1),this.$store.commit("setFullScreen",!1),this.myState.isRunning=!1}});yt.commit("registerPlugin",{kebabName:"vehicle-view",prettyName:"Trip Viewer",description:"Deck.gl based trip viewer",filePatterns:["**/viz-vehicles*.y?(a)ml"],component:hi});const di={};var ui=bt(hi,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"gl-app",class:{"hide-thumbnail":!t.thumbnail},style:{background:t.urlThumbnail},attrs:{oncontextmenu:"return false"}},[t.thumbnail?t._e():i("trip-viz",{staticClass:"anim",attrs:{center:t.vizDetails.center,colors:t.COLOR_OCCUPANCY,drtRequests:t.$options.drtRequests,dark:t.globalState.isDarkMode,paths:t.$options.paths,settingsShowLayers:t.SETTINGS,searchEnabled:t.searchEnabled,simulationTime:t.simulationTime,traces:t.$options.traces,vehicleLookup:t.vehicleLookup,viewId:t.viewId,onClick:t.handleClick}}),t.thumbnail?t._e():i("zoom-buttons"),t.isLoaded&&!t.thumbnail?i("div",{staticClass:"right-side"},[i("collapsible-panel",{attrs:{direction:"right"}},[i("div",{staticClass:"big clock"},[i("p",[t._v(t._s(t.myState.clock))])]),i("div",{staticClass:"panel-items"},[t.legendItems.length?i("legend-colors",{staticClass:"legend-block",attrs:{title:`${t.$t("passengers")}:`,items:t.legendItems}}):t._e(),i("legend-colors",{staticClass:"legend-block",attrs:{title:`${t.$t("requests")}:`,items:t.legendRequests}}),i("div",{staticClass:"search-panel"},[i("p",{staticClass:"speed-label",style:{margin:"1rem 0 0 0"}},[t._v(t._s(t.$t("search")))]),i("form",{attrs:{autocomplete:"off"}}),i("div",{staticClass:"field"},[i("p",{staticClass:"control has-icons-left"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchTerm,expression:"searchTerm"}],staticClass:"input is-small",attrs:{type:"email",placeholder:`${t.$t("search")}...`},domProps:{value:t.searchTerm},on:{input:function(e){e.target.composing||(t.searchTerm=e.target.value)}}}),i("span",{staticClass:"icon is-small is-left"},[i("i",{staticClass:"fas fa-search"})])])])]),i("settings-panel",{staticClass:"settings-area",attrs:{items:t.SETTINGS},on:{click:t.handleSettingChange}}),i("div",{staticClass:"speed-block"},[i("p",{staticClass:"speed-label"},[t._v(t._s(t.$t("speed"))+":"),i("br"),t._v(t._s(t.speed)+"x")]),i("b-slider",{staticClass:"speed-slider",attrs:{min:t.speedStops[0],max:t.speedStops[t.speedStops.length-1],duration:0,dotSize:20,tooltip:!0,"tooltip-placement":"bottom","tooltip-formatter":function(t){return t+"x"}},model:{value:t.speed,callback:function(e){t.speed=e},expression:"speed"}},[t._l(t.speedStops,(function(t){return[i("b-slider-tick",{key:t,attrs:{value:t}})]}))],2)],1)],1)])],1):t._e(),!t.thumbnail&&t.isLoaded?i("playback-controls",{staticClass:"bottom-area",attrs:{timeStart:t.timeStart,timeEnd:t.timeEnd,isRunning:t.myState.isRunning,currentTime:t.simulationTime},on:{click:t.toggleSimulation,time:t.setTime}}):t._e()],1)}),[],!1,mi,"4f3ef6b9",null,null);function mi(t){for(let e in di)this[e]=di[e]}var gi=function(){return ui.exports}();const pi=d({name:"CalculationTable",components:{TopSheet:nt},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,config:Object,thumbnail:Boolean},data:()=>({globalState:yt.state,allConfigFiles:{dashboards:{},topsheets:{},vizes:{},configs:{}},files:[],isLoaded:!1,vizDetails:{title:"",description:"",thumbnail:""}}),computed:{fileApi(){return new S(this.fileSystem,yt)},fileSystem(){const t=this.$store.state.svnProjects.filter((t=>t.slug===this.root));if(0===t.length)throw console.log("no such project"),Error;return t[0]},urlThumbnail:()=>"url('assets/thumbnail.jpg') no-repeat;"},methods:{async getVizDetails(){if(!this.fileApi)return;console.log(this.yamlConfig);try{const t=await this.fileApi.getFileText(this.subfolder+"/"+this.yamlConfig);this.vizDetails=q.parse(t)}catch(e){console.error("failed")}const t=this.vizDetails.title?this.vizDetails.title:"Table";this.$emit("title",t)}},async mounted(){await this.getVizDetails(),this.allConfigFiles=await this.fileApi.findAllYamlConfigs(this.subfolder);const{files:t}=await this.fileApi.getDirectory(this.subfolder);this.files=t,this.isLoaded=!0,this.thumbnail}});yt.commit("registerPlugin",{kebabName:"summary",prettyName:"Summary Table",description:"Calculation table",filePatterns:["(topsheet|table)*.y?(a)ml"],component:pi});const fi={};var vi=bt(pi,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"my-component",class:{"hide-thumbnail":!t.thumbnail},attrs:{oncontextmenu:"return false"}},[t.thumbnail?i("img",{staticClass:"thumb",attrs:{src:"/report-tncs2020-simwrapper/assets/table.439da6cc.png",width:128}}):t._e(),!t.thumbnail&&t.isLoaded?i("div",{staticClass:"topsheet"},[i("p",{staticClass:"header"},[t._v(t._s(t.subfolder))]),i("h2",[t._v(t._s(t.vizDetails.title))]),i("p",[t._v(t._s(t.vizDetails.description))]),i("hr"),i("TopSheet",{tag:"component",staticClass:"dash-card",attrs:{fileSystemConfig:t.fileSystem,subfolder:t.subfolder,config:t.vizDetails,yaml:t.yamlConfig,files:t.files,cardTitle:t.vizDetails.title,cardId:"table1",allConfigFiles:t.allConfigFiles}})],1):t._e()])}),[],!1,bi,"5c870b4f",null,null);function bi(t){for(let e in fi)this[e]=fi[e]}var yi=function(){return vi.exports}();const Si=d({name:"VideoPlayerPlugin",props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,config:Object,thumbnail:Boolean},data:()=>({movieSource:"",title:"",myState:{},fileApi:null,playerOptions:{muted:!1,language:"en",playbackRates:[.5,1,1.5,2,5],preload:"metadata",responsive:!0,fluid:!1,playsInline:!0,controls:!0,sources:[]}}),beforeDestroy(){this.thumbnail||yt.commit("setFullScreen",!1)},mounted(){this.fileApi=this.getFileSystem(this.root),this.myState={subfolder:this.subfolder,yamlConfig:this.yamlConfig,thumbnail:this.thumbnail,imageData:""},this.playerOptions.fluid=!!this.thumbnail,this.thumbnail||yt.commit("setFullScreen",!0),this.yamlConfig?(this.myState.subfolder=this.subfolder,this.myState.yamlConfig=this.yamlConfig,this.buildMovieSource()):this.buildRouteFromUrl(),this.getVizDetails()},watch:{yamlConfig(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()},subfolder(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},methods:{buildMovieSource(){var t;this.movieSource=`${null==(t=this.fileApi)?void 0:t.baseURL}/${this.myState.subfolder}/${this.myState.yamlConfig}`,this.playerOptions.sources.push({type:"video/mp4",src:this.movieSource})},getFileSystem(t){const e=this.$store.state.svnProjects.filter((e=>e.slug===t));if(0===e.length)throw console.log("no such project"),Error;return e[0]},async buildRouteFromUrl(){const t=this.$route.params;if(!t.project||!t.pathMatch)return void console.log("I CANT EVEN: NO PROJECT/PARHMATCH");this.fileApi=this.getFileSystem(t.project);const e=1+t.pathMatch.lastIndexOf("/"),i=t.pathMatch.substring(0,e),s=t.pathMatch.substring(e);this.myState.subfolder=i,this.myState.yamlConfig=s,this.buildMovieSource()},async generateBreadcrumbs(){const t=this.getFileSystem(this.$route.params.project);if(!t)return[];const e=[{label:t.name,url:"/"+t.slug}],i=this.myState.subfolder.split("/");let s="/";for(const n of i)n&&(s+=n+"/",e.push({label:n,url:"/"+t.slug+s}));return yt.commit("setBreadCrumbs",e),e},async getVizDetails(){this.title=this.myState.yamlConfig.replace(/_/g," "),this.title=this.title.substring(0,this.title.lastIndexOf(".")),this.title&&this.$emit("title",this.title)}}});yt.commit("registerPlugin",{kebabName:"vid-player",prettyName:"Video",description:"",filePatterns:["*.mp4"],component:Si});const wi={};var Ci=bt(Si,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"video-plugin-container",class:{thumbnail:t.thumbnail}},[t.thumbnail?t._e():i("h3",[t._v(t._s(t.title))]),i("div",{staticClass:"vid-container"},[i("video",{attrs:{controls:t.controls,loop:t.loop,allowfullscreen:t.allowfullscreen,autoplay:t.autoplay},domProps:{muted:t.muted}},[t._l(t.sources,(function(t,e){return i("source",{key:e,attrs:{src:t,type:e}})})),t._l(t.sources,(function(e,s){return i("p",{key:s},[t._v("Video tag not supported. Download the video "),i("a",{attrs:{href:e,target:"_blank"}},[t._v("here")])])}))],2)])])}),[],!1,Ti,"5bdd44a7",null,null);function Ti(t){for(let e in wi)this[e]=wi[e]}var Ei=function(){return Ci.exports}();const Ai=d({name:"ImageViewPlugin",props:{fileApi:{type:Object,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,thumbnail:Boolean},data:()=>({globalState:yt.state,myState:{},matsimPngTitles:{"modestats.png":"Mode statistics","ph_modestats.png":"Passenger hours traveled per mode","pkm_modestats.png":"Passenger km traveled per mode","scorestats.png":"Score statistics","stopwatch.png":"Stopwatch: computation time","traveldistancestatslegs.png":"Leg travel distance","traveldistancestatstrips.png":"Trip travel distance"}}),computed:{isDarkMode(){return this.globalState.isDarkMode}},methods:{buildRouteFromUrl(){const t=this.$route.params;if(!t.project||!t.pathMatch)return void console.log("I CANT EVEN: NO PROJECT/PARHMATCH");const e=1+t.pathMatch.lastIndexOf("/"),i=t.pathMatch.substring(0,e),s=t.pathMatch.substring(e);this.myState.subfolder=i,this.myState.yamlConfig=s},async getVizDetails(){try{const t=await this.myState.fileApi.getFileBlob(this.myState.subfolder+"/"+this.myState.yamlConfig);if(!t)return void console.log("no blob! :-(");const e=await U.dataurl(t);this.myState.imageData=e;const i=this.yamlConfig,s=this.matsimPngTitles[i]?this.matsimPngTitles[i]:this.yamlConfig;this.$emit("title",s)}catch(t){return console.error({e:t}),null}}},watch:{yamlConfig(){this.myState.yamlConfig=this.yamlConfig,this.getVizDetails()},subfolder(){this.myState.subfolder=this.subfolder,this.getVizDetails()}},mounted(){this.myState={fileApi:this.fileApi,subfolder:this.subfolder,yamlConfig:this.yamlConfig,thumbnail:this.thumbnail,imageData:""},this.yamlConfig||this.buildRouteFromUrl(),this.getVizDetails()}});yt.commit("registerPlugin",{kebabName:"image-view",prettyName:"Image",description:"",filePatterns:["!(*thumbnail*).(png|jpg)"],component:Ai});const ki={};var _i=bt(Ai,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.myState.yamlConfig?i("div",{staticClass:"image-container",class:{zthumbnail:t.thumbnail}},[i("img",{staticClass:"medium-zoom",class:{"invert-colors":t.isDarkMode},attrs:{src:t.myState.imageData}})]):t._e()}),[],!1,xi,"05423314",null,null);function xi(t){for(let e in ki)this[e]=ki[e]}var Di=function(){return _i.exports}();class Li extends K{constructor(){super(...arguments),c(this,"MAX_COLORS",21),c(this,"uniformColors",new Array(3*this.MAX_COLORS)),c(this,"uniformBreakpoints",new Array(this.MAX_COLORS-1))}initializeState(t){super.initializeState(t),this.getAttributeManager().addInstanced({instanceValue:{accessor:"getValue",size:1,defaultValue:0,transition:!0}})}getShaders(){return l(r({},super.getShaders()),{inject:{"vs:#decl":"\n            #define MAX_COLORS 21\n            #define MAX_BREAKPOINTS 20\n            uniform int numBreakpoints;\n            uniform vec3 colors[MAX_COLORS];\n            uniform float breakpoints[MAX_BREAKPOINTS];\n            attribute float instanceValue;\n            ","vs:DECKGL_FILTER_COLOR":"\n            // geometry.pickingColor = instancePickingColors;\n            picking_setPickingColor(geometry.pickingColor);\n\n            int lastBreakpoint = numBreakpoints;\n\n            for(int i=0; i < MAX_BREAKPOINTS; ++i) {\n              if (instanceValue < breakpoints[i]) {\n                color = vec4(colors[i], 1.0);\n                return;\n              }\n              if (i == lastBreakpoint) {\n                color = vec4(colors[i], 1.0);\n                return;\n              }\n            }\n            color = vec4(1.0, 0.0, 0.0, 1.0);\n            return;\n          "}})}draw({uniforms:t}){const{colors:e,breakpoints:i}=this.props;e.map(((t,e)=>{this.uniformColors[3*e]=t[0]/256,this.uniformColors[3*e+1]=t[1]/256,this.uniformColors[3*e+2]=t[2]/256})),i.map(((t,e)=>{this.uniformBreakpoints[e]=t}));const s=l(r({},t),{colors:this.uniformColors,breakpoints:this.uniformBreakpoints,numBreakpoints:i.length});super.draw({uniforms:s})}}Li.layerName="ScatterplotColorBinsLayer",Li.defaultProps={colors:[[128,128,128],[128,128,128]],breakpoints:[0]};const zi=new J({filterSize:1});const Ri={pitch:0,zoom:11,bearing:0,longitude:13.38,latitude:52.5};function Fi(){return new Worker("/report-tncs2020-simwrapper/assets/XytDataParser.worker.408b1a4b.js",{type:"module"})}const Mi=d({name:"XYTime",i18n:{messages:{en:{loading:"Loading data...",sorting:"Sorting into bins...",aggregate:"Summary",maxHeight:"3D Height",showDetails:"Show Details",selection:"Selection",areas:"Areas",count:"Count",promptCRS:'Enter the coordinate reference system, e.g. EPSG:25832\n\nThese coordinates are not in long/lat format. To fix this permanently, convert them to long/lat or add "# EPSG:xxxx" to your CSV header'},de:{loading:"Dateien laden...",sorting:"Sortieren...",aggregate:"Daten",maxHeight:"3-D Höhe",showDetails:"Details anzeigen",selection:"Ausgewählt",areas:"Orte",count:"Anzahl"}}},components:{CollapsiblePanel:H,DrawingTool:Z,LegendBox:Q,TimeSlider:je,ZoomButtons:j,XyTimeDeckMap:function({viewId:t=0,pointLayers:e=[],timeFilter:i=[],dark:s=!1,colors:n=[[1,0,0],[.25,.25,1]],breakpoints:a=[0],radius:o=5,mapIsIndependent:r=!1}){const[l,c]=u.exports.useState(Ri);function d(t){var i;if(t.index<0)return null;const n=null==(i=null==t?void 0:t.layer)?void 0:i.id;if(void 0===n)return null;const a=function(t){const e=t;try{const t=b(e),i=("00"+t.minutes).slice(-2);return`${t.hours}:${i}`}catch(i){return"00:00"}}(e[n].time[t.index]),o=e[n].value[t.index];return{html:`        <table style="font-size: 0.9rem">\n        <tr>\n          <td>Value</td>\n          <td style="padding-left: 0.5rem;"><b>${Math.round(1e6*o)/1e6}</b></td>\n        </tr><tr>\n          <td style="text-align: right;">Time</td>\n          <td style="padding-left: 0.5rem;"><b>${a}</b></td>\n        </tr>\n        </table>\n      `,style:s?{color:"#ccc",backgroundColor:"#2a3c4f"}:{color:"#223",backgroundColor:"white"}}}St[t]=()=>{c(yt.state.viewState)};const m=e.map(((t,s)=>{const r=t.timeRange[0]>i[1]||t.timeRange[1]<i[0];return new Li({data:{length:t.time.length,attributes:{getPosition:{value:t.coordinates,size:2},getFilterValue:{value:t.time,size:1},getValue:{value:t.value,size:1}}},autoHighlight:!0,breakpoints:a,colors:n,extensions:[zi],id:s,filled:!0,filterRange:i.length?i:null,getRadius:o,highlightColor:[255,0,224],opacity:1,parameters:{depthTest:!1},pickable:!0,radiusScale:1,stroked:!1,updateTriggers:{getPosition:e,getFillColor:e,getFilterValue:i},visible:!r})}));return h.createElement(I,{layers:m,controller:!0,useDevicePixels:!0,viewState:l,onViewStateChange:t=>{var e;(e=t.viewState).latitude&&(e.center||(e.center=[0,0]),e.center[0]=e.longitude,e.center[1]=e.latitude,c(e),r||yt.commit("setMapCamera",e))},pickingRadius:4,onClick:d,getTooltip:d},h.createElement(N,{mapStyle:yt.getters.mapStyle,preventStyleDiffing:!0,mapboxApiAccessToken:wt}))}},props:{root:{type:String,required:!0},subfolder:{type:String,required:!0},yamlConfig:String,config:Object,thumbnail:Boolean},data:()=>({guiConfig:{buckets:7,exponent:4,radius:5,"clip max":100,"color ramp":"viridis",colorRamps:["bathymetry","electric","inferno","jet","magma","par","viridis"],flip:!1},viewId:`xyt-id-${Math.floor(1e12*Math.random())}`,configId:`gui-config-${Math.floor(1e12*Math.random())}`,timeLabels:[0,1],startTime:0,isAnimating:!1,timeFilter:[0,3599],colors:[[128,128,128],[128,128,128]],breakpoints:[0],range:[1/0,-1/0],timeRange:[1/0,-1/0],legendStore:null,standaloneYAMLconfig:{title:"",description:"",file:"",projection:"",thumbnail:"",radius:250,maxHeight:0,center:null,zoom:9},YAMLrequirementsXY:{file:""},columnLookup:[],gzipWorker:null,vizDetails:{title:"",description:"",file:"",projection:"",thumbnail:"",center:null,zoom:9},myState:{statusMessage:"",subfolder:"",yamlConfig:"",thumbnail:!1},pointLayers:[],isLoaded:!1,animator:null,guiController:null,resizer:null,thumbnailUrl:"url('assets/thumbnail.jpg') no-repeat;",ANIMATE_SPEED:4,animationElapsedTime:0}),async mounted(){this.$store.commit("setFullScreen",!this.thumbnail),this.myState.thumbnail=this.thumbnail,this.myState.yamlConfig=this.yamlConfig||"",this.myState.subfolder=this.subfolder,await this.getVizDetails(),await this.buildThumbnail(),this.thumbnail||(this.setupLogoMover(),this.setupGui(),this.myState.statusMessage=`${this.$i18n.t("loading")}`,this.isLoaded||await this.loadFiles())},beforeDestroy(){St[this.viewId]=void 0,delete St[this.viewId];try{this.gzipWorker&&(this.gzipWorker.postMessage({terminate:!0}),this.gzipWorker.terminate()),this.guiController&&this.guiController.destroy()}catch(t){console.warn(t)}this.animator&&window.cancelAnimationFrame(this.animator),this.$store.commit("setFullScreen",!1)},computed:{fileApi(){return new S(this.fileSystem,yt)},fileSystem(){const t=this.$store.state.svnProjects.filter((t=>t.slug===this.root));if(0===t.length)throw console.log("no such project"),Error;return t[0]},urlThumbnail(){return this.thumbnailUrl}},watch:{"$store.state.viewState"(){St[this.viewId]&&St[this.viewId]()}},methods:{handleTimeSliderValues(t){this.animationElapsedTime=t[0],this.timeFilter=t,this.timeLabels=[this.convertSecondsToClockTimeMinutes(t[0]),this.convertSecondsToClockTimeMinutes(t[1])]},setupLogoMover(){this.resizer=new ResizeObserver(this.moveLogo);const t=document.getElementById(`id-${this.viewId}`);this.resizer.observe(t)},moveLogo(){const t=document.getElementById(`${this.viewId}`),e=null==t?void 0:t.querySelector(".mapboxgl-ctrl-bottom-left");if(e){const i=t.clientWidth>640?"280px":"36px";e.style.right=i}},setupGui(){this.guiController=new Me({title:"Color Settings",injectStyles:!0,width:200,container:document.getElementById(this.configId)||void 0});const t=this.guiController;t.add(this.guiConfig,"buckets",2,19,1).onChange(this.setColors),t.add(this.guiConfig,"exponent",1,10,1).onChange(this.setColors),t.add(this.guiConfig,"clip max",0,100,1).onChange(this.setColors),t.add(this.guiConfig,"radius",1,20,1),t.add(this.guiConfig,"color ramp",this.guiConfig.colorRamps).onChange(this.setColors),t.add(this.guiConfig,"flip").onChange(this.setColors)},async solveProjection(){if(!this.thumbnail){console.log("WHAT PROJECTION:");try{const t=await this.fileApi.getFileText(this.myState.subfolder+"/"+this.myState.yamlConfig);this.vizDetails=q.parse(t)}catch(t){console.error(t)}}},async getVizDetails(){if(this.config)return this.validateYAML(),void(this.vizDetails=Object.assign({},this.config));new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig)?await this.loadStandaloneYAMLConfig():this.setConfigForRawCSV()},setConfigForRawCSV(){this.vizDetails={title:"Point Data: "+this.myState.yamlConfig,description:this.myState.yamlConfig,file:this.myState.yamlConfig,projection:"EPSG:4326",center:this.vizDetails.center,zoom:this.vizDetails.zoom},this.$emit("title",this.vizDetails.title||this.vizDetails.file)},async loadStandaloneYAMLConfig(){try{const t=this.myState.yamlConfig.indexOf("/")>-1?this.myState.yamlConfig:this.myState.subfolder+"/"+this.myState.yamlConfig,e=await this.fileApi.getFileText(t);this.standaloneYAMLconfig=Object.assign({},q.parse(e)),this.validateYAML(),this.setVizDetails()}catch(t){console.log("failed"),this.$store.commit("setStatus",{type:Et.ERROR,msg:"File not found",desc:`Could not find: ${this.myState.subfolder}/${this.myState.yamlConfig}`})}},validateYAML(){let t={};new RegExp(".*(yml|yaml)$").test(this.myState.yamlConfig)?(console.log("has yaml"),t=this.standaloneYAMLconfig):(console.log("no yaml"),t=this.config);for(const e in this.YAMLrequirementsXY)e in t==!1&&this.$store.commit("setStatus",{type:Et.ERROR,msg:`YAML file missing required key: ${e}`,desc:"Check this.YAMLrequirementsXY for required keys"});0==t.radius&&this.$store.commit("setStatus",{type:Et.WARNING,msg:"Radius set to zero",desc:"Radius can not be zero, preset value used instead. "}),(t.zoom<5||t.zoom>20)&&this.$store.commit("setStatus",{type:Et.WARNING,msg:"Zoom is out of the recommended range ",desc:"Zoom levels should be between 5 and 20. "})},setVizDetails(){this.vizDetails=Object.assign({},this.vizDetails,this.standaloneYAMLconfig);const t=this.vizDetails.title?this.vizDetails.title:"Point Data: "+this.vizDetails.file;this.$emit("title",t)},async buildThumbnail(){if(this.thumbnail&&this.vizDetails.thumbnail)try{const t=await this.fileApi.getFileBlob(this.myState.subfolder+"/"+this.vizDetails.thumbnail),e=await t.arrayBuffer(),i=tt.arrayBufferToBase64(e);i&&(this.thumbnailUrl=`center / cover no-repeat url(data:image/png;base64,${i})`)}catch(t){console.error(t)}},async parseCSVFile(t){this.myState.statusMessage="Loading file...";let e=0;this.gzipWorker=new Fi,this.gzipWorker.onmessage=async i=>{if(i.data.status)this.myState.statusMessage=i.data.status;else if(i.data.error)this.myState.statusMessage=i.data.error,this.$store.commit("setStatus",{type:Et.ERROR,msg:"XYT Loading Error",desc:`Error loading: ${this.myState.subfolder}/${this.vizDetails.file}`});else if(i.data.finished)this.finishedLoadingData(e,i.data);else if(i.data.needCRS){this.gzipWorker&&this.gzipWorker.terminate();let e=prompt(""+this.$t("promptCRS"))||"EPSG:25833";Number.isFinite(parseInt(e))&&(e=`EPSG:${e}`),this.vizDetails.projection=e.toUpperCase(),this.parseCSVFile(t)}else{const t=i.data.time.length;e||this.setFirstZoom(i.data.coordinates,t),e+=t,this.timeRange=[Math.min(this.timeRange[0],i.data.time[0]),Math.max(this.timeRange[1],i.data.time[t-1])],this.pointLayers.push(i.data)}},this.gzipWorker.postMessage({filepath:t,fileSystem:this.fileSystem,projection:this.vizDetails.projection})},setFirstZoom(t,e){const i=.5*(t[0]+t[2*e-2]),s=.5*(t[1]+t[2*e-1]);Number.isFinite(i)&&Number.isFinite(s)&&yt.commit("setMapCamera",Object.assign({},yt.state.viewState,{longitude:i,latitude:s,zoom:10}))},finishedLoadingData(t,e){console.log("ALL DONE",{totalRows:t,data:e.range,time:this.timeRange}),this.myState.statusMessage="",this.timeFilter=[this.timeRange[0],this.timeRange[0]+3599],this.isLoaded=!0,this.range=e.range,this.gzipWorker&&this.gzipWorker.terminate(),this.setColors(),this.moveLogo()},animate(){if(!this.isAnimating)return;this.animationElapsedTime=this.ANIMATE_SPEED*(Date.now()-this.startTime);const t=this.animationElapsedTime+this.timeRange[0];t>this.timeRange[1]&&(this.startTime=Date.now(),this.animationElapsedTime=0);const e=this.timeFilter[1]-this.timeFilter[0];this.timeFilter=[t,t+e],this.animator=window.requestAnimationFrame(this.animate)},toggleAnimation(){this.isAnimating=!this.isAnimating,this.isAnimating&&(this.animationElapsedTime=this.timeFilter[0]-this.timeRange[0],this.startTime=Date.now()-this.animationElapsedTime/this.ANIMATE_SPEED,this.animate())},setColors(){const t=this.guiConfig.exponent;let e=et({colormap:this.guiConfig["color ramp"],nshades:256,format:"rba",alpha:1}).map((t=>[t[0],t[1],t[2]]));this.guiConfig.flip&&(e=e.reverse());const i=256/(this.guiConfig.buckets-1),s=[];for(let o=0;o<this.guiConfig.buckets-1;o++)s.push(e[Math.round(i*o)]);s.push(e[255]);const n=Math.pow(this.range[1],1/t)*this.guiConfig["clip max"]/100,a=[];for(let o=1;o<this.guiConfig.buckets;o++){const e=n*o/this.guiConfig.buckets,i=Math.pow(e,t);a.push(i)}this.isLoaded&&this.setLegend(s,a),this.colors=s,this.breakpoints=a},setLegend(t,e){this.range[1]-this.range[0]!=0&&(this.legendStore=new it,this.legendStore.setLegendSection({section:"Legend",column:"Legend",values:t.map(((i,s)=>{const n=e[0==s?s:s-1];let a=""+Math.round(1e6*n)/1e6;return 0==s&&(a="< "+a),s==t.length-1&&(a="> "+a),{label:a,value:i}}))}))},async loadFiles(){console.log(1),await this.fileApi.getChromePermission(this.fileSystem.handle);try{let t=`${this.myState.subfolder}/${this.vizDetails.file}`;await this.parseCSVFile(t),console.log(2)}catch(t){console.error(t),this.myState.statusMessage=""+t,this.$store.commit("setStatus",{type:Et.ERROR,msg:"Loading/Parsing Error",desc:"Error loading/parsing: ${this.myState.subfolder}/${this.vizDetails.file}"})}},convertSecondsToClockTimeMinutes(t){const e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),s=t-3600*e-60*i,n=`${e}`,a=`${i}`.padStart(2,"0");`${s}`.padStart(2,"0");return`${n}:${a}`}}});yt.commit("registerPlugin",{kebabName:"x-y-t",prettyName:"X/Y Time Viewer",description:"Displays point data over time",filePatterns:["**/viz-xyt-*.y?(a)ml","**/*xyt.csv?(.gz)"],component:Mi});const Oi={};var Pi=bt(Mi,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"viz-plugin",class:{"hide-thumbnail":!t.thumbnail},attrs:{oncontextmenu:"return false",id:`id-${t.viewId}`}},[t.thumbnail?t._e():i("xy-time-deck-map",{staticClass:"map-layer",attrs:{viewId:t.viewId,pointLayers:t.pointLayers,timeFilter:t.timeFilter,dark:this.$store.state.isDarkMode,colors:this.colors,breakpoints:this.breakpoints,radius:this.guiConfig.radius,mapIsIndependent:!1}}),t.thumbnail?t._e():i("zoom-buttons",{attrs:{corner:"bottom"}}),i("div",{staticClass:"top-right"},[i("div",{staticClass:"gui-config",attrs:{id:t.configId}})]),i("div",{staticClass:"bottom-right"},[t.legendStore?i("div",{staticClass:"legend-area"},[i("legend-box",{attrs:{legendStore:t.legendStore}})],1):t._e()]),t.isLoaded?i("time-slider",{staticClass:"time-slider-area",attrs:{range:t.timeRange,activeTimeExtent:t.timeFilter,labels:t.timeLabels,isAnimating:t.isAnimating},on:{timeExtent:t.handleTimeSliderValues,toggleAnimation:t.toggleAnimation,drag:function(e){t.isAnimating=!1}}}):t._e(),!t.thumbnail&&t.myState.statusMessage?i("div",{staticClass:"message"},[i("p",{staticClass:"status-message"},[t._v(t._s(t.myState.statusMessage))])]):t._e()],1)}),[],!1,$i,"0535e2a1",null,null);function $i(t){for(let e in Oi)this[e]=Oi[e]}const Ii={Summary:yi,AggregateOd:at,Events:Xe,AreaMap:ot,Network:rt,Transit:lt,CarrierViewer:ct,Hexagons:ht,Sankey:dt,Plotly:ut,VegaLite:mt,VehicleView:gi,XYT:function(){return Pi.exports}(),VidPlayer:Ei,ImageView:Di,XmasKelheim:ye,Flowmap:gt};
/*! @license DOMPurify 2.4.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.4.0/LICENSE */function Ni(t){return(Ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hi(t,e){return(Hi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ji(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Bi(t,e,i){return(Bi=ji()?Reflect.construct:function(t,e,i){var s=[null];s.push.apply(s,e);var n=new(Function.bind.apply(t,s));return i&&Hi(n,i.prototype),n}).apply(null,arguments)}function Vi(t){return function(t){if(Array.isArray(t))return Wi(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Wi(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Wi(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wi(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}var qi=Object.hasOwnProperty,Ui=Object.setPrototypeOf,Gi=Object.isFrozen,Yi=Object.getPrototypeOf,Xi=Object.getOwnPropertyDescriptor,Ji=Object.freeze,Ki=Object.seal,Zi=Object.create,Qi="undefined"!=typeof Reflect&&Reflect,ts=Qi.apply,es=Qi.construct;ts||(ts=function(t,e,i){return t.apply(e,i)}),Ji||(Ji=function(t){return t}),Ki||(Ki=function(t){return t}),es||(es=function(t,e){return Bi(t,Vi(e))});var is,ss=ms(Array.prototype.forEach),ns=ms(Array.prototype.pop),as=ms(Array.prototype.push),os=ms(String.prototype.toLowerCase),rs=ms(String.prototype.match),ls=ms(String.prototype.replace),cs=ms(String.prototype.indexOf),hs=ms(String.prototype.trim),ds=ms(RegExp.prototype.test),us=(is=TypeError,function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return es(is,e)});function ms(t){return function(e){for(var i=arguments.length,s=new Array(i>1?i-1:0),n=1;n<i;n++)s[n-1]=arguments[n];return ts(t,e,s)}}function gs(t,e,i){i=i||os,Ui&&Ui(t,null);for(var s=e.length;s--;){var n=e[s];if("string"==typeof n){var a=i(n);a!==n&&(Gi(e)||(e[s]=a),n=a)}t[n]=!0}return t}function ps(t){var e,i=Zi(null);for(e in t)ts(qi,t,[e])&&(i[e]=t[e]);return i}function fs(t,e){for(;null!==t;){var i=Xi(t,e);if(i){if(i.get)return ms(i.get);if("function"==typeof i.value)return ms(i.value)}t=Yi(t)}return function(t){return console.warn("fallback value for",t),null}}var vs=Ji(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),bs=Ji(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ys=Ji(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Ss=Ji(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ws=Ji(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),Cs=Ji(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ts=Ji(["#text"]),Es=Ji(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),As=Ji(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ks=Ji(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),_s=Ji(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),xs=Ki(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Ds=Ki(/<%[\w\W]*|[\w\W]*%>/gm),Ls=Ki(/^data-[\-\w.\u00B7-\uFFFF]/),zs=Ki(/^aria-[\-\w]+$/),Rs=Ki(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Fs=Ki(/^(?:\w+script|data):/i),Ms=Ki(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Os=Ki(/^html$/i),Ps=function(){return"undefined"==typeof window?null:window},$s=function(t,e){if("object"!==Ni(t)||"function"!=typeof t.createPolicy)return null;var i=null,s="data-tt-policy-suffix";e.currentScript&&e.currentScript.hasAttribute(s)&&(i=e.currentScript.getAttribute(s));var n="dompurify"+(i?"#"+i:"");try{return t.createPolicy(n,{createHTML:function(t){return t},createScriptURL:function(t){return t}})}catch(a){return console.warn("TrustedTypes policy "+n+" could not be created."),null}};var Is=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ps(),i=function(e){return t(e)};if(i.version="2.4.0",i.removed=[],!e||!e.document||9!==e.document.nodeType)return i.isSupported=!1,i;var s=e.document,n=e.document,a=e.DocumentFragment,o=e.HTMLTemplateElement,r=e.Node,l=e.Element,c=e.NodeFilter,h=e.NamedNodeMap,d=void 0===h?e.NamedNodeMap||e.MozNamedAttrMap:h,u=e.HTMLFormElement,m=e.DOMParser,g=e.trustedTypes,p=l.prototype,f=fs(p,"cloneNode"),v=fs(p,"nextSibling"),b=fs(p,"childNodes"),y=fs(p,"parentNode");if("function"==typeof o){var S=n.createElement("template");S.content&&S.content.ownerDocument&&(n=S.content.ownerDocument)}var w=$s(g,s),C=w?w.createHTML(""):"",T=n,E=T.implementation,A=T.createNodeIterator,k=T.createDocumentFragment,_=T.getElementsByTagName,x=s.importNode,D={};try{D=ps(n).documentMode?n.documentMode:{}}catch(Wt){}var L={};i.isSupported="function"==typeof y&&E&&void 0!==E.createHTMLDocument&&9!==D;var z,R,F=xs,M=Ds,O=Ls,P=zs,$=Fs,I=Ms,N=Rs,H=null,j=gs({},[].concat(Vi(vs),Vi(bs),Vi(ys),Vi(ws),Vi(Ts))),B=null,V=gs({},[].concat(Vi(Es),Vi(As),Vi(ks),Vi(_s))),W=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),q=null,U=null,G=!0,Y=!0,X=!1,J=!1,K=!1,Z=!1,Q=!1,tt=!1,et=!1,it=!1,st=!0,nt=!1,at="user-content-",ot=!0,rt=!1,lt={},ct=null,ht=gs({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),dt=null,ut=gs({},["audio","video","img","source","image","track"]),mt=null,gt=gs({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),pt="http://www.w3.org/1998/Math/MathML",ft="http://www.w3.org/2000/svg",vt="http://www.w3.org/1999/xhtml",bt=vt,yt=!1,St=["application/xhtml+xml","text/html"],wt="text/html",Ct=null,Tt=n.createElement("form"),Et=function(t){return t instanceof RegExp||t instanceof Function},At=function(t){Ct&&Ct===t||(t&&"object"===Ni(t)||(t={}),t=ps(t),z=z=-1===St.indexOf(t.PARSER_MEDIA_TYPE)?wt:t.PARSER_MEDIA_TYPE,R="application/xhtml+xml"===z?function(t){return t}:os,H="ALLOWED_TAGS"in t?gs({},t.ALLOWED_TAGS,R):j,B="ALLOWED_ATTR"in t?gs({},t.ALLOWED_ATTR,R):V,mt="ADD_URI_SAFE_ATTR"in t?gs(ps(gt),t.ADD_URI_SAFE_ATTR,R):gt,dt="ADD_DATA_URI_TAGS"in t?gs(ps(ut),t.ADD_DATA_URI_TAGS,R):ut,ct="FORBID_CONTENTS"in t?gs({},t.FORBID_CONTENTS,R):ht,q="FORBID_TAGS"in t?gs({},t.FORBID_TAGS,R):{},U="FORBID_ATTR"in t?gs({},t.FORBID_ATTR,R):{},lt="USE_PROFILES"in t&&t.USE_PROFILES,G=!1!==t.ALLOW_ARIA_ATTR,Y=!1!==t.ALLOW_DATA_ATTR,X=t.ALLOW_UNKNOWN_PROTOCOLS||!1,J=t.SAFE_FOR_TEMPLATES||!1,K=t.WHOLE_DOCUMENT||!1,tt=t.RETURN_DOM||!1,et=t.RETURN_DOM_FRAGMENT||!1,it=t.RETURN_TRUSTED_TYPE||!1,Q=t.FORCE_BODY||!1,st=!1!==t.SANITIZE_DOM,nt=t.SANITIZE_NAMED_PROPS||!1,ot=!1!==t.KEEP_CONTENT,rt=t.IN_PLACE||!1,N=t.ALLOWED_URI_REGEXP||N,bt=t.NAMESPACE||vt,t.CUSTOM_ELEMENT_HANDLING&&Et(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(W.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&Et(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(W.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(W.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),J&&(Y=!1),et&&(tt=!0),lt&&(H=gs({},Vi(Ts)),B=[],!0===lt.html&&(gs(H,vs),gs(B,Es)),!0===lt.svg&&(gs(H,bs),gs(B,As),gs(B,_s)),!0===lt.svgFilters&&(gs(H,ys),gs(B,As),gs(B,_s)),!0===lt.mathMl&&(gs(H,ws),gs(B,ks),gs(B,_s))),t.ADD_TAGS&&(H===j&&(H=ps(H)),gs(H,t.ADD_TAGS,R)),t.ADD_ATTR&&(B===V&&(B=ps(B)),gs(B,t.ADD_ATTR,R)),t.ADD_URI_SAFE_ATTR&&gs(mt,t.ADD_URI_SAFE_ATTR,R),t.FORBID_CONTENTS&&(ct===ht&&(ct=ps(ct)),gs(ct,t.FORBID_CONTENTS,R)),ot&&(H["#text"]=!0),K&&gs(H,["html","head","body"]),H.table&&(gs(H,["tbody"]),delete q.tbody),Ji&&Ji(t),Ct=t)},kt=gs({},["mi","mo","mn","ms","mtext"]),_t=gs({},["foreignobject","desc","title","annotation-xml"]),xt=gs({},["title","style","font","a","script"]),Dt=gs({},bs);gs(Dt,ys),gs(Dt,Ss);var Lt=gs({},ws);gs(Lt,Cs);var zt=function(t){var e=y(t);e&&e.tagName||(e={namespaceURI:vt,tagName:"template"});var i=os(t.tagName),s=os(e.tagName);return t.namespaceURI===ft?e.namespaceURI===vt?"svg"===i:e.namespaceURI===pt?"svg"===i&&("annotation-xml"===s||kt[s]):Boolean(Dt[i]):t.namespaceURI===pt?e.namespaceURI===vt?"math"===i:e.namespaceURI===ft?"math"===i&&_t[s]:Boolean(Lt[i]):t.namespaceURI===vt&&(!(e.namespaceURI===ft&&!_t[s])&&(!(e.namespaceURI===pt&&!kt[s])&&(!Lt[i]&&(xt[i]||!Dt[i]))))},Rt=function(t){as(i.removed,{element:t});try{t.parentNode.removeChild(t)}catch(Wt){try{t.outerHTML=C}catch(e){t.remove()}}},Ft=function(t,e){try{as(i.removed,{attribute:e.getAttributeNode(t),from:e})}catch(Wt){as(i.removed,{attribute:null,from:e})}if(e.removeAttribute(t),"is"===t&&!B[t])if(tt||et)try{Rt(e)}catch(Wt){}else try{e.setAttribute(t,"")}catch(Wt){}},Mt=function(t){var e,i;if(Q)t="<remove></remove>"+t;else{var s=rs(t,/^[\r\n\t ]+/);i=s&&s[0]}"application/xhtml+xml"===z&&(t='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+t+"</body></html>");var a=w?w.createHTML(t):t;if(bt===vt)try{e=(new m).parseFromString(a,z)}catch(Wt){}if(!e||!e.documentElement){e=E.createDocument(bt,"template",null);try{e.documentElement.innerHTML=yt?"":a}catch(Wt){}}var o=e.body||e.documentElement;return t&&i&&o.insertBefore(n.createTextNode(i),o.childNodes[0]||null),bt===vt?_.call(e,K?"html":"body")[0]:K?e.documentElement:o},Ot=function(t){return A.call(t.ownerDocument||t,t,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT,null,!1)},Pt=function(t){return t instanceof u&&("string"!=typeof t.nodeName||"string"!=typeof t.textContent||"function"!=typeof t.removeChild||!(t.attributes instanceof d)||"function"!=typeof t.removeAttribute||"function"!=typeof t.setAttribute||"string"!=typeof t.namespaceURI||"function"!=typeof t.insertBefore)},$t=function(t){return"object"===Ni(r)?t instanceof r:t&&"object"===Ni(t)&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName},It=function(t,e,s){L[t]&&ss(L[t],(function(t){t.call(i,e,s,Ct)}))},Nt=function(t){var e;if(It("beforeSanitizeElements",t,null),Pt(t))return Rt(t),!0;if(ds(/[\u0080-\uFFFF]/,t.nodeName))return Rt(t),!0;var s=R(t.nodeName);if(It("uponSanitizeElement",t,{tagName:s,allowedTags:H}),t.hasChildNodes()&&!$t(t.firstElementChild)&&(!$t(t.content)||!$t(t.content.firstElementChild))&&ds(/<[/\w]/g,t.innerHTML)&&ds(/<[/\w]/g,t.textContent))return Rt(t),!0;if("select"===s&&ds(/<template/i,t.innerHTML))return Rt(t),!0;if(!H[s]||q[s]){if(!q[s]&&jt(s)){if(W.tagNameCheck instanceof RegExp&&ds(W.tagNameCheck,s))return!1;if(W.tagNameCheck instanceof Function&&W.tagNameCheck(s))return!1}if(ot&&!ct[s]){var n=y(t)||t.parentNode,a=b(t)||t.childNodes;if(a&&n)for(var o=a.length-1;o>=0;--o)n.insertBefore(f(a[o],!0),v(t))}return Rt(t),!0}return t instanceof l&&!zt(t)?(Rt(t),!0):"noscript"!==s&&"noembed"!==s||!ds(/<\/no(script|embed)/i,t.innerHTML)?(J&&3===t.nodeType&&(e=t.textContent,e=ls(e,F," "),e=ls(e,M," "),t.textContent!==e&&(as(i.removed,{element:t.cloneNode()}),t.textContent=e)),It("afterSanitizeElements",t,null),!1):(Rt(t),!0)},Ht=function(t,e,i){if(st&&("id"===e||"name"===e)&&(i in n||i in Tt))return!1;if(Y&&!U[e]&&ds(O,e));else if(G&&ds(P,e));else if(!B[e]||U[e]){if(!(jt(t)&&(W.tagNameCheck instanceof RegExp&&ds(W.tagNameCheck,t)||W.tagNameCheck instanceof Function&&W.tagNameCheck(t))&&(W.attributeNameCheck instanceof RegExp&&ds(W.attributeNameCheck,e)||W.attributeNameCheck instanceof Function&&W.attributeNameCheck(e))||"is"===e&&W.allowCustomizedBuiltInElements&&(W.tagNameCheck instanceof RegExp&&ds(W.tagNameCheck,i)||W.tagNameCheck instanceof Function&&W.tagNameCheck(i))))return!1}else if(mt[e]);else if(ds(N,ls(i,I,"")));else if("src"!==e&&"xlink:href"!==e&&"href"!==e||"script"===t||0!==cs(i,"data:")||!dt[t]){if(X&&!ds($,ls(i,I,"")));else if(i)return!1}else;return!0},jt=function(t){return t.indexOf("-")>0},Bt=function(t){var e,s,n,a;It("beforeSanitizeAttributes",t,null);var o=t.attributes;if(o){var r={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:B};for(a=o.length;a--;){var l=e=o[a],c=l.name,h=l.namespaceURI;if(s="value"===c?e.value:hs(e.value),n=R(c),r.attrName=n,r.attrValue=s,r.keepAttr=!0,r.forceKeepAttr=void 0,It("uponSanitizeAttribute",t,r),s=r.attrValue,!r.forceKeepAttr&&(Ft(c,t),r.keepAttr))if(ds(/\/>/i,s))Ft(c,t);else{J&&(s=ls(s,F," "),s=ls(s,M," "));var d=R(t.nodeName);if(Ht(d,n,s)){if(!nt||"id"!==n&&"name"!==n||(Ft(c,t),s=at+s),w&&"object"===Ni(g)&&"function"==typeof g.getAttributeType)if(h);else switch(g.getAttributeType(d,n)){case"TrustedHTML":s=w.createHTML(s);break;case"TrustedScriptURL":s=w.createScriptURL(s)}try{h?t.setAttributeNS(h,c,s):t.setAttribute(c,s),ns(i.removed)}catch(Wt){}}}}It("afterSanitizeAttributes",t,null)}},Vt=function t(e){var i,s=Ot(e);for(It("beforeSanitizeShadowDOM",e,null);i=s.nextNode();)It("uponSanitizeShadowNode",i,null),Nt(i)||(i.content instanceof a&&t(i.content),Bt(i));It("afterSanitizeShadowDOM",e,null)};return i.sanitize=function(t){var n,o,l,c,h,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((yt=!t)&&(t="\x3c!--\x3e"),"string"!=typeof t&&!$t(t)){if("function"!=typeof t.toString)throw us("toString is not a function");if("string"!=typeof(t=t.toString()))throw us("dirty is not a string, aborting")}if(!i.isSupported){if("object"===Ni(e.toStaticHTML)||"function"==typeof e.toStaticHTML){if("string"==typeof t)return e.toStaticHTML(t);if($t(t))return e.toStaticHTML(t.outerHTML)}return t}if(Z||At(d),i.removed=[],"string"==typeof t&&(rt=!1),rt){if(t.nodeName){var u=R(t.nodeName);if(!H[u]||q[u])throw us("root node is forbidden and cannot be sanitized in-place")}}else if(t instanceof r)1===(o=(n=Mt("\x3c!----\x3e")).ownerDocument.importNode(t,!0)).nodeType&&"BODY"===o.nodeName||"HTML"===o.nodeName?n=o:n.appendChild(o);else{if(!tt&&!J&&!K&&-1===t.indexOf("<"))return w&&it?w.createHTML(t):t;if(!(n=Mt(t)))return tt?null:it?C:""}n&&Q&&Rt(n.firstChild);for(var m=Ot(rt?t:n);l=m.nextNode();)3===l.nodeType&&l===c||Nt(l)||(l.content instanceof a&&Vt(l.content),Bt(l),c=l);if(c=null,rt)return t;if(tt){if(et)for(h=k.call(n.ownerDocument);n.firstChild;)h.appendChild(n.firstChild);else h=n;return B.shadowroot&&(h=x.call(s,h,!0)),h}var g=K?n.outerHTML:n.innerHTML;return K&&H["!doctype"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&ds(Os,n.ownerDocument.doctype.name)&&(g="<!DOCTYPE "+n.ownerDocument.doctype.name+">\n"+g),J&&(g=ls(g,F," "),g=ls(g,M," ")),w&&it?w.createHTML(g):g},i.setConfig=function(t){At(t),Z=!0},i.clearConfig=function(){Ct=null,Z=!1},i.isValidAttribute=function(t,e,i){Ct||At({});var s=R(t),n=R(e);return Ht(s,n,i)},i.addHook=function(t,e){"function"==typeof e&&(L[t]=L[t]||[],as(L[t],e))},i.removeHook=function(t){if(L[t])return ns(L[t])},i.removeHooks=function(t){L[t]&&(L[t]=[])},i.removeAllHooks=function(){L={}},i}(),Ns=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},Hs=function(t){return"IMG"===t.tagName},js=function(t){return t&&1===t.nodeType},Bs=function(t){return".svg"===(t.currentSrc||t.src).substr(-4).toLowerCase()},Vs=function(t){try{return Array.isArray(t)?t.filter(Hs):function(t){return NodeList.prototype.isPrototypeOf(t)}(t)?[].slice.call(t).filter(Hs):js(t)?[t].filter(Hs):"string"==typeof t?[].slice.call(document.querySelectorAll(t)).filter(Hs):[]}catch(e){throw new TypeError("The provided selector is invalid.\nExpects a CSS selector, a Node element, a NodeList or an array.\nSee: https://github.com/francoischalifour/medium-zoom")}},Ws=function(t){var e=document.createElement("div");return e.classList.add("medium-zoom-overlay"),e.style.background=t,e},qs=function(t){var e=t.getBoundingClientRect(),i=e.top,s=e.left,n=e.width,a=e.height,o=t.cloneNode(),r=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,l=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return o.removeAttribute("id"),o.style.position="absolute",o.style.top=i+r+"px",o.style.left=s+l+"px",o.style.width=n+"px",o.style.height=a+"px",o.style.transform="",o},Us=function(t,e){var i=Ns({bubbles:!1,cancelable:!1,detail:void 0},e);if("function"==typeof window.CustomEvent)return new CustomEvent(t,i);var s=document.createEvent("CustomEvent");return s.initCustomEvent(t,i.bubbles,i.cancelable,i.detail),s};
/*! medium-zoom 1.0.6 | MIT License | https://github.com/francoischalifour/medium-zoom */!function(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&s.firstChild?s.insertBefore(n,s.firstChild):s.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}(".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}");var Gs=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=window.Promise||function(t){function e(){}t(e,e)},n=function(t){var e=t.target;e!==A?-1!==y.indexOf(e)&&p({target:e}):g()},a=function(){if(!w&&E.original){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(C-t)>T.scrollOffset&&setTimeout(g,150)}},o=function(t){var e=t.key||t.keyCode;"Escape"!==e&&"Esc"!==e&&27!==e||g()},r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t;if(t.background&&(A.style.background=t.background),t.container&&t.container instanceof Object&&(e.container=Ns({},T.container,t.container)),t.template){var i=js(t.template)?t.template:document.querySelector(t.template);e.template=i}return T=Ns({},T,e),y.forEach((function(t){t.dispatchEvent(Us("medium-zoom:update",{detail:{zoom:k}}))})),k},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(Ns({},T,e))},c=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var s=e.reduce((function(t,e){return[].concat(t,Vs(e))}),[]);return s.filter((function(t){return-1===y.indexOf(t)})).forEach((function(t){y.push(t),t.classList.add("medium-zoom-image")})),S.forEach((function(t){var e=t.type,i=t.listener,n=t.options;s.forEach((function(t){t.addEventListener(e,i,n)}))})),k},h=function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];E.zoomed&&g();var s=e.length>0?e.reduce((function(t,e){return[].concat(t,Vs(e))}),[]):y;return s.forEach((function(t){t.classList.remove("medium-zoom-image"),t.dispatchEvent(Us("medium-zoom:detach",{detail:{zoom:k}}))})),y=y.filter((function(t){return-1===s.indexOf(t)})),k},d=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return y.forEach((function(s){s.addEventListener("medium-zoom:"+t,e,i)})),S.push({type:"medium-zoom:"+t,listener:e,options:i}),k},u=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return y.forEach((function(s){s.removeEventListener("medium-zoom:"+t,e,i)})),S=S.filter((function(i){return!(i.type==="medium-zoom:"+t&&i.listener.toString()===e.toString())})),k},m=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,i=function(){var t={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},e=void 0,i=void 0;if(T.container)if(T.container instanceof Object)e=(t=Ns({},t,T.container)).width-t.left-t.right-2*T.margin,i=t.height-t.top-t.bottom-2*T.margin;else{var s=(js(T.container)?T.container:document.querySelector(T.container)).getBoundingClientRect(),n=s.width,a=s.height,o=s.left,r=s.top;t=Ns({},t,{width:n,height:a,left:o,top:r})}e=e||t.width-2*T.margin,i=i||t.height-2*T.margin;var l=E.zoomedHd||E.original,c=Bs(l)?e:l.naturalWidth||e,h=Bs(l)?i:l.naturalHeight||i,d=l.getBoundingClientRect(),u=d.top,m=d.left,g=d.width,p=d.height,f=Math.min(c,e)/g,v=Math.min(h,i)/p,b=Math.min(f,v),y="scale("+b+") translate3d("+((e-g)/2-m+T.margin+t.left)/b+"px, "+((i-p)/2-u+T.margin+t.top)/b+"px, 0)";E.zoomed.style.transform=y,E.zoomedHd&&(E.zoomedHd.style.transform=y)};return new s((function(t){if(e&&-1===y.indexOf(e))t(k);else{if(E.zoomed)t(k);else{if(e)E.original=e;else{if(!(y.length>0))return void t(k);var s=y;E.original=s[0]}if(E.original.dispatchEvent(Us("medium-zoom:open",{detail:{zoom:k}})),C=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,w=!0,E.zoomed=qs(E.original),document.body.appendChild(A),T.template){var n=js(T.template)?T.template:document.querySelector(T.template);E.template=document.createElement("div"),E.template.appendChild(n.content.cloneNode(!0)),document.body.appendChild(E.template)}if(document.body.appendChild(E.zoomed),window.requestAnimationFrame((function(){document.body.classList.add("medium-zoom--opened")})),E.original.classList.add("medium-zoom-image--hidden"),E.zoomed.classList.add("medium-zoom-image--opened"),E.zoomed.addEventListener("click",g),E.zoomed.addEventListener("transitionend",(function e(){w=!1,E.zoomed.removeEventListener("transitionend",e),E.original.dispatchEvent(Us("medium-zoom:opened",{detail:{zoom:k}})),t(k)})),E.original.getAttribute("data-zoom-src")){E.zoomedHd=E.zoomed.cloneNode(),E.zoomedHd.removeAttribute("srcset"),E.zoomedHd.removeAttribute("sizes"),E.zoomedHd.src=E.zoomed.getAttribute("data-zoom-src"),E.zoomedHd.onerror=function(){clearInterval(a),console.warn("Unable to reach the zoom image target "+E.zoomedHd.src),E.zoomedHd=null,i()};var a=setInterval((function(){E.zoomedHd.complete&&(clearInterval(a),E.zoomedHd.classList.add("medium-zoom-image--opened"),E.zoomedHd.addEventListener("click",g),document.body.appendChild(E.zoomedHd),i())}),10)}else if(E.original.hasAttribute("srcset")){E.zoomedHd=E.zoomed.cloneNode(),E.zoomedHd.removeAttribute("sizes"),E.zoomedHd.removeAttribute("loading");var o=E.zoomedHd.addEventListener("load",(function(){E.zoomedHd.removeEventListener("load",o),E.zoomedHd.classList.add("medium-zoom-image--opened"),E.zoomedHd.addEventListener("click",g),document.body.appendChild(E.zoomedHd),i()}))}else i()}}}))},g=function(){return new s((function(t){if(!w&&E.original){w=!0,document.body.classList.remove("medium-zoom--opened"),E.zoomed.style.transform="",E.zoomedHd&&(E.zoomedHd.style.transform=""),E.template&&(E.template.style.transition="opacity 150ms",E.template.style.opacity=0),E.original.dispatchEvent(Us("medium-zoom:close",{detail:{zoom:k}})),E.zoomed.addEventListener("transitionend",(function e(){E.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(E.zoomed),E.zoomedHd&&document.body.removeChild(E.zoomedHd),document.body.removeChild(A),E.zoomed.classList.remove("medium-zoom-image--opened"),E.template&&document.body.removeChild(E.template),w=!1,E.zoomed.removeEventListener("transitionend",e),E.original.dispatchEvent(Us("medium-zoom:closed",{detail:{zoom:k}})),E.original=null,E.zoomed=null,E.zoomedHd=null,E.template=null,t(k)}))}else t(k)}))},p=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target;return E.original?g():m({target:e})},f=function(){return T},v=function(){return y},b=function(){return E.original},y=[],S=[],w=!1,C=0,T=i,E={original:null,zoomed:null,zoomedHd:null,template:null};"[object Object]"===Object.prototype.toString.call(e)?T=e:(e||"string"==typeof e)&&c(e),T=Ns({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},T);var A=Ws(T.background);document.addEventListener("click",n),document.addEventListener("keyup",o),document.addEventListener("scroll",a),window.addEventListener("resize",g);var k={open:m,close:g,toggle:p,update:r,clone:l,attach:c,detach:h,on:d,off:u,getOptions:f,getImages:v,getZoomedImage:b};return k};var Ys=d({name:"TopsheetsFinder",i18n:{messages:{en:{title:"Key Performance Indicators"}}},components:{TopSheet:nt},props:{fileSystemConfig:{type:Object,required:!0},subfolder:{type:String,required:!0},files:{type:Array,required:!0}},computed:{fileApi(){return new S(this.fileSystemConfig)}},data:()=>({allConfigFiles:{},topsheets:[]}),watch:{subfolder(){this.filesUpdated()},files(){this.filesUpdated()}},methods:{async findTopsheetsForThisFolder(){return this.allConfigFiles=await this.fileApi.findAllYamlConfigs(this.subfolder),Object.values(this.allConfigFiles.topsheets)},async filesUpdated(){this.files.length&&(this.topsheets=await this.findTopsheetsForThisFolder())}}});const Xs={};var Js=bt(Ys,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"topsheets-finder curate-content"},t._l(t.topsheets,(function(e){return i("top-sheet",{key:e,attrs:{fileSystemConfig:t.fileSystemConfig,subfolder:t.subfolder,files:t.files,yaml:e,allConfigFiles:t.allConfigFiles}})})),1)}),[],!1,Ks,"13752aaf",null,null);function Ks(t){for(let e in Xs)this[e]=Xs[e]}var Zs=function(){return Js.exports}();const Qs={"":"#118860","aggregate-od":"#E98B52","vehicle-anim":"#330033","x-y-t":"#583270","carrier-viewer":"#c97A2C",events:"#4400ff",hexagons:"#900564","area-map":"#c94264",network:"#894654",sankey:"#D8A672",summary:"#2EA95B",transit:"#3B6FE4"};var tn=d({name:"FolderBrowser",i18n:{messages:{en:{Maps:"Maps",Images:"Images",Analysis:"Analysis",Files:"Files",Folders:"Folders",Topsheet:"Topsheet"},de:{Maps:"Karten",Images:"Bilder",Analysis:"Ergebnisse",Files:"Dateien",Folders:"Ordner",Topsheet:"Topsheet"}}},components:Object.assign({TopsheetsFinder:Zs},Ii),props:{root:{type:String,required:!0},allConfigFiles:{type:Object,required:!0},xsubfolder:String},data:()=>({globalState:yt.state,summaryYamlFilename:"viz-summary.yml",mdRenderer:new pt({html:!0,linkify:!0,typographer:!0}),myState:{errorStatus:"",folders:[],files:[],isLoading:!1,readme:"",svnProject:null,svnRoot:void 0,subfolder:"",vizes:[],summary:!1}}),computed:{vizImages(){const t={};for(let e=0;e<this.myState.vizes.length;e++)"image-view"===this.myState.vizes[e].component&&(t[e]=this.myState.vizes[e]);return t},vizMaps(){const t={};for(let e=0;e<this.myState.vizes.length;e++)"image-view"!==this.myState.vizes[e].component&&(t[e]=this.myState.vizes[e]);return t}},methods:{cleanName:t=>decodeURIComponent(t),getFileSystem(t){const e=yt.state.svnProjects.filter((e=>e.slug===t));if(0===e.length)throw console.log("no such project"),Error;return e[0]},generateBreadcrumbs(){if(!this.myState.svnProject)return[];const t=[{label:"SimWrapper",url:"/"},{label:this.myState.svnProject.name,url:"/"+this.myState.svnProject.slug}],e=this.myState.subfolder.split("/");let i="/";for(const s of e)s&&(i+=s+"/",t.push({label:s,url:"/"+this.myState.svnProject.slug+i}));return yt.commit("setBreadCrumbs",t),t},clickedVisualization(t){const e=this.myState.vizes[t];if("image-view"===e.component)return;if(!this.myState.svnProject)return;const i={root:this.myState.svnProject.slug,xsubfolder:this.myState.subfolder,subfolder:this.myState.subfolder,yamlConfig:e.config,thumbnail:!1};this.$emit("navigate",{component:e.component,props:i})},updateTitle(t,e){this.myState.vizes[t].title=e},async showReadme(){this.myState.readme="";const t="readme.md";if(this.myState.files.map((t=>t.toLocaleLowerCase())).indexOf(t)>-1){if(!this.myState.svnRoot)return;const e=await this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+t);this.myState.readme=this.mdRenderer.render(e)}},buildShowEverythingView(){for(const t of this.globalState.visualizationTypes.values()){const e=ft(this.myState.files,t.filePatterns,{nocase:!0});for(const i of e)this.myState.vizes.push({component:t.kebabName,config:i,title:".."})}},async buildCuratedSummaryView(){if(!this.myState.svnRoot)return;const t=q.parse(await this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+this.summaryYamlFilename));for(const e of t.plugins){const i=this.globalState.visualizationTypes.get(e);if(i)if(t[i.kebabName])for(const e of t[i.kebabName]){const t=await this.findMatchingFiles(e);for(const e of t)this.myState.vizes.push({component:i.kebabName,config:e,title:e})}else{const t=ft(this.myState.files,i.filePatterns);for(const e of t)this.myState.vizes.push({component:i.kebabName,config:e,title:".."})}}},async findMatchingFiles(t){if(this.myState.files.indexOf(t)>-1)return[t];const e=ft(this.myState.files,t);if(e.length)return e;if(!this.myState.svnRoot)return[];try{const e=t.split("/"),i=this.myState.subfolder+"/"+e[0];console.log(i);const s=await this.myState.svnRoot.getDirectory(i);return ft(s.files,e[1]).map((t=>e[0]+"/"+t))}catch(i){}return[]},async fetchFolderContents(){if(!this.myState.svnRoot)return[];this.myState.isLoading=!0,this.myState.errorStatus="",this.myState.files=[];try{const t=await this.myState.svnRoot.getDirectory(this.myState.subfolder),e=t.dirs.filter((t=>!t.startsWith("."))).sort(),i=t.files.filter((t=>!t.startsWith("."))).sort(),s=Object.assign({},this.allConfigFiles.vizes);for(const a of i)s[a]=a;const n=Object.values(s);this.myState.errorStatus="",this.myState.folders=e,this.myState.files=n}catch(t){const e=t;console.log("BAD PAGE"),console.log({eeee:e}),this.myState.folders=[],this.myState.files=[],this.myState.errorStatus="<h3>",e.status&&(this.myState.errorStatus+=`${e.status} `),e.statusText&&(this.myState.errorStatus+=`${e.statusText}`),"<h3>"===this.myState.errorStatus&&(this.myState.errorStatus+="Error"),this.myState.errorStatus+="</h3>",e.url&&(this.myState.errorStatus+=`<p>${e.url}</p>`),e.message&&(this.myState.errorStatus+=`<p>${e.message}</p>`),"<h3>Error</h3>"===this.myState.errorStatus&&(this.myState.errorStatus=""+e),this.myState.svnProject&&(this.myState.errorStatus+=`<p><i>${this.myState.svnProject.baseURL}${this.myState.subfolder}</i></p>`),this.myState.svnProject&&this.myState.svnProject.needPassword&&401===e.status&&yt.commit("requestLogin",this.myState.svnProject.slug)}finally{this.myState.isLoading=!1}},openOutputFolder(t){if(this.myState.isLoading)return;if(!this.myState.svnProject)return;const e=".."===t?this.myState.subfolder.substring(0,this.myState.subfolder.lastIndexOf("/")):this.myState.subfolder+"/"+t,i={root:this.myState.svnProject.slug,xsubfolder:e};e||this.myState.subfolder?this.$emit("navigate",{component:"TabbedDashboardView",props:i}):this.$emit("navigate",{component:"SplashPage",props:{}})},getTabColor:t=>({backgroundColor:Qs[t]||"#8778BB"}),updateRoute(){const t=this.getFileSystem(this.root);this.myState.svnProject=t,this.myState.subfolder=this.xsubfolder||"",this.myState.readme="",this.myState.svnProject&&(this.myState.svnRoot=new S(this.myState.svnProject),this.generateBreadcrumbs(),this.fetchFolderContents())}},watch:{"globalState.colorScheme"(){this.fetchFolderContents()},xsubfolder(){this.updateRoute()},allConfigFiles(){this.updateRoute()},"globalState.authAttempts"(){console.log("AUTH CHANGED - Reload"),this.updateRoute()},async"myState.files"(){this.myState.vizes=[],0!==this.myState.files.length&&(this.showReadme(),this.myState.summary=-1!==this.myState.files.indexOf(this.summaryYamlFilename),this.myState.summary?await this.buildCuratedSummaryView():this.buildShowEverythingView(),await this.$nextTick(),Gs(".medium-zoom",{background:"#444450"}))}},mounted(){this.updateRoute()}});const en={};var sn=bt(tn,(function(){var t,e,i=this,s=i.$createElement,n=i._self._c||s;return n("div",{staticClass:"folder-browser"},[i.myState.errorStatus?n("div",{staticClass:"stripe details"},[n("div",{staticClass:"vessel"},[n("div",{staticClass:"badnews",domProps:{innerHTML:i._s(i.myState.errorStatus)}})])]):n("div",{staticClass:"stripe details"},[n("div",{staticClass:"vessel"},[n("div",{staticClass:"curated-sections"},[n("b",{staticClass:"up-link"},[n("a",{on:{click:function(t){return i.$emit("up")}}},[i._v("^ UP")])]),n("div",{staticClass:"readme-header markdown"},[i.myState.readme?n("div",{staticClass:"curate-content markdown",domProps:{innerHTML:i._s(i.myState.readme)}}):i._e()]),i.myState.folders.length?n("h3",{staticClass:"curate-heading"},[i._v(" "+i._s(i.$t("Folders")))]):i._e(),i.myState.folders.length?n("div",{staticClass:"curate-content"},[n("div",{staticClass:"folder-table"},i._l(i.myState.folders,(function(t){return n("div",{key:t.name,staticClass:"folder",class:{fade:i.myState.isLoading},on:{click:function(e){return i.openOutputFolder(t)}}},[n("p",[n("i",{staticClass:"fa fa-folder-open"}),i._v(" "+i._s(i.cleanName(t)))])])})),0)]):i._e(),Object.keys(i.vizMaps).length?n("div",{staticClass:"section-maps"},[n("h3",{staticClass:"curate-heading"},[i._v(i._s(i.$t("Maps")))]),n("div",{staticClass:"curate-content"},[n("div",{staticClass:"viz-table"},i._l(Object.entries(i.vizMaps),(function(t){var e=t[0],s=t[1];return n("div",{key:e,staticClass:"viz-grid-item",on:{click:function(t){return i.clickedVisualization(e)}}},[n("div",{staticClass:"viz-frame"},[n("p",{staticClass:"v-title"},[n("b",[i._v(i._s(s.title))])]),n("p",{staticClass:"v-filename"},[i._v(i._s(s.config))]),n("p",{staticClass:"v-plugin",style:i.getTabColor(s.component)},[i._v(i._s(s.component||"dashboard"))]),n(s.component,{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],tag:"component",staticClass:"viz-frame-component",style:{"pointer-events":"none"},attrs:{root:i.myState.svnProject.slug,subfolder:i.myState.subfolder,yamlConfig:s.config,thumbnail:!0,fileApi:i.myState.svnRoot},on:{title:function(t){return i.updateTitle(e,t)}}})],1)])})),0)])]):i._e(),Object.keys(i.vizImages).length?n("div",{staticClass:"section-images"},[n("h3",{staticClass:"curate-heading"},[i._v(i._s(i.$t("Images")))]),n("div",{staticClass:"curate-content"},[n("div",{staticClass:"viz-image-table"},i._l(Object.entries(i.vizImages),(function(t){var e=t[0],s=t[1];return n("div",{key:e,staticClass:"viz-image-grid-item",on:{click:function(t){return i.clickedVisualization(e)}}},[n("div",{staticClass:"viz-image-frame"},[n(s.component,{tag:"component",staticClass:"viz-image-frame-component",style:{"pointer-events":"auto"},attrs:{root:i.myState.svnProject.slug,subfolder:i.myState.subfolder,yamlConfig:s.config,thumbnail:!0,fileApi:i.myState.svnRoot},on:{title:function(t){return i.updateTitle(e,t)}}}),n("p",[i._v(i._s(s.title))])],1)])})),0)])]):i._e(),null!==(t=i.myState)&&void 0!==t&&null!==(e=t.svnProject)&&void 0!==e&&e.baseURL?n("div",{staticClass:"files-section"},[i.myState.files.length?n("h3",{staticClass:"curate-heading"},[i._v(i._s(i.$t("Files")))]):i._e(),i.myState.files.length?n("div",{staticClass:"curate-content"},[n("div",{staticClass:"file-table"},i._l(i.myState.files,(function(t){return n("div",{key:t,staticClass:"file",class:{fade:i.myState.isLoading}},[n("a",{attrs:{href:`${i.myState.svnProject.baseURL}/${i.myState.subfolder}/${t}`}},[i._v(i._s(i.cleanName(t)))])])})),0)]):i._e()]):i._e()])])])])}),[],!1,nn,"18713072",null,null);function nn(t){for(let e in en)this[e]=en[e]}var an=function(){return sn.exports}();const on=[".nodashboards","nodashboards","nodashboards.txt"],rn=new pt({html:!0,linkify:!0,typographer:!0});var ln=d({name:"TabbedDashboardView",components:{DashBoard:vt,FolderBrowser:an},props:{root:{type:String,required:!0},xsubfolder:{type:String,required:!0}},data:()=>({dashboards:[],dashboardDataManager:null,allConfigFiles:{dashboards:{},topsheets:{},vizes:{},configs:{}},isZoomed:!1,styleElement:null,loadErrorMessage:"",activeTab:"",pageHeader:"",folderReadme:"",header:"",footer:"",customCSS:"",dashboardTabWithDelay:"",showFooter:!1}),computed:{fileApi(){return new S(this.fileSystem,yt)},fileSystem(){const t=this.$store.state.svnProjects.filter((t=>t.slug===this.root));if(0===t.length)throw console.log("no such project"),Error;return t[0]},wiide(){return this.$store.state.isFullWidth},dashWidthCalculator(){return this.$store.state.dashboardWidth&&this.$store.state.isFullWidth?{maxWidth:this.$store.state.dashboardWidth}:{}}},watch:{root(){this.updateRoute()},xsubfolder(){this.updateRoute()}},methods:{clearStyles(){this.styleElement&&(document.getElementsByTagName("head")[0].removeChild(this.styleElement),this.styleElement=null)},getPageHeader(){return this.xsubfolder?this.xsubfolder.substring(1+this.xsubfolder.lastIndexOf("/")):this.fileSystem.name||this.root},onNavigate(t){this.$emit("navigate",t)},async getFolderReadme(){try{this.folderReadme="";const{files:t}=await this.fileApi.getDirectory(this.xsubfolder),e=t.filter((t=>"readme.md"===t.toLocaleLowerCase()));if(!e.length)return;const i=await this.fileApi.getFileText(`${this.xsubfolder}/${e[0]}`),s=rn.render(i);this.folderReadme=s}catch(t){this.folderReadme=""}},async findConfigsAndDashboards(){if(this.loadErrorMessage="",!this.fileApi)return[];await this.fileApi.getChromePermission(this.fileSystem.handle),this.getFolderReadme();try{this.allConfigFiles=await this.fileApi.findAllYamlConfigs(this.xsubfolder);const{files:e}=await this.fileApi.getDirectory(this.xsubfolder);let i=!0;if(on.forEach((t=>{e.indexOf(t)>-1&&(i=!1)})),i)for(const t of Object.values(this.allConfigFiles.dashboards)){m.set(this.dashboards,t,{header:{tab:"..."}});await this.initDashboard(t)||delete this.dashboards[t]}if(m.set(this.dashboards,"FILE__BROWSER",{header:{tab:"Files"}}),this.$route.query.tab)try{const t=parseInt(""+this.$route.query.tab)-1,e=Object.keys(this.dashboards)[t];this.activeTab=e||Object.keys(this.dashboards)[0]}catch(t){this.activeTab=Object.keys(this.dashboards)[0]}else this.activeTab=Object.keys(this.dashboards)[0];this.dashboardTabWithDelay=this.activeTab,await this.setupProjectConfig()}catch(t){console.warn({eeee:t}),this.fileSystem.handle?this.loadErrorMessage=`Click to grant access to folder "${this.fileSystem.handle.name}"`:this.loadErrorMessage=this.fileSystem.baseURL+": Could not load"}},async setupProjectConfig(){if(Object.keys(this.allConfigFiles.configs).length)for(const e of Object.values(this.allConfigFiles.configs))try{const i=await this.fileApi.getFileText(e),s=q.parse(i),n=e.startsWith("http")?"":e.substring(0,e.indexOf("simwrapper-config.y"));!0===s.hideLeftBar&&this.$store.commit("setShowLeftBar",!1),!1===s.hideLeftBar&&this.$store.commit("setShowLeftBar",!0),this.$store.commit("setFullWidth",!!s.fullWidth),this.$store.commit("setDashboardWidth",""),void 0!==s.width&&(this.$store.commit("setDashboardWidth",""+s.width),this.$store.commit("setFullWidth",!0));try{s.css&&(this.customCSS=await this.fileApi.getFileText(`${n}${s.css}`),this.styleElement=document.createElement("style"),this.styleElement.appendChild(document.createTextNode(this.customCSS)),document.getElementsByTagName("head")[0].appendChild(this.styleElement))}catch(t){}this.header=await this.buildPanel("header",s,n),this.footer=await this.buildPanel("footer",s,n)}catch(t){console.error(""+t)}},handleRemoveDashboard(){},async buildPanel(t,e,i){let s="";if(s="de"===this.$store.state.locale?e[t+"_de"]||e[t]||e[t+"_en"]||"":e[t+"_en"]||e[t]||e[t+"_de"]||"",!s)return"";if(-1==s.indexOf("\n")&&s.endsWith(".md")){s=await this.fileApi.getFileText(`${i}${s}`)}const n=rn.render(s);return Is.sanitize(n,{USE_PROFILES:{html:!0}})},async initDashboard(t){var e;try{const i=await this.fileApi.getFileText(t),s=q.parse(i);if(null==(e=s.header)?void 0:e.triggerPattern){const{files:t,dirs:e}=await this.fileApi.getDirectory(this.xsubfolder),i=[...t,...e];if(0===ft.match(i,s.header.triggerPattern).length)return!1}const n=t.substring(0,t.lastIndexOf("."));return s.header||(s.header={title:t,tab:n}),s.header.tab||(s.header.tab=s.header.title||n),this.dashboards[t]=s,console.log("DASHBOARD:",t),!0}catch(i){return this.$store.commit("setStatus",{type:Et.ERROR,msg:""+i}),!1}},updateRoute(){this.clearStyles(),this.dashboardDataManager&&this.dashboardDataManager.clearCache(),this.dashboardDataManager=new V(this.root,this.xsubfolder),this.header="",this.footer="",this.dashboards=[],this.pageHeader=this.getPageHeader(),this.findConfigsAndDashboards()},async switchTab(t,e){t!==this.activeTab&&(this.activeTab="",this.dashboardTabWithDelay="",this.showFooter=!1,await this.$nextTick(),this.activeTab=t,setTimeout((()=>{this.dashboardTabWithDelay=t,e?this.$router.replace({query:{tab:`${e+1}`}}):this.$router.replace({query:{}})}),125))},handleZoom(t){this.isZoomed=!!t,this.$emit("zoom",this.isZoomed)},handleLayoutComplete(){this.showFooter=!0},getFileSystem(t){const e=this.$store.state.svnProjects.filter((e=>e.slug===t));return 0===e.length?(console.warn("no such project"),this.loadErrorMessage=`Can't locate "${t}": please check running services and browser version.`,null):e[0]},goUpOneFolder(){let t=this.xsubfolder;this.xsubfolder.endsWith("/")&&(t=this.xsubfolder.slice(0,length-1)),t=t.substring(0,t.lastIndexOf("/"));const e={root:this.fileSystem.slug,xsubfolder:t};t||this.xsubfolder?this.onNavigate({component:"TabbedDashboardView",props:e}):this.onNavigate({component:"SplashPage",props:{}})},async authorizeAfterError(){try{const t=this.fileSystem.handle;if(t){"granted"===await t.requestPermission({mode:"read"})&&this.updateRoute()}}catch(t){}},setTitle(){const t=this.xsubfolder.startsWith("/")?this.xsubfolder.slice(1):this.xsubfolder,e=`${this.fileSystem.name}: ${t}`;this.$emit("title",e)}},mounted(){this.updateRoute(),this.setTitle()},beforeDestroy(){this.dashboardDataManager&&this.dashboardDataManager.clearCache(),this.clearStyles()}});const cn={};var hn=bt(ln,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tabbed-folder-view"},[i("div",{staticClass:"centered-vessel",class:{wiide:t.wiide}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isZoomed,expression:"!isZoomed"}],staticClass:"tabholder",style:t.dashWidthCalculator},[i("div",{staticClass:"tabholdercontainer"},[t.header?i("div",{staticClass:"project-header",domProps:{innerHTML:t._s(t.header)}}):t._e(),i("div",{staticClass:"tabs is-centered"},[i("ul",{staticStyle:{"margin-right":"1rem"}},t._l(Object.keys(t.dashboards),(function(e,s){return i("li",{key:e,class:{"is-active":e===t.activeTab,"is-not-active":e!==t.activeTab},style:{opacity:e===t.activeTab?1:.5}},[i("b",[t.dashboards[e].header?i("a",{on:{click:function(i){return t.switchTab(e,s)}}},[t._v(t._s(t.dashboards[e].header.tab))]):t._e()])])})),0)])])]),t.dashboardTabWithDelay&&"FILE__BROWSER"!==t.dashboardTabWithDelay&&t.dashboards[t.dashboardTabWithDelay]&&"..."!==t.dashboards[t.dashboardTabWithDelay].header.tab?i("dash-board",{attrs:{root:t.root,xsubfolder:t.xsubfolder,config:t.dashboards[t.dashboardTabWithDelay],datamanager:t.dashboardDataManager,zoomed:t.isZoomed,allConfigFiles:t.allConfigFiles},on:{zoom:t.handleZoom,layoutComplete:t.handleLayoutComplete}}):t._e(),t.dashboardTabWithDelay&&"FILE__BROWSER"===t.dashboardTabWithDelay?i("folder-browser",{attrs:{root:t.root,xsubfolder:t.xsubfolder,allConfigFiles:t.allConfigFiles},on:{navigate:t.onNavigate,up:function(e){return t.goUpOneFolder()}}}):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showFooter&&!t.isZoomed,expression:"showFooter && !isZoomed"}],staticClass:"tabholder",class:{wiide:t.wiide},style:t.dashWidthCalculator},[i("div",{staticClass:"tabholdercontainer",class:{wiide:t.wiide}},[t.footer?i("div",{staticClass:"project-footer",class:{wiide:t.wiide},domProps:{innerHTML:t._s(t.footer)}}):t._e()])])],1)])}),[],!1,dn,"28e9d3ef",null,null);function dn(t){for(let e in cn)this[e]=cn[e]}var un=function(){return hn.exports}(),mn=d({name:"FileSystemComponents",data:()=>({sources:[]}),mounted(){this.sources=yt.state.svnProjects.filter((t=>!t.hidden&&!t.slug.startsWith("fs")))},methods:{openProjectPage(t){const e=Object.assign({},t);e.component="TabbedDashboardView",e.props={root:t.slug,xsubfolder:""},this.$emit("navigate",e)},openProjectTab(t){window.open(t,"_blank")}}});const gn={};var pn=bt(mn,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"svn-projects"},t._l(t.sources,(function(e){return i("div",{key:e.url,staticClass:"project",on:{click:[function(i){return t.openProjectPage(e)},function(i){return i.metaKey?t.openProjectTab(e):null},function(i){return i.ctrlKey?t.openProjectTab(e):null}],mouseup:function(i){return"button"in i&&1!==i.button?null:t.openProjectTab(e)}}},[i("div",{staticClass:"desc"},[i("h3",[t._v(t._s(e.name))]),i("p",[t._v(t._s(e.description))])])])})),0)}),[],!1,fn,"617cdc17",null,null);function fn(t){for(let e in gn)this[e]=gn[e]}var vn=function(){return pn.exports}();const bn={},yn={};var Sn=bt({data:()=>({frontmatter:bn})},(function(){var t=this;t.$createElement;return t._self._c,t._m(0)}),[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"markdown-body"},[i("ul",[i("li",[i("p",[i("a",{attrs:{href:"https://simwrapper.github.io/docs"}},[t._v("Documentation and users guide")]),t._v(" including examples and getting started")])]),i("li",[i("p",[i("a",{attrs:{href:"https://github.com/simwrapper/simwrapper"}},[t._v("Source code")]),t._v(" available on Github")])])])])}],!1,wn,null,null,null);function wn(t){for(let e in yn)this[e]=yn[e]}const Cn=[{url:"https://vsp.berlin/en/",image:"vsp-logo-300dpi.png",name:"VSP TU-Berlin"},{url:"https://matsim.org/",image:"matsim-logo-blue.png",name:"MATSim"},{url:"https://tu.berlin",image:"tu-logo.png",name:"TU Berlin"},{url:"https://bmbf.de",image:"bmbf-logo.png",name:"German Federal BMBF"},{url:"https://www.sfcta.org/",image:"sfcta.png",name:"SFCTA"},{url:"https://metrocouncil.org/",image:"metcouncil.png",name:"Met Council"},{url:"http://www.sandag.org/",image:"sandag.jpg",name:"SANDAG"},{url:"https://mtc.ca.gov/",image:"mtc.png",name:"MTC"},{url:"https://www.psrc.org/",image:"psrc.png",name:"Puget Sound Regional Council"},{url:"https://www.mwcog.org/",image:"mwcog.png",name:"MWCOG"},{url:"https://www.oregon.gov/ODOT",image:"oregondot.png",name:"Oregon DOT"},{url:"https://atlantaregional.org/",image:"arc.png",name:"ARC"},{url:"https://www.transportation.ohio.gov/",image:"ohiodot.png",name:"Ohio DOT"},{url:"http://semcog.org/",image:"semcog.jpg",name:"SEMCOG"}];var Tn=d({name:"SplashPage",i18n:{messages:{en:{"more-info":"Documentation:",tagLine:"the simulation browser and data visualizer from TU&nbsp;Berlin.",privacy:"SimWrapper is a client-side app, which means there is no upstream server collecting or storing data.\n\nSimWrapper does not collect, handle or process any data about you while you use the site. SimWrapper does not contain any tracking devices or analytics software. No user cookies are stored or transmitted."},de:{"more-info":"Für weitere Informationen:",tagLine:"Der Modellergebnis-Browser der TU Berlin."}}},components:{FileSystemProjects:vn,InfoBottom:function(){return Sn.exports}()},data:()=>({state:yt.state,allRoots:[]}),computed:{allLogos:()=>Cn.map((t=>({url:t.url,image:`/report-tncs2020-simwrapper/images/logos/${t.image}`}))),isChrome:()=>!!window.showDirectoryPicker,localFileHandles(){return this.$store.state.localFileHandles.concat().sort(((t,e)=>parseInt(t.key.substring(2))<parseInt(e.key.substring(2))?-1:1))}},methods:{onNavigate(t){this.$emit("navigate",t)},updateShortcuts(){const t=this.state.svnProjects.filter((t=>!t.hidden&&!t.slug.startsWith("fs")));this.allRoots=t},configureSources(){this.$emit("activate",{name:"Settings",class:"SettingsPanel"})},clickedOnFolder(t){const{folder:e,root:i,i:s}=t;let n=`${i}`;e&&(n+=`/${e}`),this.$router.push(n)},async clickedBrowseChromeLocalFolder(t){try{const e=await t.handle.requestPermission({mode:"read"});if(console.log(t.handle,e),"granted"!==e)return;At.find((e=>e.slug==t.key))||kt(t.handle,t.key);const i={root:t.key};this.clickedOnFolder(i)}catch(e){console.error(""+e)}},async showChromeDirectory(){try{const t=window.showDirectoryPicker(),e=await t,i=kt(e,null);this.$router.push(`/report-tncs2020-simwrapper/${i}/`)}catch(t){}},async clickedDelete(t){const e=this.$store.state.localFileHandles.filter((e=>e.key!==t.key));await g("fs",e),this.$store.commit("setLocalFileSystem",e)}},mounted(){if(!this.state.breadcrumbs.length){const t=[{label:"SimWrapper",url:"/"}];yt.commit("setBreadCrumbs",t)}this.updateShortcuts()}});const En={};var An=bt(Tn,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"splash-page"},[i("div",{staticClass:"scrolly"},[i("div",{staticClass:"thing-area"},[i("div",{staticClass:"top-area"},[i("div",{staticClass:"simwrapper-logo"},[t.state.isDarkMode?i("img",{attrs:{src:"/report-tncs2020-simwrapper/assets/SW_logo_yellow.abf06ffb.png"}}):i("img",{attrs:{src:"/report-tncs2020-simwrapper/assets/SW_logo_purple.175fca9f.png"}})])]),i("div",{staticClass:"middle-area"},[t.isChrome?i("div",{staticClass:"is-chrome"},[i("h3",[t._v("Local Folders")]),t.localFileHandles.length?t._e():i("p",[t._v("Chrome & Edge can browse folders directly:")]),i("div",{staticClass:"roots"},t._l(t.localFileHandles,(function(e){return i("div",{key:e.key,staticClass:"project-root local",on:{click:function(i){return t.clickedBrowseChromeLocalFolder(e)}}},[i("h5",{staticClass:"remove-local",staticStyle:{flex:"1"}},[t._v(t._s(e.handle.name)),i("i",{staticClass:"fa fa-times",on:{click:function(i){return i.stopPropagation(),t.clickedDelete(e)}}})]),i("p",[t._v("Local folder")])])})),0),i("p",{staticClass:"config-sources"},[i("a",{on:{click:t.showChromeDirectory}},[t._v("Add local folder...")])])]):t._e(),i("h3",{staticStyle:{"margin-top":"1rem"}},[t._v("Browse Data Sources")]),i("div",{staticClass:"roots"},t._l(t.allRoots,(function(e){return i("div",{key:e.slug,staticClass:"project-root",on:{click:function(i){return t.clickedOnFolder({root:e.slug})}}},[i("h5",[t._v(t._s(e.name))]),i("p",[t._v(t._s(e.description))])])})),0),i("p",{staticClass:"config-sources"},[i("a",{on:{click:t.configureSources}},[t._v("Edit data sources...")])]),i("p",{staticClass:"funding"},[t._v("Funded by TU Berlin, the German Bundesministerium für Bildung und Forschung, and the ActivitySim Consortium member agencies.")]),t._m(0),t._m(1)])]),i("div",{staticClass:"links-and-logos"},[i("div",{staticClass:"logos"},t._l(t.allLogos,(function(t){return i("a",{attrs:{href:t.url,title:t.name,target:"_blank"}},[i("img",{staticClass:"img-logo",attrs:{src:t.image}})])})),0)])])])}),[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"legal"},[i("p",[t._v("SimWrapper is open source and available on "),i("a",{attrs:{href:"https://github.com/simwrapper/simwrapper"}},[t._v("GitHub.")])])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"legal"},[i("p",[i("a",{attrs:{href:"https://vsp.berlin/en/",target:"_blank"}},[t._v("VSP TU Berlin")]),i("a",{attrs:{href:"https://vsp.berlin/impressum/",target:"_blank"}},[t._v("Impressum")]),i("a",{attrs:{href:"https://www.vsp.tu-berlin.de/menue/service/privacy/parameter/en/",target:"_blank"}},[t._v("Privacy")])])])}],!1,kn,"3be2f6ec",null,null);function kn(t){for(let e in En)this[e]=En[e]}var _n=function(){return An.exports}();var xn=d({name:"LeftIconPanel",props:{activeSection:{type:String,required:!0}},data:()=>({state:yt.state,topSections:[{name:"Files",class:"BrowserPanel",icon:"/report-tncs2020-simwrapper/assets/files.4e6d24ab.svg"},{name:"Issues",class:"ErrorPanel",icon:"/report-tncs2020-simwrapper/assets/issues.45ff9b99.svg",colorize:!0}],bottomSections:[{name:"Docs",link:"https://simwrapper.github.io/docs",icon:"/report-tncs2020-simwrapper/assets/readme.bff70382.svg"},{name:"Settings",class:"SettingsPanel",icon:"/report-tncs2020-simwrapper/assets/settings.6e19bc2b.svg"}]}),computed:{issueColor(){return this.state.statusErrors.length?"invert(60%) sepia(100%) hue-rotate(310deg) saturate(8.5)":this.state.statusWarnings.length?"invert(75%) sepia(100%) hue-rotate(15deg) saturate(5.5)":"invert(100%)"}},methods:{select(t){this.$emit("activate",t)},buttonStyle(t){const e=this.state.statusErrors.length||this.state.statusWarnings.length?.8:.4;return this.activeSection!==t.name?{opacity:t.colorize?e:.4}:{opacity:1,borderLeft:"3px solid white"}}}});const Dn={};var Ln=bt(xn,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"left-nav-panel"},[i("div",{staticClass:"top"},t._l(t.topSections,(function(e){return i("button",{key:e.name,staticClass:"item",style:t.buttonStyle(e),on:{click:function(i){return t.select(e)}}},[i("img",{staticClass:"svg-icon",style:{filter:e.colorize?t.issueColor:"invert(100%)"},attrs:{src:e.icon,draggable:!1}}),i("p",[t._v(t._s(e.name))])])})),0),i("div",{staticClass:"bottom"},t._l(t.bottomSections,(function(e){return i("button",{key:e.name,staticClass:"item",style:t.buttonStyle(e),on:{click:function(i){return t.select(e)}}},[i("img",{staticClass:"svg-icon",style:{filter:e.colorize?t.issueColor:"invert(100%)"},attrs:{src:e.icon,draggable:!1}}),i("p",[t._v(t._s(e.name))])])})),0)])}),[],!1,zn,"2289cfaf",null,null);function zn(t){for(let e in Dn)this[e]=Dn[e]}var Rn=function(){return Ln.exports}();var Fn=d({name:"ErrorPanel",i18n:{messages:{en:{sync:"Sync folders",theme:"Light/Dark",lang:"EN/DE",split:"Split view"},de:{sync:"Sync",theme:"Hell/Dunkel",lang:"DE/EN",split:"Aufteilen"}}},data:()=>({state:yt.state,showDescription:!1,descriptionIndexListWarning:[],descriptionIndexListError:[],isError:!1}),watch:{"$route.path"(){this.clearAllButtons()}},computed:{headerTextColor(){let t={};return this.state.statusWarnings.length&&(t={color:"#fe8"}),this.state.statusErrors.length&&(t={color:"#f66"}),t}},methods:{cleanError:t=>t.startsWith("Error: ")?t.slice(7):t,clearAllButtons(){this.$store.commit("clearAllErrors"),this.$emit("activate",{name:"Files",class:"BrowserPanel",onlyIfVisible:!0})},toggleShowDescription(t,e){if(this.isError=e,e)if(this.descriptionIndexListError.includes(t)){var i=this.descriptionIndexListError.indexOf(t);this.descriptionIndexListError.splice(i,1)}else this.descriptionIndexListError.push(t);else if(this.descriptionIndexListWarning.includes(t)){i=this.descriptionIndexListWarning.indexOf(t);this.descriptionIndexListWarning.splice(i,1)}else this.descriptionIndexListWarning.push(t)}}});const Mn={};var On=bt(Fn,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"top-panel"},[i("h4",{style:t.headerTextColor},[t._v("Issues")]),i("div",{staticClass:"warnings"},[t.state.statusErrors.length||t.state.statusWarnings.length?i("div",{staticClass:"message-area"},[t.state.statusErrors.length?i("h3",[t._v("Errors: "+t._s(t.state.statusErrors.length))]):t._e(),t._l(t.state.statusErrors,(function(e,s){return i("div",{staticClass:"single-message"},[i("p",{domProps:{innerHTML:t._s(t.cleanError(e.msg))},on:{click:function(e){return t.toggleShowDescription(s,!0)}}}),t.descriptionIndexListError.includes(s)?i("div",{staticClass:"description"},[i("p",{domProps:{innerHTML:t._s(e.desc)}})]):t._e()])})),t.state.statusWarnings.length?i("h3",[t._v("Warnings: "+t._s(t.state.statusWarnings.length))]):t._e(),t._l(t.state.statusWarnings,(function(e,s){return i("div",{staticClass:"single-message"},[i("p",{domProps:{innerHTML:t._s(e.msg)},on:{click:function(e){return t.toggleShowDescription(s,!1)}}}),t.descriptionIndexListWarning.includes(s)?i("div",{staticClass:"description"},[i("p",{domProps:{innerHTML:t._s(e.desc)}})]):t._e()])}))],2):i("div",{staticClass:"no-error"},[i("p",{staticClass:"check"},[t._v("☑️")]),i("p",[t._v("No issues for this page.")])])])]),i("div",{staticClass:"bottom-panel"},[t.state.statusErrors.length||t.state.statusWarnings.length?i("b-button",{staticClass:"clear-button",attrs:{expanded:""},on:{click:function(e){return t.clearAllButtons()}}},[t._v("Clear all messages")]):t._e()],1)])}),[],!1,Pn,"13282e62",null,null);function Pn(t){for(let e in Mn)this[e]=Mn[e]}var $n=function(){return On.exports}();var In=d({name:"AddDataSource",props:{},data:()=>({labelField:"",urlField:"",noteField:"",notes:"",mdParser:new pt}),mounted(){this.notes=this.mdParser.render('\nAdd a local shortcut for any URL-based resource.\nSimWrapper requires several server settings, including:\n\n- Open access (no login)\n- File and directory listings\n-  CORS "Access-Control-Allow-Origin"\n')},watch:{labelField(){this.fixField()}},computed:{isValidURL(){return!!this.labelField&&(!!this.urlField&&!!this.urlField.startsWith("http"))}},methods:{addURL(){this.fixField(),console.log("Adding",this.labelField,this.urlField);const t="projectShortcuts";try{let e=localStorage.getItem(t)||"{}",i=JSON.parse(e);i[this.labelField]={name:`${this.labelField}`,slug:`${this.labelField}`,description:this.noteField,baseURL:this.urlField},console.log("NEW ROOTS",i),localStorage.setItem(t,JSON.stringify(i)),yt.commit("setURLShortcuts",i)}catch(e){console.error(""+e)}},fixField(){this.labelField=this.labelField.toLowerCase().replaceAll(/[^a-z\-0-9@]*/g,"")}}});const Nn={};var Hn=bt(In,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"add-data"},[i("div",{staticClass:"add"},[i("div",{staticClass:"markdown",domProps:{innerHTML:t._s(t.notes)}}),i("div",{staticClass:"flex-row"},[t._m(0),i("b-input",{staticClass:"flex5",attrs:{size:"is-small",placeholder:"e.g. server1",maxlength:"32"},model:{value:t.labelField,callback:function(e){t.labelField=e},expression:"labelField"}})],1),i("div",{staticClass:"flex-row"},[t._m(1),i("b-input",{staticClass:"flex5",attrs:{size:"is-small",placeholder:"http://localhost:8001",maxlength:"512"},model:{value:t.urlField,callback:function(e){t.urlField=e},expression:"urlField"}})],1),i("div",{staticClass:"flex-row"},[t._m(2),i("b-input",{staticClass:"flex5",attrs:{size:"is-small",placeholder:"optional",maxlength:"255"},model:{value:t.noteField,callback:function(e){t.noteField=e},expression:"noteField"}})],1),i("div",{staticClass:"flex-row"},[i("p",{staticClass:"flex1"},[t._v(" ")]),i("b-button",{staticClass:"is-primary",attrs:{size:"is-small",disabled:!t.isValidURL,type:t.isValidURL?"":"is-outlined"},on:{click:t.addURL}},[t._v("Add Data URL")])],1)])])}),[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("p",{staticClass:"flex1"},[i("b",[t._v("Label")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("p",{staticClass:"flex1"},[i("b",[t._v("URL")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("p",{staticClass:"flex1"},[i("b",[t._v("Note")])])}],!1,jn,"3055b930",null,null);function jn(t){for(let e in Nn)this[e]=Nn[e]}var Bn=function(){return Hn.exports}();const Vn=[".nodashboards","nodashboards","nodashboards.txt"],Wn={"":"#118860","aggregate-od":"#E98B52","vehicle-anim":"#330033","x-y-t":"#583270",carriers:"#c97A2C",events:"#4400ff",hexagons:"#900564",map:"#c94264",network:"#894654",sankey:"#D8A672",summary:"#2EA95B",transit:"#3B6FE4"};var qn=d({name:"BrowserPanel",i18n:{messages:{en:{Maps:"Maps & Dashboards",Images:"Images",Analysis:"Analysis",Files:"Files",Folders:"Folders",Topsheet:"Table",privacy:"SimWrapper is a client-side app, which means there is no upstream server collecting or storing data.\n\nSimWrapper does not collect, handle or process any data about you while you use the site. SimWrapper does not contain any tracking devices or analytics software. No user cookies are stored or transmitted."},de:{Maps:"Karten",Images:"Bilder",Analysis:"Ergebnisse",Files:"Dateien",Folders:"Ordner",Topsheet:"Tabelle"}}},components:Object.assign({AddDataSource:Bn,FileSystemProjects:vn,TopsheetsFinder:Zs},Ii),data:()=>({globalState:yt.state,subfolder:"/",root:"",summaryYamlFilename:"viz-summary.yml",highlightedViz:-2,needDoubleClickHint:!1,allConfigFiles:{dashboards:{},topsheets:{},vizes:{},configs:{}},allRoots:[],mdRenderer:new pt({html:!0,linkify:!0,typographer:!0}),myState:{errorStatus:"",folders:[],files:[],isLoading:!1,readme:"",svnProject:null,svnRoot:void 0,subfolder:"",vizes:[],summary:!1},clicks:0,clickTimer:{}}),mounted(){this.setupHints(),this.updateShortcuts(),this.getRootAndRoute(this.$route.params.pathMatch)},watch:{"globalState.svnProjects"(){this.updateShortcuts()},"globalState.colorScheme"(){this.fetchFolderContents()},subfolder(){this.updateRoute()},"globalState.authAttempts"(){this.authenticationChanged()},"myState.files"(){this.filesChanged()}},computed:{hasDashboards(){return!!Object.keys(this.allConfigFiles.dashboards).length},vizImages(){const t={};for(let e=0;e<this.myState.vizes.length;e++)"image-view"===this.myState.vizes[e].component&&(t[e]=this.myState.vizes[e]);return t},vizMaps(){const t=["image-view","dashboard"],e=new Map;this.hasDashboards&&e.set(-1,{component:"",title:"Dashboard Panel"});for(let i=0;i<this.myState.vizes.length;i++)t.includes(this.myState.vizes[i].component)||e.set(i,this.myState.vizes[i]);return e},isChrome:()=>!!window.showDirectoryPicker,localFileHandles(){return this.$store.state.localFileHandles.concat().sort(((t,e)=>parseInt(t.key.substring(2))<parseInt(e.key.substring(2))?-1:1))}},methods:{updateRoute(){if(!this.root)return;const t=this.getFileSystem(this.root);this.myState.svnProject=t,this.myState.subfolder=this.subfolder||"",this.myState.readme="",this.highlightedViz=-2,this.myState.svnProject&&(this.myState.svnRoot=new S(this.myState.svnProject,yt),this.generateBreadcrumbs(),this.fetchFolderContents())},authenticationChanged(){console.log("AUTH CHANGED - Reload"),this.updateRoute()},async filesChanged(){this.myState.vizes=[],0!==this.myState.files.length&&(this.showReadme(),this.myState.summary=-1!==this.myState.files.indexOf(this.summaryYamlFilename),this.myState.summary?await this.buildCuratedSummaryView():this.buildShowEverythingView(),await this.$nextTick(),Gs(".medium-zoom",{background:"#444450"}))},updateShortcuts(){const t=this.globalState.svnProjects.filter((t=>!t.hidden&&!t.slug.startsWith("fs")));this.allRoots=t},cleanName:t=>decodeURIComponent(t),getFileSystem(t){const e=yt.state.svnProjects.filter((e=>e.slug===t));if(0===e.length)throw console.log("no such project"),Error;return e[0]},generateBreadcrumbs(){if(!this.myState.svnProject)return[];const t=[{label:"SimWrapper",url:"/"},{label:this.myState.svnProject.name,url:"/"+this.myState.svnProject.slug}],e=this.myState.subfolder.split("/");let i="/";for(const s of e)s&&(i+=s+"/",t.push({label:s,url:"/"+this.myState.svnProject.slug+i}));return yt.commit("setBreadCrumbs",t),t},setupHints(){let t=localStorage.getItem("needsClickHint");t=t?JSON.parse(t):0,t>5e3?this.needDoubleClickHint=!1:(t++,localStorage.setItem("needsClickHint",JSON.stringify(t)))},clickedBreadcrumb(t){this.getRootAndRoute(t.url.slice(1))},getRootAndRoute(t){if(!t)return;if("/"===t)return void(this.root="");if(t.startsWith("split/"))return console.log("SPLIT"),void t.substring(6);let e=t,i="";const s=t.indexOf("/");s>-1&&(e=t.substring(0,s),i=t.substring(s+1)),this.root=e,this.subfolder=i},activateVisualization(t){const e=this.myState.vizes[t]||{component:"TabbedDashboardView",title:"Dashboard"};if("image-view"===e.component)return;if(!this.myState.svnProject)return;this.highlightedViz=-2;const i=this.myState.subfolder.replaceAll("//","/"),s={root:this.myState.svnProject.slug,xsubfolder:i,subfolder:i,yamlConfig:e.config,thumbnail:!1};this.$emit("navigate",{component:e.component,props:s})},updateTitle(t,e){this.myState.vizes[t].title=e},configureSources(){this.$emit("activate",{name:"Settings",class:"SettingsPanel"})},getTabColor:t=>({backgroundColor:Wn[t]||"#8778BB"}),async showReadme(){this.myState.readme="";const t="readme.md";if(this.myState.files.map((t=>t.toLocaleLowerCase())).indexOf(t)>-1){if(!this.myState.svnRoot)return;const e=await this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+t);this.myState.readme=this.mdRenderer.render(e)}},buildShowEverythingView(){for(const t of this.globalState.visualizationTypes.values()){const e=ft(this.myState.files,t.filePatterns);for(const i of e)this.myState.vizes.push({component:t.kebabName,config:i,title:".."})}},async buildCuratedSummaryView(){if(!this.myState.svnRoot)return;const t=q.parse(await this.myState.svnRoot.getFileText(this.myState.subfolder+"/"+this.summaryYamlFilename));for(const e of t.plugins){const i=this.globalState.visualizationTypes.get(e);if(i)if(t[i.kebabName])for(const e of t[i.kebabName]){const t=await this.findMatchingFiles(e);for(const e of t)this.myState.vizes.push({component:i.kebabName,config:e,title:e})}else{const t=ft(this.myState.files,i.filePatterns);for(const e of t)this.myState.vizes.push({component:i.kebabName,config:e,title:".."})}}},async findMatchingFiles(t){if(this.myState.files.indexOf(t)>-1)return[t];const e=ft(this.myState.files,t);if(e.length)return e;if(!this.myState.svnRoot)return[];try{const e=t.split("/"),i=this.myState.subfolder+"/"+e[0];console.log(i);const s=await this.myState.svnRoot.getDirectory(i);return ft(s.files,e[1]).map((t=>e[0]+"/"+t))}catch(i){}return[]},async fetchFolderContents(){if(!this.myState.svnRoot)return[];this.myState.isLoading=!0,this.myState.errorStatus="",this.myState.files=[];try{this.allConfigFiles=await this.findAllConfigsAndDashboards();const t=await this.myState.svnRoot.getDirectory(this.myState.subfolder),e=t.dirs.filter((t=>!t.startsWith("."))).sort(),i=t.files.filter((t=>!t.startsWith("."))).sort(),s=Object.assign({},this.allConfigFiles.vizes);for(const a of i)s[a]=a;const n=Object.values(s);this.myState.errorStatus="",this.myState.folders=["UP"].concat(e),this.myState.files=n}catch(t){const e=this.myState.subfolder.lastIndexOf("/");return e>-1?void(this.subfolder=this.myState.subfolder.slice(0,e)):void(this.subfolder="")}finally{this.myState.isLoading=!1}},clickedVisualization(t){if(this.myState.isLoading)return;this.highlightedViz=t,this.clicks++,1===this.clicks?this.clickTimer=setTimeout((()=>{this.needDoubleClickHint=!0,this.clicks=0}),450):(clearTimeout(this.clickTimer),this.needDoubleClickHint=!1,this.activateVisualization(t),this.clicks=0)},clickedOnFolder(t){this.needDoubleClickHint=!1;const{folder:e,root:i,i:s}=t;if(i)return this.root=i,this.subfolder="",void this.updateRoute();if(!this.myState.isLoading&&this.myState.svnProject)if(0!=s||"UP"!==e)this.subfolder=`${this.subfolder}/${e}`;else if("/"===this.subfolder||""===this.subfolder)this.root="";else{const t=this.subfolder.lastIndexOf("/");this.subfolder=t>-1?this.subfolder.slice(0,t):"/"}},handleSingleClickFolder(t){const{folder:e,root:i,i:s}=t;if(i)return this.root=i,this.subfolder="",void this.updateRoute();if(this.myState.isLoading)return;if(!this.myState.svnProject)return;if(0==s&&"UP"===e)return;const n=".."===e?this.myState.subfolder.substring(0,this.myState.subfolder.lastIndexOf("/")):this.myState.subfolder+"/"+e,a={root:this.myState.svnProject.slug,xsubfolder:n};n||this.myState.subfolder?this.$emit("navigate",{component:"TabbedDashboardView",props:a}):this.$emit("navigate",{component:"SplashPage",props:{}})},dragEnd(){this.$emit("isDragging",!1)},dragStart(t,e){var i;this.$emit("isDragging",!0);const s=Object.assign({},e,{root:this.root,subfolder:this.myState.subfolder,xsubfolder:this.myState.subfolder});s.yamlConfig=s.config,delete s.config;const n=JSON.stringify(s);null==(i=t.dataTransfer)||i.setData("bundle",n)},clickedLogo(){this.$router.push("/")},async findAllConfigsAndDashboards(){if(!this.myState.svnRoot)return{dashboards:{},configs:{},vizes:{},topsheets:{}};try{const{files:t}=await this.myState.svnRoot.getDirectory(this.subfolder);let e=!0;Vn.forEach((i=>{t.indexOf(i)>-1&&(e=!1)}));const i=await this.myState.svnRoot.findAllYamlConfigs(this.subfolder);return e||(i.dashboards={}),i}catch(t){return{dashboards:{},configs:{},vizes:{},topsheets:{}}}},async clickedBrowseChromeLocalFolder(t){try{const e=await t.handle.requestPermission({mode:"read"});if(console.log(t.handle,e),"granted"!==e)return;At.find((e=>e.slug==t.key))||kt(t.handle,t.key);const i={root:t.key};this.clickedOnFolder(i)}catch(e){console.error(""+e)}},async showChromeDirectory(){try{const t=window.showDirectoryPicker(),e=await t,i=kt(e,null);this.$router.push(`/report-tncs2020-simwrapper/${i}/`)}catch(t){}},async clickedDelete(t){const e=this.$store.state.localFileHandles.filter((e=>e.key!==t.key));await g("fs",e),this.$store.commit("setLocalFileSystem",e)}}});const Un={};var Gn=bt(qn,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"top-panel"},[i("h4",[t._v("Files")]),t.root?i("div",{staticClass:"trail"},[i("div",{staticClass:"x-home"},[i("p",{on:{click:function(e){return t.clickedBreadcrumb({url:"//"})}}},[i("i",{staticClass:"fa fa-home"})])]),t.root?i("div",{staticClass:"x-breadcrumbs"},t._l(t.globalState.breadcrumbs.slice(1),(function(e,s){return i("p",{key:e.url,on:{click:function(i){return t.clickedBreadcrumb(e)}}},[t._v(" / "+t._s(e.label))])})),0):t._e()]):t._e()]),i("div",{staticClass:"middle-panel"},[t.root?i("div",{staticClass:"curated-sections"},[i("h3",{staticClass:"curate-heading"},[t._v(t._s(t.globalState.breadcrumbs[t.globalState.breadcrumbs.length-1].label))]),t.myState.folders.length?i("div",{staticClass:"curate-content"},[i("div",{staticClass:"folder-table"},t._l(t.myState.folders,(function(e,s){return i("div",{key:e,staticClass:"folder",class:{fade:t.myState.isLoading,upfolder:0==s},on:{click:function(i){return t.clickedOnFolder({folder:e,i:s})}}},[i("i",{staticClass:"fa",class:0==s?"fa-arrow-up":"fa-folder-open"}),i("p",[t._v(t._s(t.cleanName(e)))])])})),0),1==t.myState.folders.length?i("p",{staticStyle:{"font-size":"0.9rem",opacity:"0.7",margin:"0.5rem 0","text-align":"right"}},[t._v("No subfolders.")]):t._e()]):t._e(),t.vizMaps.size?i("div",{staticClass:"section-maps"},[i("h3",{staticClass:"curate-heading"},[t._v(t._s(t.$t("Maps")))]),i("div",{staticClass:"curate-content"},[i("div",{staticClass:"viz-table"},t._l(t.vizMaps.entries(),(function(e){var s=e[0],n=e[1];return i("div",{key:s,staticClass:"viz-grid-item",on:{click:function(e){return t.clickedVisualization(s)}}},[i("div",{staticClass:"viz-frame",class:{highlighted:s===t.highlightedViz},attrs:{draggable:""},on:{dragstart:function(e){return t.dragStart(e,n)},dragend:t.dragEnd}},[i("p",{staticClass:"v-title"},[i("b",[t._v(t._s(n.title))])]),i("p",{staticClass:"v-filename"},[t._v(t._s(n.config))]),i("p",{staticClass:"v-plugin",style:t.getTabColor(n.component)},[t._v(t._s(n.component||"dashboard"))]),i(n.component,{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],tag:"component",staticClass:"viz-frame-component",style:{"pointer-events":"none"},attrs:{root:t.myState.svnProject.slug,subfolder:t.myState.subfolder,yamlConfig:n.config,thumbnail:!0,fileApi:t.myState.svnRoot},on:{title:function(e){return t.updateTitle(s,e)}}})],1)])})),0),i("div",{staticClass:"hint-clicks",style:{opacity:t.needDoubleClickHint?1:0}},[t._m(1)])])]):t._e(),Object.keys(t.vizImages).length?i("div",{staticClass:"section-images"},[i("h3",{staticClass:"curate-heading"},[t._v(t._s(t.$t("Images")))]),i("div",{staticClass:"curate-content"},[i("div",{staticClass:"viz-image-table"},t._l(Object.entries(t.vizImages),(function(e){var s=e[0],n=e[1];return i("div",{key:s,staticClass:"viz-image-grid-item",on:{click:function(e){return t.clickedVisualization(s)}}},[i("div",{staticClass:"viz-image-frame"},[i(n.component,{tag:"component",staticClass:"viz-image-frame-component",style:{"pointer-events":"auto"},attrs:{root:t.myState.svnProject.slug,subfolder:t.myState.subfolder,yamlConfig:n.config,thumbnail:!0,fileApi:t.myState.svnRoot},on:{title:function(e){return t.updateTitle(s,e)}}}),i("p",[t._v(t._s(n.title))])],1)])})),0)])]):t._e()]):i("div",{staticClass:"curated-sections"},[t._m(0),t.isChrome?i("div",{staticClass:"is-chrome"},[i("h3",[t._v("Local Folders")]),t.localFileHandles.length?t._e():i("p",[t._v("Chrome & Edge can browse folders directly:")]),t._l(t.localFileHandles,(function(e){return i("div",{key:e.key,staticClass:"project-root local",on:{click:function(i){return t.clickedBrowseChromeLocalFolder(e)}}},[i("h5",{staticClass:"remove-local",staticStyle:{flex:"1"}},[t._v(t._s(e.handle.name)),i("i",{staticClass:"fa fa-times",on:{click:function(i){return i.stopPropagation(),t.clickedDelete(e)}}})]),i("p",[t._v("Local folder")])])})),i("p",{staticClass:"config-sources"},[i("a",{on:{click:t.showChromeDirectory}},[t._v("Add local folder...")])])],2):t._e(),i("h3",{staticStyle:{"margin-top":"1rem"}},[t._v("Data Sources")]),t._l(t.allRoots,(function(e){return i("div",{key:e.slug,staticClass:"project-root",on:{click:function(i){return t.clickedOnFolder({root:e.slug})}}},[i("h5",[t._v(t._s(e.name))]),i("p",[t._v(t._s(e.description))])])})),i("p",{staticClass:"config-sources"},[i("a",{on:{click:t.configureSources}},[t._v("Edit data sources...")])])],2)])])}),[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"hint-clicks",staticStyle:{"margin-bottom":"1rem",opacity:"1"}},[i("p",[t._v("You can browse to another folder from here. Drag panels into the main window area to open them side-by-side.")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("p",[i("b",[t._v("Drag")]),t._v(" or "),i("b",[t._v("double-click")]),t._v(" a tile"),i("br"),t._v("to open it in the main panel")])}],!1,Yn,"3c13be80",null,null);function Yn(t){for(let e in Un)this[e]=Un[e]}var Xn=function(){return Gn.exports}();var Jn=d({name:"SettingsPanel",components:{AddDataSource:Bn},i18n:{messages:{en:{translate:"Note: German translations are incomplete, but steadily improving",theme:"Theme",light:"Light",dark:"Dark",language:"Language",dataSources:"Data Sources",addDataSources:"Add Data Source"},de:{translate:"Die Übersetzungen sind unvollständig, werden aber immer besser...",theme:"Thema",light:"Hell",dark:"Dunkel",language:"Sprache",dataSources:"Datenquellen"}}},data:()=>({state:yt.state,theme:"",shortcuts:[]}),mounted(){this.theme=this.state.isDarkMode?"dark":"light",this.setupShortcuts()},watch:{"state.svnProjects"(){this.setupShortcuts()},"state.isDarkMode"(){console.log("ooop!",this.state.isDarkMode),this.theme=this.state.isDarkMode?"dark":"light"}},computed:{isLight(){return"light"==this.theme?{backgroundColor:"#ffdd57",color:"#222",borderColor:"#aaa"}:{backgroundColor:"unset",color:"#888",borderColor:"#aaa"}},isDark(){return"dark"==this.theme?{backgroundColor:"#7957d5",color:"white",borderColor:"#aaa"}:{backgroundColor:"unset",color:"#888",borderColor:"#aaa"}},isEN(){return"en"==this.state.locale?{backgroundColor:"#ffdd57",color:"#222",borderColor:"#aaa"}:{backgroundColor:"unset",color:"#888",borderColor:"#aaa"}},isDE(){return"de"==this.state.locale?{backgroundColor:"#ffdd57",color:"#222",borderColor:"#aaa"}:{backgroundColor:"unset",color:"#888",borderColor:"#aaa"}}},methods:{setupShortcuts(){try{const t=localStorage.getItem("projectShortcuts");if(t){const e=JSON.parse(t);this.shortcuts=Object.values(e)}}catch(t){console.error("ERROR MERGING URL SHORTCUTS:",""+t)}},deleteShortcut(t){try{const e=localStorage.getItem("projectShortcuts");if(e){const i=JSON.parse(e);delete i[t],localStorage.setItem("projectShortcuts",JSON.stringify(i)),yt.commit("removeURLShortcut",t),this.shortcuts=Object.values(i)}}catch(e){console.error("ERROR MERGING URL SHORTCUTS:",""+e)}},setTheme(t){this.theme=t,console.log(this.theme),yt.commit("setTheme",t)},setLanguage(t){this.$store.commit("setLocale",t),this.$root.$i18n.locale=t}}});const Kn={};var Zn=bt(Jn,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[t._m(0),i("div",{staticClass:"middle-panel"},[i("div",{staticClass:"option"},[i("h5",[t._v(t._s(t.$t("theme")))]),i("b-button",{staticClass:"button is-white",style:t.isLight,attrs:{outlined:""},on:{click:function(e){return t.setTheme("light")}}},[t._v(t._s(t.$t("light")))]),i("b-button",{staticClass:"button is-gray",style:t.isDark,attrs:{outlined:""},on:{click:function(e){return t.setTheme("dark")}}},[t._v(t._s(t.$t("dark")))])],1),i("div",{staticClass:"option"},[i("h5",[t._v(t._s(t.$t("language")))]),i("b-button",{staticClass:"button is-white",style:t.isEN,attrs:{outlined:""},on:{click:function(e){return t.setLanguage("en")}}},[t._v("EN")]),i("b-button",{staticClass:"button is-gray",style:t.isDE,attrs:{outlined:""},on:{click:function(e){return t.setLanguage("de")}}},[t._v("DE")])],1),i("div",{staticClass:"option"},[i("h5",[t._v(t._s(t.$t("dataSources")))]),t._l(t.shortcuts,(function(e){return i("div",{key:e.slug,staticClass:"source flex-row"},[i("div",{staticClass:"desc flex1"},[i("p",[i("b",[t._v(t._s(e.slug))])]),i("p",[t._v(t._s(e.description))])]),i("div",{staticClass:"delete",on:{click:function(i){return t.deleteShortcut(e.slug)}}})])}))],2),i("div",{staticClass:"option"},[i("h5",[t._v(t._s(t.$t("addDataSources")))]),i("add-data-source")],1)])])}),[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"top-panel"},[i("h4",[t._v("Settings")])])}],!1,Qn,"634561f2",null,null);function Qn(t){for(let e in Kn)this[e]=Kn[e]}var ta=function(){return Zn.exports}();const ea="/report-tncs2020-simwrapper/";var ia=d({name:"LayoutManager",i18n:{messages:{en:{close:"Close panel",back:"Go back"},de:{close:"Schließen",back:"Zurück"}}},components:Object.assign({LeftIconPanel:Rn,BrowserPanel:Xn,FolderBrowser:an,ErrorPanel:$n,SettingsPanel:ta,SplashPage:_n,TabbedDashboardView:un},Ii),data:()=>({panels:[],leftSections:["BrowserPanel","ErrorPanel","SettingsPanel"],panelsWithScrollbars:["TabbedDashboardView","FolderBrowser","calc-table"],zoomed:!1,isEmbedded:!1,fullScreenPanel:{x:-1,y:-1},activeLeftSection:{name:"Files",class:"BrowserPanel"},leftSectionWidth:300,isDraggingDivider:0,dragStartWidth:0,quadrant:null,dragX:-1,dragY:-1,isDragHappening:!1,isShowingActiveSection:!1,authHandles:[]}),computed:{isMultipanel(){return this.panels.length>1||this.panels[0].length>1},showLeftBar(){return this.$store.state.isShowingLeftBar},activeSectionStyle(){return this.activeLeftSection?{width:`${this.leftSectionWidth}px`}:{display:"none"}}},watch:{"$store.state.statusErrors"(){this.$store.state.statusErrors.length&&(this.activeLeftSection={name:"Issues",class:"ErrorPanel"})},$route(t,e){t.path===ea?this.panels=[[{component:"SplashPage",key:Math.random(),props:{}}]]:(this.buildLayoutFromURL(),yt.commit("resize"))}},methods:{setActiveLeftSection(t){t.section.onlyIfVisible&&!this.isShowingActiveSection||(this.isShowingActiveSection&&t.section.name===this.activeLeftSection.name?t.toggle&&(this.isShowingActiveSection=!1):t.section.link?window.open(t.section.link,"_blank"):(this.isShowingActiveSection=!0,this.activeLeftSection=t.section,localStorage.setItem("activeLeftSection",JSON.stringify(t.section)),this.leftSectionWidth<48&&(this.leftSectionWidth=300)))},buildLayoutFromURL(){let t=this.$route.params.pathMatch;if(t.startsWith("/")&&(t=t.slice(1)),!t||"/"===t)return void(this.panels=[[{component:"SplashPage",key:Math.random(),props:{}}]]);if(t.startsWith("split/")){const e=t.substring(6);try{const t=atob(e),i=JSON.parse(t);this.panels=i}catch(d){console.error("PARSING SPLIT"+d),this.$router.replace("/")}return}let e=t,i="";const s=t.indexOf("/");s>-1&&(e=t.substring(0,s),i=t.substring(s+1));const n=t.substring(1+t.lastIndexOf("/")),a=n.toLocaleLowerCase();for(const u of yt.state.visualizationTypes.values())if(ft.isMatch(a,u.filePatterns)){if(1===this.panels.length&&1===this.panels[0].length)this.panels=[[this.panels[0][0]]];else{let t=Math.random();this.panels=[[{key:t,component:u.kebabName,title:"",description:"",props:{root:e,subfolder:i.substring(0,i.lastIndexOf("/")),yamlConfig:n,thumbnail:!1}}]]}return}let o=Math.random();1===this.panels.length&&1===this.panels[0].length&&(o=this.panels[0][0].key);const r=this.$store.state.svnProjects.filter((t=>t.slug===e));if(!r.length)throw Error("no such project");const l=r[0],c=i.startsWith("/")?i.slice(1):i,h=`${l.name}: ${c}`;this.panels=[[{key:o,title:h,component:"TabbedDashboardView",props:{root:e,xsubfolder:i}}]]},handleDragStartStop(t){this.isDragHappening=t},buildDragHighlightStyle(t,e){if(-1==t){return{top:0,opacity:"rowTop"==this.quadrant?"1":"0",pointerEvents:this.isDragHappening?"auto":"none",backgroundColor:"#ffcc4480"}}if(-2==t){return{bottom:0,opacity:"rowBottom"==this.quadrant?"1":"0",pointerEvents:this.isDragHappening?"auto":"none",backgroundColor:"#ffcc4480"}}if(t!==this.dragX||e!==this.dragY||!this.quadrant)return{};const i={opacity:1,backgroundColor:"center"==this.quadrant.quadrant?"#079f6f80":"#4444dd90"};return Object.entries(this.quadrant).forEach((t=>i[t[0]]=`${t[1]}px`)),i},stillDragging(t){const{event:e,x:i,y:s,row:n}=t;if(n)return void(this.quadrant=n);this.dragX=i,this.dragY=s;const a=this.$refs[`dragContainer${i}-${s}`],o=this.$refs.tileTable.offsetLeft,r=a[0],l=(e.clientX-r.offsetLeft-o)/r.offsetWidth;e.clientY,r.offsetTop,r.offsetHeight;let c=8;if(l<.3)this.quadrant={quadrant:"left",width:r.offsetWidth/2-2*c,height:r.offsetHeight-2*c,marginLeft:c,marginTop:c};else if(l>.7)this.quadrant={quadrant:"right",width:r.offsetWidth/2-2*c,height:r.offsetHeight-2*c,marginLeft:r.offsetWidth/2+c,marginTop:c};else{c*=5;const t=.95*(r.offsetWidth-2*c),e=.95*(r.offsetHeight-2*c);this.quadrant={quadrant:"center",width:t,height:e,marginLeft:(r.offsetWidth-t)/2,marginTop:(r.offsetHeight-e)/2}}},dragEnd(){this.quadrant=null,this.dragX=-1,this.dragY=-1},onDrop(t){var e;if(!this.quadrant)return;const{event:i,x:s,y:n,row:a}=t;try{const t=null==(e=i.dataTransfer)?void 0:e.getData("bundle"),o=JSON.parse(t),r={component:o.component||"TabbedDashboardView",props:o};this.onSplit({x:s,y:n,row:a,quadrant:this.quadrant.quadrant,viz:r})}catch(o){console.warn(""+o)}this.dragEnd()},async onSplit(t){const{x:e,y:i,row:s,quadrant:n,viz:a}=t,o={component:a.component,props:a.props,title:"",description:"",key:Math.random()};if(s)switch(s){case"rowTop":this.panels.unshift([o]);break;case"rowBottom":this.panels.push([o]);break;default:console.warn("HUH?",s)}else switch(n){case"center":this.panels[i][e]=o;break;case"left":this.panels[i].splice(e,0,o);break;case"right":this.panels[i].splice(e+1,0,o);break;default:return void console.warn("TOP AND BOTTOM to be added later")}this.updateURL(),yt.commit("resize")},onNavigate(t,e,i){"SplashPage"===t.component?this.panels[i][e]={component:"SplashPage",props:{},key:Math.random()}:this.panels[i][e]=Object.assign({key:Math.random()},t),this.updateURL(),this.buildLayoutFromURL()},onClose(t,e){this.panels[e][t].component=null,this.panels[e].splice(t,1),this.panels[e].length||(this.panels.length>1?this.panels.splice(e,1):this.panels[0].push({component:"SplashPage",key:Math.random(),props:{}})),this.updateURL(),yt.commit("resize")},onBack(t,e){this.panels[e][t].component="TabbedDashboardView",this.panels[e][t].props.xsubfolder=this.panels[e][t].props.subfolder,delete this.panels[e][t].props.yamlConfig,this.updateURL()},getShowHeader(t){return"SplashPage"!==t.component&&(!!this.showLeftBar||(1!=this.panels.length||1!=this.panels[0].length))},updateURL(){if(1===this.panels.length&&1===this.panels[0].length){const t=this.panels[0][0].props,e=t.root||"",i=t.xsubfolder||t.subfolder||"",s=t.yamlConfig||"";if(s.indexOf("/")>-1){const t=s.substring(s.lastIndexOf("/"));this.$router.replace(`${ea}${e}/${i}/${t}`)}else if(s)this.$router.push(`${ea}${e}/${i}/${s}`);else{let s=`${ea}${e}/${i}`;t.config&&(s+=`/${t.config}`),this.$router.push(s)}}else{const t=btoa(JSON.stringify(this.panels));this.$router.push(`${ea}split/${t}`)}},cleanProps(t){const e=t,{title:i}=e;return((t,e)=>{var i={};for(var o in t)n.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&s)for(var o of s(t))e.indexOf(o)<0&&a.call(t,o)&&(i[o]=t[o]);return i})(e,["title"])},dividerDragStart(t){this.isDraggingDivider=t.clientX,this.dragStartWidth=this.leftSectionWidth},dividerDragEnd(t){this.isDraggingDivider=0},dividerDragging(t){if(!this.isDraggingDivider)return;const e=t.clientX-this.isDraggingDivider;this.leftSectionWidth=Math.max(0,this.dragStartWidth+e),localStorage.setItem("leftPanelWidth",`${this.leftSectionWidth}`)},setCardTitles(t,e){"string"==typeof e?(m.set(t,"title",e),t.description=""):(t.title=e.title,t.description=e.description||"")},async handleToggleInfoClicked(t){console.log("CARD INFO?",t)},async toggleZoom(t,e,i){console.log("ZOOM",t),this.fullScreenPanel.x>-1?this.fullScreenPanel={x:-1,y:-1}:this.fullScreenPanel={x:e,y:i}},updateDimensions(t){},getTileStyle(t){return{overflow:this.panelsWithScrollbars.includes(t.component)?"auto":"hidden"}},getContainerStyle(t,e,i){let s={padding:this.isMultipanel?"5px 5px":"0"};return-1==this.fullScreenPanel.x||(this.fullScreenPanel.x!==e?s.display="none":s={position:"absolute",top:0,bottom:0,left:0,right:0,margin:"5px 5px"}),s}},mounted(){"embed"in this.$route.query&&(this.isEmbedded=!0);const t=localStorage.getItem("leftPanelWidth");this.leftSectionWidth=null==t?300:parseInt(t),this.leftSectionWidth<0&&(this.leftSectionWidth=2);const e=localStorage.getItem("activeLeftSection");if(e)try{this.activeLeftSection=JSON.parse(e)}catch(i){this.activeLeftSection={name:"Files",class:"BrowserPanel"}}else this.activeLeftSection={name:"Files",class:"BrowserPanel"};this.buildLayoutFromURL()}});const sa={};var na=bt(ia,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{style:{userSelect:t.isDraggingDivider?"none":"unset"},attrs:{id:"split-screen"},on:{mousemove:t.dividerDragging,mouseup:t.dividerDragEnd}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showLeftBar,expression:"showLeftBar"}],staticClass:"left-panel"},[i("left-icon-panel",{attrs:{activeSection:t.activeLeftSection.name},on:{activate:function(e){return t.setActiveLeftSection({section:e,toggle:!0})}}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowingActiveSection,expression:"isShowingActiveSection"}],staticClass:"left-panel-active-section",style:t.activeSectionStyle},t._l(t.leftSections,(function(e){return i(e,{directives:[{name:"show",rawName:"v-show",value:e==t.activeLeftSection.class,expression:"section==activeLeftSection.class"}],key:e,tag:"component",on:{navigate:function(e){return t.onNavigate(e,0,0)},activate:function(e){return t.setActiveLeftSection({section:e,toggle:!1})},isDragging:t.handleDragStartStop}})})),1),i("div",{directives:[{name:"show",rawName:"v-show",value:t.activeLeftSection,expression:"activeLeftSection"}],staticClass:"left-panel-divider",on:{mousedown:t.dividerDragStart,mouseup:t.dividerDragEnd,mousemove:function(e){return e.stopPropagation(),t.dividerDragging.apply(null,arguments)}}})],1),i("div",{ref:"tileTable",staticClass:"table-of-tiles"},[t.authHandles.length?i("div",{staticClass:"authorization-strip"},t._l(t.authHandles,(function(e){return i("div",{staticClass:"auth-row"},[i("p",{staticClass:"flex1"},[t._v(t._s(""+e))]),i("b-button",[t._v("hello")])],1)})),0):t._e(),i("div",{staticClass:"row-drop-target",style:t.buildDragHighlightStyle(-1,-1),on:{drop:function(e){return t.onDrop({event:e,row:"rowTop"})},dragover:[function(e){return t.stillDragging({event:e,row:"rowTop"})},function(t){t.preventDefault()}],dragenter:function(t){t.preventDefault()},dragleave:t.dragEnd}}),t._l(t.panels,(function(e,s){return i("div",{directives:[{name:"show",rawName:"v-show",value:-1==t.fullScreenPanel.y||t.fullScreenPanel.y==s,expression:"fullScreenPanel.y == -1 || fullScreenPanel.y == y"}],key:s,staticClass:"tile-row"},t._l(e,(function(e,n){return i("div",{key:e.key,ref:`dragContainer${n}-${s}`,refInFor:!0,staticClass:"drag-container",style:t.getContainerStyle(e,n,s),on:{drop:function(e){return t.onDrop({event:e,x:n,y:s})},dragover:[function(t){t.preventDefault()},function(e){return t.stillDragging({event:e,x:n,y:s})}],dragenter:function(t){t.preventDefault()},dragleave:t.dragEnd}},[t.getShowHeader(e)?i("div",{staticClass:"tile-header flex-row"},[i("div",{staticClass:"tile-labels"},[i("h3",{style:{textAlign:t.isMultipanel?"left":"center"}},[t._v(t._s(e.title))]),e.description?i("p",[t._v(t._s(e.description))]):t._e()]),i("div",{staticClass:"tile-buttons"},[e.info?i("div",{staticClass:"nav-button is-small is-white",on:{click:function(i){return t.handleToggleInfoClicked(e)}}},[i("i",{staticClass:"fa fa-info-circle"})]):t._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:t.panels.length>1||t.panels[0].length>1,expression:"panels.length > 1 || panels[0].length > 1"}],staticClass:"nav-button is-small is-white",attrs:{title:t.fullScreenPanel.x>-1?"Restore":"Enlarge"},on:{click:function(i){return t.toggleZoom(e,n,s)}}},[i("i",{staticClass:"fa fa-expand"})]),i("div",{staticClass:"nav-button is-small is-white",attrs:{title:"Close"},on:{click:function(e){return t.onClose(n,s)}}},[i("i",{staticClass:"fa fa-times-circle"})])])]):t._e(),i(e.component,t._b({tag:"component",staticClass:"map-tile",style:t.getTileStyle(e),on:{navigate:function(e){return t.onNavigate(e,n,s)},title:function(i){return t.setCardTitles(e,i)},activate:function(e){return t.setActiveLeftSection({section:e,toggle:!0})}}},"component",t.cleanProps(e.props),!1)),t.isDragHappening?i("div",{staticClass:"drag-highlight",style:t.buildDragHighlightStyle(n,s)}):t._e()],1)})),0)})),t.isDragHappening?i("div",{staticClass:"row-drop-target",style:t.buildDragHighlightStyle(-2,-2),on:{drop:function(e){return t.onDrop({event:e,row:"rowBottom"})},dragover:[function(e){return t.stillDragging({event:e,row:"rowBottom"})},function(t){t.preventDefault()}],dragenter:function(t){t.preventDefault()},dragleave:t.dragEnd}}):t._e()],2)])}),[],!1,aa,"67d79dc0",null,null);function aa(t){for(let e in sa)this[e]=sa[e]}var oa=function(){return na.exports}();export{oa as default};
//# sourceMappingURL=LayoutManager.a6a45ee4.js.map
